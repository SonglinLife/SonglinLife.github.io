{
    "version": "https://jsonfeed.org/version/1",
    "title": "Life",
    "subtitle": null,
    "icon": "https://songlinlife.top/images/favicon.ico",
    "description": "Life is not about lifestyle, it means Lithium and Ferrum.",
    "home_page_url": "https://songlinlife.top",
    "items": [
        {
            "id": "https://songlinlife.top/2022/MIT6-824-zookeeper/",
            "url": "https://songlinlife.top/2022/MIT6-824-zookeeper/",
            "title": "MIT6.824: zookeeper",
            "date_published": "2022-03-05T02:13:48.000Z",
            "content_html": "<h1 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h1>\n<blockquote>\n<p>Zookeeperï¼Œa service for coordinating processes of distributed applications.</p>\n</blockquote>\n<h1 id=\"the-zookeeper-service\"><a class=\"anchor\" href=\"#the-zookeeper-service\">#</a> The ZooKeeper service</h1>\n<h2 id=\"zookeeper-guarantees\"><a class=\"anchor\" href=\"#zookeeper-guarantees\">#</a> ZooKeeper guarantees</h2>\n<p>zookeeper æœ‰ä¸¤ä¸ªåŸºæœ¬çš„ ordering guaranteeï¼š</p>\n<p><code>Linearizable write</code> ï¼šzookeeper ä¿è¯æ‰€æœ‰å…³äº update çš„ request éƒ½æ˜¯ serializabelã€‚</p>\n<p><code>FIFO client order</code> ï¼šæ¥è‡ªä¸€ä¸ª client æ‰€æœ‰çš„ request æ‰§è¡Œé¡ºåºéµä» client å‘é€è¿™äº› request çš„é¡ºåºï¼Œä¹Ÿå°±æ˜¯ FIFOã€‚</p>\n<h3 id=\"å…³äºconfiguration\"><a class=\"anchor\" href=\"#å…³äºconfiguration\">#</a> å…³äº configuration</h3>\n<p>zookeeper ä½¿ç”¨ leader/worker æœºåˆ¶ï¼Œè¿™å°±æ„å‘³ç€å½“ leader æ”¹å˜çš„æ—¶å€™ï¼Œæœ‰å¤§é‡çš„ configuration å‚æ•°ä¹Ÿéœ€è¦æ”¹å˜ã€‚ä½†æ˜¯å¿…é¡»æ»¡è¶³ï¼š</p>\n<ul>\n<li>å½“ leader å¼€å§‹å¯¹ configuration make changeï¼Œå…¶ä»– processes ä¸åº”è¯¥ä½¿ç”¨è¿™äº›å·²ç»æ”¹å˜çš„ configurationã€‚</li>\n<li>å¦‚æœ leader åœ¨ configuration æ•´ä¸ª update å®Œäº†ä¹‹å‰å°± dead äº†ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›è¿™ä¸ª partial configuration è¢«ä½¿ç”¨ã€‚</li>\n</ul>\n<p>å¯¹äºç¬¬ä¸€ä¸ªè¦æ±‚ï¼Œå¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼é”æ¥æ§åˆ¶ï¼Œå³ leader å†™çš„æ—¶å€™å…¶ä»– worker ä¸åº”è¯¥è¯»ã€‚ä½†æ˜¯åˆ†å¸ƒå¼é”å¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œæ‰€ä»¥ zookeeper æå‡ºäº†ä¸€ä¸ª <code>ready znode</code>  æœºåˆ¶ã€‚</p>\n",
            "tags": [
                "MIT6.824"
            ]
        },
        {
            "id": "https://songlinlife.top/2022/grimoireLab-%E5%B9%B3%E5%8F%B0%E7%AE%A1%E7%90%86%E7%BB%84%E4%BB%B6/",
            "url": "https://songlinlife.top/2022/grimoireLab-%E5%B9%B3%E5%8F%B0%E7%AE%A1%E7%90%86%E7%BB%84%E4%BB%B6/",
            "title": "grimoireLab: å¹³å°ç®¡ç†ç»„ä»¶",
            "date_published": "2022-02-27T12:18:08.000Z",
            "content_html": "<h3 id=\"mordred\"><a class=\"anchor\" href=\"#mordred\">#</a> Mordred</h3>\n<blockquote>\n<p>SirMordred is the tool used to coordinate the execution of the GrimoireLab platform, via two main configuration files, the  <code>setup.cfg</code>  and  <code>projects.json</code> , which are summarized in their corresponding sections.</p>\n</blockquote>\n<p>ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå·¥å…·æ˜¯ç®¡ç†å¹³å°ç”¨çš„ã€‚ä¸»è¦çš„é…ç½®æ–‡ä»¶æœ‰ä¸¤ä¸ª <code>Setup.cfg</code>  å’Œ <code>Projects.json</code> ã€‚</p>\n<h4 id=\"setupcfg\"><a class=\"anchor\" href=\"#setupcfg\">#</a> Setup.cfg</h4>\n<p>è¿™ä¸ªé…ç½®æ–‡ä»¶ç”¨äºç®¡ç† <code>GrimoireLab</code>  çš„ processesã€‚æ¯”å¦‚è®¾ç½® log æ—¥å¿—æ”¾åœ¨å“ªï¼ŒSortingHat å’Œ ElasticSearch æ€ä¹ˆè®¿é—®ï¼Œä¹Ÿå¯ä»¥è®¾ç½® Perceval çš„è®¿é—®ä»¤ç‰Œã€‚</p>\n<h4 id=\"projectsjson\"><a class=\"anchor\" href=\"#projectsjson\">#</a> Projects.json</h4>\n<blockquote>\n<p>The projects.json aims at describing the repositories grouped by a project that will be shown on the dashboards.</p>\n</blockquote>\n<p>ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªé…ç½®æ–‡ä»¶ç”¨äºé…ç½® repos æ˜¯å¦‚ä½•è¢« grouped by a project ç„¶ååœ¨ dashboard ä¸Šæ˜¾ç¤ºçš„ã€‚</p>\n<h3 id=\"grimoirelab-toolkit\"><a class=\"anchor\" href=\"#grimoirelab-toolkit\">#</a> grimoirelab-toolkit</h3>\n<p>grimoirelab projects ç»å¸¸ç”¨åˆ°çš„åŒ…ï¼Œæ¯”å¦‚å¤„ç†æ—¥æœŸçš„å‡½æ•°ã€‚</p>\n<h3 id=\"grimoirelab-bestiary\"><a class=\"anchor\" href=\"#grimoirelab-bestiary\">#</a> grimoirelab-bestiary</h3>\n<blockquote>\n<p>A tool to visually manage software development ecosystems description.</p>\n</blockquote>\n<p>ç”¨äºç›´è§‚æè¿°è½¯ä»¶å¼€å‘ç”Ÿæ€çš„å·¥å…·ã€‚</p>\n<h3 id=\"hatstall\"><a class=\"anchor\" href=\"#hatstall\">#</a> Hatstall</h3>\n<blockquote>\n<p>Hatstall is a web interface for <span class=\"exturl\" data-url=\"aHR0cDovL2dpdGh1Yi5jb20vZ3JpbW9pcmVsYWIvc29ydGluZ2hhdA==\">SortingHat</span> databases developed mainly with <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZGphbmdvcHJvamVjdC5jb20v\">Django</span></p>\n</blockquote>\n<p>å°±æ˜¯ SortingHat çš„ Web æ¥å£ã€‚</p>\n<p>SortingHat åšçš„å·¥ä½œï¼š</p>\n<ul>\n<li>they might be using several usernames in the same data source (i.e. different emails for git commits)</li>\n<li>to get a whole view, you need to take into account their contribution in different data sources (git, issues, chats, etc.). You need to merge multiple usernames under a single unique identity</li>\n<li>they might be working for several organizations during project life</li>\n</ul>\n<p>è€Œ Hatstall å°±æ˜¯å¤„ç† multi-identites æ›´ç®€å•çš„å·¥å…·ã€‚</p>\n",
            "tags": [
                "xlab"
            ]
        },
        {
            "id": "https://songlinlife.top/2022/grimoireLab-%E6%95%B0%E6%8D%AE%E6%B6%88%E8%B4%B9%E7%BB%84%E4%BB%B6/",
            "url": "https://songlinlife.top/2022/grimoireLab-%E6%95%B0%E6%8D%AE%E6%B6%88%E8%B4%B9%E7%BB%84%E4%BB%B6/",
            "title": "grimoireLab: æ•°æ®æ¶ˆè´¹ç»„ä»¶",
            "date_published": "2022-02-27T11:26:10.000Z",
            "content_html": "<h3 id=\"kibiter\"><a class=\"anchor\" href=\"#kibiter\">#</a> Kibiter</h3>\n<p><code>Kibiter</code>  å°±æ˜¯<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9jbi9raWJhbmEv\"> Kibana</span> çš„å®šåˆ¶åŒ– forkã€‚</p>\n<p>ä¸‹å›¾ä¸º kibanaï¼š</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220227192947022.png\" alt=\"image-20220227192947022\" /></p>\n<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªå°±æ˜¯ä¸€ä¸ªä»ªè¡¨ç›˜ã€‚ã€‚ã€‚</p>\n<h4 id=\"åŠŸèƒ½\"><a class=\"anchor\" href=\"#åŠŸèƒ½\">#</a> åŠŸèƒ½</h4>\n<h5 id=\"é¢æ¿èœå•\"><a class=\"anchor\" href=\"#é¢æ¿èœå•\">#</a> é¢æ¿èœå•</h5>\n<p><img data-src=\"https://camo.githubusercontent.com/5719bb8ee2bd3caadb0293bc6c2a4e56c8571ec10dc173b2886d548b32614281/68747470733a2f2f692e696d6775722e636f6d2f36684f346145562e706e67\" alt=\"img\" /></p>\n<h5 id=\"new-visualization-plugins\"><a class=\"anchor\" href=\"#new-visualization-plugins\">#</a> New visualization plugins</h5>\n<p><code>Kibiter</code>  é»˜è®¤å®‰è£…äº†ä¸€äº›å¯è§†åŒ–æ’ä»¶ï¼Œæ¯”å¦‚ Network pluginï¼Œå…è®¸ç”¨æˆ·é€šè¿‡å›¾æ–¹å¼æŸ¥çœ‹æ•°æ®ã€‚</p>\n<h3 id=\"sigils\"><a class=\"anchor\" href=\"#sigils\">#</a> sigils</h3>\n<p>è¿™ä¸ªå°±æ˜¯ä¸€ä¸ª Json æ–‡ä»¶å¤¹ï¼ŒåŒ…å«äº†æ‰€æœ‰å…³äº kibana dashboard çš„ä¿¡æ¯ã€‚</p>\n<ul>\n<li>Original indexes where the information come from.</li>\n<li>Searches on those indexes that provide a sub-set of the information.</li>\n<li>Widgets either built on top of the original indexes or on top of the searches.</li>\n<li>Final panels that are an aggregation of several widgets.</li>\n</ul>\n<p>è¿™å°±è¯´å°±æ˜¯å…³äº Dash Board çš„é…ç½®ã€‚</p>\n<h3 id=\"kidash\"><a class=\"anchor\" href=\"#kidash\">#</a> Kidash</h3>\n<p>è¿™ä¸ªå°±æ˜¯ç®¡ç† Kibana-related dashboards çš„å‘½ä»¤è¡Œå·¥å…·ã€‚</p>\n<h3 id=\"manuscripts\"><a class=\"anchor\" href=\"#manuscripts\">#</a> Manuscripts</h3>\n<p>è¿™ä¸ªç»„ä»¶ç”¨äºè‡ªåŠ¨ç”Ÿæˆ enrich æ•°æ®çš„ Reportã€‚</p>\n",
            "tags": [
                "xlab"
            ]
        },
        {
            "id": "https://songlinlife.top/2022/grimoireLab-%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%BC%BA%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6/",
            "url": "https://songlinlife.top/2022/grimoireLab-%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%BC%BA%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6/",
            "title": "grimoireLab: æ•°æ®å¢å¼ºç›¸å…³ç»„ä»¶",
            "date_published": "2022-02-27T09:39:07.000Z",
            "content_html": "<h3 id=\"grimoireelk\"><a class=\"anchor\" href=\"#grimoireelk\">#</a> GrimoireELK</h3>\n<p><code>GrimoireELK</code>  å°±æ˜¯ä¸€ä¸ªæ•°æ®å¢å¼ºç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶åŸºäº ElasticSearchã€‚è¿™ä¸ªç»„ä»¶çš„ä½œç”¨æœ‰ä¸¤ä¸ªã€‚</p>\n<ol>\n<li>å­˜å‚¨ <code>perceval</code>  è·å¾—çš„æ•°æ®ï¼Œè¿™æ ·å°±ä¸ç”¨åå¤æ‹‰å–ã€‚</li>\n<li>å¯¹åŸæ¥çš„æ•°æ®è¿›è¡ŒåŠ å·¥å’Œ enrichï¼Œä½¿å…¶èƒ½è¢« K ä» bit è€Œä½¿ç”¨ã€‚</li>\n</ol>\n<p>å…³äº raw æ•°æ®å’Œ enrich æ•°æ®å¯ä»¥ç›´æ¥æŸ¥çœ‹ https://github.com/chaoss/grimoirelab-elkï¼Œè¿™é‡Œä¸å¤šæè¿°ã€‚</p>\n<h3 id=\"ceres\"><a class=\"anchor\" href=\"#ceres\">#</a> Ceres</h3>\n<p><code>Ceres</code>  å°±æ˜¯ä¸€ä¸ªæ•°æ®è§£æå·¥å…·ï¼Œä»–è´Ÿè´£è§£æä» <code>perceval</code>  è·å–å¾—åˆ°çš„æ•°æ®ã€‚</p>\n<p>å®ƒçš„å·¥ä½œé€»è¾‘å¦‚ä¸‹ï¼š</p>\n<h4 id=\"eventize\"><a class=\"anchor\" href=\"#eventize\">#</a> Eventize</h4>\n<p><code>perceval</code>  ä¼šäº§ç”Ÿ JSON æ ¼å¼çš„æ•°æ®ï¼Œè€Œ ceres åšçš„å°±æ˜¯ <code>split</code> ã€‚é€šè¿‡ <code>eventizing</code> ï¼Œceres å°† json æ–‡ä»¶è¾¨æä¸º Pandas çš„ DataFrame æ ¼å¼ã€‚ceres æœ‰ä¸¤ç§è§£æç¨‹åº¦ï¼Œè¿™ä¸ªåç»­å†çœ‹ã€‚</p>\n<h4 id=\"format\"><a class=\"anchor\" href=\"#format\">#</a> Format</h4>\n<p>format åŠŸèƒ½å°±æ˜¯æ ¼å¼è½¬æ¢ï¼Œæ¯”å¦‚å°†æ—¶é—´ä» string è½¬æ¢ä¸º Date æ ¼å¼ã€‚</p>\n<h4 id=\"filter\"><a class=\"anchor\" href=\"#filter\">#</a> Filter</h4>\n<p>filter å¯ä»¥ç”¨äºè¿‡æ»¤æŸä¸€è¡Œçš„ä¿¡æ¯ã€‚</p>\n<h4 id=\"data-enrich\"><a class=\"anchor\" href=\"#data-enrich\">#</a> Data Enrich</h4>\n<p>æ•°æ®å¢å¼ºï¼Œè™½ç„¶æˆ‘ä¸çŸ¥é“å®ƒæ˜¯æ€ä¹ˆåšåˆ°çš„ã€‚</p>\n<h3 id=\"sorting-hat\"><a class=\"anchor\" href=\"#sorting-hat\">#</a> Sorting Hat</h3>\n<blockquote>\n<p>A tool to manage identities.</p>\n</blockquote>\n<p>è¿™æ˜¯ç®€ä»‹å¯¹äº Sorting Hat çš„æè¿°ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯å¤„ç† identities çš„ã€‚ä½†æ˜¯ç®€ä»‹å¥½åƒæ²¡æœ‰è¯´è¿™ä¸ª identities åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œå¥½åƒåªè¯´æœ‰å”¯ä¸€ uuidï¼Œå¯¹äºæ¯ä¸€ç‹¬ç‰¹çš„ identity å¯ä»¥å®šä¹‰ä¸€ä¸ª profileã€‚</p>\n<p>identity å¯ä»¥å¯¹åº”ä¸åŒæ—¶é—´æ®µçš„ä»å±å…³ç³»ã€‚</p>\n<p>Sorting Hat ä½¿ç”¨ Perceval çš„æ£€ç´¢æ•°æ®ï¼Œå¹¶æŠŠè·å¾—çš„ identities ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</p>\n<p>è¿™ç©æ„çš„ç”¨æ³•æˆ‘è¿˜æ˜¯æ²¡æ€ä¹ˆææ‡‚ï¼Œidentites å’Œ profile åˆ°åº•æ€ä¹ˆæï¼Ÿ</p>\n",
            "tags": [
                "xlab"
            ]
        },
        {
            "id": "https://songlinlife.top/2022/MIT6-824-lab2-Raft/",
            "url": "https://songlinlife.top/2022/MIT6-824-lab2-Raft/",
            "title": "MIT6.824: lab2 Raft",
            "date_published": "2022-02-26T03:38:28.000Z",
            "content_html": "<p>é¦–å…ˆæˆ‘æ˜¯è¯»äº†è®ºæ–‡ä¹‹åå†å†™è¿™ä¸ª lab çš„ï¼Œä½† raft è®ºæ–‡çš„å†…å®¹å¤ªå¤šäº†ï¼Œåªèƒ½æ…¢æ…¢ä¸€ç‚¹ç‚¹çœ‹ã€‚ç°åœ¨è¿˜æ˜¯å…ˆæŠŠ lab å®Œæˆã€‚</p>\n<p>å¼ºçƒˆå®‰åˆ©ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvbFViVkJWenZOVnhoZ2JjSFFCYmtrUQ==\">https://mp.weixin.qq.com/s/lUbVBVzvNVxhgbcHQBbkkQ</span></p>\n<h3 id=\"part-2a\"><a class=\"anchor\" href=\"#part-2a\">#</a> Part 2A</h3>\n<p><strong>ä»»åŠ¡è¦æ±‚</strong>ï¼šå®ç°é€‰ä¸¾ç®—æ³•å’Œå¿ƒè·³åŒ…ã€‚å¦‚æœæ—§çš„ leader æ²¡æœ‰é—®é¢˜å°±è®©æ—§çš„ leader ç»§ç»­æ‰§è¡Œï¼Œå¦‚æœæ—§çš„ leader æœ‰é—®é¢˜é‚£ä¹ˆå°±é€‰ä¸¾æ–°çš„ leaderã€‚</p>\n<p>è¿™æ„å‘³ç€æˆ‘ä»¬ä¸ç”¨è®¾ç½® normal termï¼Œåªè¦è€ƒè™‘ leader fail è¿™ç§æƒ…å†µã€‚</p>\n<p><strong>ä»»åŠ¡æç¤º</strong>ï¼š</p>\n<ul>\n<li>å®Œæˆ <code>raft.go</code></li>\n<li>å®Œæˆ <code>RequestVote</code>   RPC</li>\n<li>å®ç° <code>AppendEntries</code>  RPC</li>\n<li>æ³¨æ„ä¸è¦å‘ç”ŸåŒæ—¶è¿›è¡Œé€‰ä¸¾çš„æƒ…å†µã€‚</li>\n<li>è¦æ±‚ leader å‘ç”Ÿå¿ƒè·³åŒ…æ¯ç§’ä¸è¶…è¿‡ 10 æ¬¡ã€‚</li>\n<li>è¦æ±‚æ—§çš„ leader fail 5 ç§’å†…å®Œæˆé€‰ä¸¾ã€‚</li>\n<li>å› ä¸º tester æ—…ç¨‹æ¯ç§’åªèƒ½å‘é€ 10 æ¬¡å¿ƒè·³ï¼Œæ‰€ä»¥ election timeout å¿…é¡»è¦å¤§äº paper é‡Œæè¿°çš„ 150-300ã€‚</li>\n</ul>\n<h3 id=\"part2b\"><a class=\"anchor\" href=\"#part2b\">#</a> Part2B</h3>\n<hr />\n<h4 id=\"33æ›´æ–°\"><a class=\"anchor\" href=\"#33æ›´æ–°\">#</a> 3.3 æ›´æ–°</h4>\n<p>æˆ‘çœŸçš„æƒ³å¹²æ­»ä»–å¦ˆäº†ï¼ŒæŠ˜è…¾äº†å¥½å‡ å¤©ç»ˆäºæ— ä¼¤æ‰“è¿‡ LAB2Bï¼Œè¿è¡Œ 100 æ¬¡ä¹Ÿæ²¡æœ‰å‡ºé”™ï¼Œè¿™é‡Œé¢çš„å‘ç‚¹çœŸçš„å¾ˆå¤šã€‚</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220303115450291.png\" alt=\"image-20220303115450291\" /></p>\n<p>é¦–å…ˆéœ€è¦æ˜ç¡® committed æ˜¯å¦‚ä½•è¢«ç¡®è®¤çš„ï¼š</p>\n<p>å¯¹äº leader æ¥è¯´ï¼š<strong>nextIndex -&gt; matchIndex -&gt; commitIndex -&gt; applyIndex</strong></p>\n<blockquote>\n<p>If there exists an N such that N &gt; commitIndex, a majority of matchIndex[i] â‰¥ N, and log[N].term == currentTerm:  set commitIndex = N</p>\n</blockquote>\n<p>åˆšå¼€å§‹æˆ‘ä¹Ÿæä¸æ‡‚è¿™ä¸ª <code>matchIndex</code>  æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œleader æ˜¯é€šè¿‡ check majority matchIndex å¹¶ä¸”å¦‚æœè¯¥ log entry å±äºå½“å‰ term å°±ç¡®è®¤ committedã€‚</p>\n<p>å¯¹äº follower: **preLogIndex -(åŒ¹é…æˆåŠŸ)&gt; len (logs) -compart with leadercommitted&gt; commitIndex -&gt; applyIndex **</p>\n<p><strong>commitIndex = min(len(logs) , leaderCommitted</strong></p>\n<p>å¯¹äº follower æ¥è¯´å¯ä»¥æ˜¯ leader å‘ŠçŸ¥ committedï¼Œä¹Ÿå¯ä»¥æ˜¯é€šè¿‡ append log åè‡ªå·±ç¡®è®¤ï¼Œæ€»ä¹‹è¿™ä¸ªè¿‡ç¨‹é€»è¾‘è‡ªæ´½ã€‚</p>\n<p>ä½†æ˜¯è¿™ä¸ªæœ‰ä¸€ä¸ªå¾ˆä¸¥é‡çš„å‘ç‚¹ï¼Œä¼šå¯¼è‡´æ—¶ä¸æ—¶å‡ºç° <strong>index out of range</strong> è¿™ä¸ªé”™è¯¯ã€‚è¿™ä¸ªé”™è¯¯å…¶å®æœ‰åœ¨ raft guide ä¸Šå†™æ˜ï¼Œä½†æ˜¯æˆ‘å½“æ—¶å¹¶æ²¡æœ‰çœ‹æ‡‚ï¼Œå¯¼è‡´æ‰§è¡Œ 100 æ¬¡æ€»æœ‰å‡ æ¬¡æŠ¥è¿™ä¸ª out of range é”™è¯¯ã€‚ã€‚ã€‚ã€‚</p>\n<p>å‡ºç°è¿™ä¸ªé—®é¢˜çš„åŸå› å°±æ˜¯ follower åº”ç”¨äº† stale AppendEntries PRCï¼Œç„¶åç»™ leader å‘é€äº† reply success = trueã€‚å› ä¸º leader ä¼šé‡å¤å‘é€ AppendEntries PRCï¼Œå¦‚æœæŸä¸ª AppendEntries PRC è¿”å› true åï¼Œleader å°±ä¼šæ‰§è¡Œï¼š<strong>nextIndex[server] += len(args.entries)</strong>ï¼Œè¿™å°±å¯¼è‡´æœ‰æ—¶å€™ leader ä¼šå°†ç›¸åŒçš„ AppendEntries PRC åº”ç”¨ä¸¤æ¬¡åï¼ŒnextIndex [server] += len (args.entries) ä¹Ÿæ‰§è¡Œä¸¤æ¬¡ã€‚æœ€åå¯¼è‡´ nextIndex [server] è¦è¶…è¿‡äº† log çš„é•¿åº¦ã€‚</p>\n<p>è§£å†³æ–¹æ³•ï¼š</p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>last <span class=\"token operator\">:=</span> rf<span class=\"token punctuation\">.</span>logs<span class=\"token punctuation\">[</span>args<span class=\"token punctuation\">.</span>PrevLogIndex<span class=\"token operator\">+</span><span class=\"token number\">1</span> <span class=\"token punctuation\">:</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>rf<span class=\"token punctuation\">.</span>logs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// éš¾ç‚¹åœ¨äºå¦‚ä½•åˆ¤æ–­æ—§çš„ rpc</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>last<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">.</span>Entries<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>last<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// åˆ¤æ–­è¦ append çš„ log entries æ˜¯ä¸æ˜¯å·²ç» append ä¸Šäº†</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    flag <span class=\"token operator\">:=</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">for</span> i <span class=\"token operator\">:=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>last<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">if</span> last<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>TermNumber <span class=\"token operator\">!=</span> args<span class=\"token punctuation\">.</span>Entries<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>TermNumber <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            flag <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">break</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">if</span> flag <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        reply<span class=\"token punctuation\">.</span>XTerm <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">2</span> <span class=\"token comment\">// è¡¨ç¤ºè¿™ä¸ªæ˜¯è¿‡æ—¶çš„ rpc</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ä¸ªå¾ˆä¸¥é‡çš„å‘ç‚¹ï¼Œå°±æ˜¯é€‰ä¸¾è¶…æ—¶é‡ç½®ï¼Œå®ƒä¼šå¯¼è‡´<strong> rejoin of partitioned leader <em>...</em></strong> è¿™ä¸ªæµ‹è¯•æ—¶ä¸æ—¶å¤±è´¥ï¼Œè¿™æ˜¯å› ä¸ºé€‰ä¸¾ä¸å½“ï¼Œå¯¼è‡´ cluster æ²¡æœ‰åŠæ—¶é€‰ä¸¾å‡º leaderã€‚</p>\n<p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œä»€ä¹ˆæ—¶å€™æ‰ä¼šé‡ç½® election timeoutï¼š</p>\n<ul>\n<li>å½“ follower å‡çº§ä¸º candidate æ—¶ä¼šé‡ç½®ã€‚</li>\n<li>å½“ follower æŠ•å‡ºè‡ªå·±çš„ä¸€ç¥¨æ—¶ä¼šé‡ç½®ã€‚</li>\n<li>å½“ follower æ¥å—åˆ° leader çš„ appendEntries PRC æ—¶ä¼šé‡ç½®ã€‚</li>\n</ul>\n<p>ç¬¬ä¸€ç§æƒ…å†µå¾ˆç®€å•ï¼Œå°±æ˜¯å› ä¸ºè¶…æ—¶æ‰ä¼šå‡çº§ä¸º candidateï¼Œæ‰€ä»¥æˆä¸º candidate åå¿…é¡»é‡ç½®ã€‚</p>\n<p>ç¬¬äºŒæƒ…å†µæœ‰äº›å¤æ‚ï¼Œå¦‚æœä¸€ä¸ª leader æˆ–è€… candidate æ¥å—åˆ°ä¸€ä¸ª vote requestï¼Œå…¶ä¸­ rf.currentTerm &lt; args.Termã€‚è¿™è¯´æ˜è¯¥ leader æˆ–è€… candidate å·²ç» out of dateï¼Œå¿…é¡»å¼ºåˆ¶è½¬æ¢ä¸º followerï¼Œæ³¨æ„ï¼Œå¼ºåˆ¶è½¬æ¢ä¸º follower å¹¶ä¸ä»£è¡¨å®ƒå¯ä»¥é‡ç½®å®ƒè‡ªèº«çš„ election timeoutã€‚åªæœ‰æ»¡è¶³ä¸¥æ ¼é€‰ä¸¾è¦æ±‚ï¼ŒæŠŠè‡ªå·±çš„ç¥¨æŠ•å‡ºå»åæ‰å¯ä»¥é‡ç½®ã€‚follower åœ¨æ¯ä¸€ä¸ª Term æœ‰ä¸”åªæœ‰ä¸€å¼ é€‰ç¥¨ï¼ä½† server è¿›è¡Œ term æå‡åå°±å¯ä»¥åˆ†é…ä¸€å¼ æ–°é€‰ç¥¨ã€‚</p>\n<p>ç¬¬ä¸‰ç§æƒ…å†µå…¶å®å’Œç¬¬äºŒç§æƒ…å†µç±»ä¼¼ï¼ŒappendEntries PRC åªèƒ½ç”± leader å‘å‡ºï¼Œä¸€æ—¦å½“å‰ server ç¡®è®¤å…¶è‡ªèº«çš„ currentTerm &lt;= args.Term å°±ä¼šæŠŠé€‰ä¸¾æ—¶é—´é‡ç½®ã€‚</p>\n<p>åªè¦æ³¨æ„è¿™ä¸¤ä¸ªé—®é¢˜ï¼šæ—§ AppendEntries å’Œ election timeoutï¼Œå°±å¯ä»¥è½»æ¾ pass all test äº†ï¼</p>\n<h3 id=\"part-2c\"><a class=\"anchor\" href=\"#part-2c\">#</a> Part 2C</h3>\n<p>è¿™ä¸ª lab è¦æ±‚æˆ‘ä»¬å®ç° persistenceã€‚</p>\n<h4 id=\"33æ›´æ–°-2\"><a class=\"anchor\" href=\"#33æ›´æ–°-2\">#</a> 3.3 æ›´æ–°</h4>\n<p>æ— ä¼¤é€šå…³ï¼Œå°±å¾ˆ niceï¼</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220303191029815.png\" alt=\"image-20220303191029815\" /></p>\n<p>æ‰§è¡Œè¶…è¿‡ 100 æ¬¡ï¼Œä»ç„¶è¿™ä¹ˆåšæŒºï¼å¤ªä½©æœæˆ‘è‡ªå·±äº†ï¼Œå˜¿å˜¿ğŸ˜„</p>\n<p>è¿™ä¸ªåŸºæœ¬æ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯å®ç° <code>persist</code> ï¼Œç„¶åæŠŠ <code>persist()</code>  æ’å…¥åˆ° persist state å˜æ¢çš„åœ°æ–¹ï¼Œé€šè¿‡ figure 2 ä¸éš¾çŸ¥é“ï¼š</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220303172723928.png\" alt=\"image-20220303172723928\" /></p>\n<p>åªè¦è¿™ä¸‰ä¸ªå˜é‡æ”¹å˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±æ’å…¥ <code>persist</code> ã€‚</p>\n<p>ä½†æ˜¯è¿™é‡Œä¹Ÿæœ‰ä¸€ä¸ªå‘ç‚¹ï¼Œè¿™å°± appendEntries RPC ä¼šå› ä¸ºç½‘ç»œå‡ºé”™ï¼Œä¸‹é¢æˆ‘æ¥æè¿°ä¸€ä¸‹å‡ºé”™æƒ…å¢ƒï¼š</p>\n<p>é¦–å…ˆæ˜ç¡®ï¼Œå› ä¸ºæˆ‘ä»¬ä¼šä¸æ–­é‡å¤å‘ AppendEntries RPCï¼Œè¿™å°±å¯¼è‡´ follower éœ€è¦æ£€æŸ¥ï¼Œè¿™ä¸ª AppendEntries RPC æ˜¯å¦å·²ç»è¿‡æ—¶ï¼Œå¦‚æœè¿‡æ—¶å°±è¿”å› falseï¼Œå¦‚æœæ²¡è¿‡æ—¶å°±è¿”å› true</p>\n<h5 id=\"testfigure8unreliable2cæŠ¥é”™è¿”å›trueçš„appendentriesrpcä¸¢å¤±é—®é¢˜\"><a class=\"anchor\" href=\"#testfigure8unreliable2cæŠ¥é”™è¿”å›trueçš„appendentriesrpcä¸¢å¤±é—®é¢˜\">#</a> TestFigure8Unreliable2C æŠ¥é”™ï¼Œè¿”å› true çš„ AppendEntriesRPC ä¸¢å¤±é—®é¢˜</h5>\n<p>åŸå› åœ¨äºï¼Œleader é¦–å…ˆå‘é€äº†ä¸€ä»½ entriesï¼Œfollower é€šè¿‡ AppendEntries æ”¶åˆ°äº†è¿™ä»½ Entriesã€‚follower æ£€æŸ¥åˆ°è¿™ä¸ª AppendEntries ä¸­æºå¸¦çš„ Entries æ²¡æœ‰è¢« Append åˆ°è‡ªå·±çš„ logs ä¸­ï¼Œäºæ˜¯å®ƒ appendï¼Œå¹¶è¿”å› trueã€‚ä½†æ˜¯è¿™ä¸ªæœ¬è¯¥è¿”å› true çš„ AppendEntries RPC å› ä¸ºç½‘ç»œæ²¡æœ‰è¿”å›ï¼ˆæ°¸ä¹…ä¸¢å¤±ï¼Œæˆ–è€…è¿”å›å¾ˆæ…¢ï¼Œleader è¶…æ—¶ä¸å†æ¥å—ï¼‰ï¼Œleader äºæ˜¯åˆé‡æ–°å‘é€äº†ä¸€ä»½ç›¸åŒçš„ Entriesã€‚follower æ£€æŸ¥åˆ°è¿™ä¸ª AppendEntries ä¸­æºå¸¦çš„ Entries ä¹‹å‰å·²ç» Append è¿‡äº†ï¼Œäºæ˜¯å®ƒè¿”å›ç»™ leader falseã€‚leader æ”¶åˆ° false åäºæ˜¯é‡å¤å‘é€ï¼Œäºæ˜¯æ•´ä¸ªç³»ç»Ÿé™·å…¥äº† <code>living lock</code> ã€‚</p>\n<p><strong>è§£å†³åŠæ³•</strong>ï¼šå½“ follower æ£€æµ‹åˆ° stale AppendEntriesRPC æ—¶ï¼Œå®ƒå‘Šè¯‰ leaderï¼Œè¿™ä¸ª RPC è¿‡æ—¶äº†ï¼Œå¹¶ä¸”åŒæ—¶è¿”å› follower è‡ªå·±çš„ <code>len(logs)</code>  ä¹Ÿå°±æ˜¯ <code>XIndex</code> ã€‚leader æ£€æŸ¥åˆ°è¿‡æ—¶çš„ RPCï¼Œå®ƒé€šè¿‡æ£€æŸ¥ <code>reply.XIndex == len(args.Entris) + rf.nextIndex[server]</code>  ï¼Œå¦‚æœæ»¡è¶³è¯´æ˜å®ƒæ²¡æœ‰æ¥å—åˆ°é‚£ä¸ªè¿”å› true çš„ AppendEntriesï¼Œäºæ˜¯å®ƒå°† <code>rf.nextIndex[server] = reply.Xindex</code> ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿè§£å†³è¿”å› true çš„ AppendEntriesRPC ä¸¢å¤±é—®é¢˜ã€‚</p>\n<h5 id=\"unreliable-churn-out-of-range-é—®é¢˜\"><a class=\"anchor\" href=\"#unreliable-churn-out-of-range-é—®é¢˜\">#</a> unreliable churn out of range é—®é¢˜</h5>\n<p>åŸå› åœ¨äºï¼Œç½‘ç»œå¤ªæ··ä¹±äº†ã€‚åœ¨ä¸Šé¢æˆ‘ä»¬æåˆ°ï¼Œè¿”å› true çš„ AppendEntriesRPC ä¼šå› ä¸ºç½‘ç»œä¸¢å¤±ï¼Œç„¶å leader ä¸€ç›´é™·å…¥æ´»é”ã€‚æˆ‘ä»¬çš„è§£å†³åŠæ³•æ˜¯å‘Šè¯‰ leaderï¼Œè¿™ä¸ª AppendEntries è¿‡æ—¶äº†ï¼Œleader æ¥æ£€æŸ¥éœ€ä¸éœ€è¦ä¿®æ”¹ <code>rf.nextIndex</code> ã€‚</p>\n<p>ä½†æ˜¯ï¼ï¼ï¼</p>\n<p>ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œå› ä¸ºç½‘ç»œå¾ˆä¹±ï¼Œå¦‚æœ stale appendEntriesRPC è¦æ¯”é‚£ä¸ªè¿”å› true çš„ AppendEntriesRPC å…ˆè¿”å›å‘¢ï¼Ÿleader å¯¹äº stale AppendEntriesRPCï¼Œå®ƒä¼šè®¤ä¸ºè‡ªå·±ä¹‹å‰çš„é‚£ä¸ªè¿”å› True çš„ AppendEntriesRPC ä¸¢å¤±äº†ã€‚äºæ˜¯ leader ä¿®æ”¹äº†è‡ªå·±çš„ nextIndexã€‚ä½†æ˜¯é‚£ä¸ªè¿”å› true çš„ AppendEntries å› ä¸ºç½‘ç»œè¿˜å¯ä»¥ï¼Œæœ€åè¿˜æ˜¯æˆåŠŸè¿”å›äº†ã€‚leader äºæ˜¯åˆä¿®æ”¹äº†è‡ªå·±çš„ <code>nextIndex</code> ã€‚è¿™å°±å¯¼è‡´äº† out of range çš„å‡ºç°ï¼Œå¹¶ä¸”è¿™ä¸ªé—®é¢˜æ˜¯å¶å‘æ€§çš„ï¼Œå› ä¸ºè¿™å±äºç½‘ç»œä¸­çš„æç«¯æƒ…å†µã€‚</p>\n<p>æˆ‘ä»¬çš„è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼Œå¦‚æœ leader è¦ä¿®æ”¹è‡ªå·±çš„ nextIndexï¼Œå¿…é¡»æ»¡è¶³ï¼š</p>\n<p><code>reply.XIndex == len(args.Entries) + rf.nextIndex[server]</code></p>\n<h5 id=\"testfigure8unreliable2cç¨€æœ‰out-of-range\"><a class=\"anchor\" href=\"#testfigure8unreliable2cç¨€æœ‰out-of-range\">#</a> TestFigure8Unreliable2C ç¨€æœ‰ out of range</h5>\n<p>å› ä¸ºæˆ‘çš„ log æ—¥å¿—çš„ index æ˜¯ä» 1 å¼€å§‹çš„ï¼Œäºæ˜¯åœ¨åˆå§‹åŒ–æ—¶å€™ï¼Œæˆ‘ä¼šé»˜è®¤å°† index = 0 è®¾ç½®ä¸º 0ï¼Œ applyindex =0 , commitIndex= 0ã€‚</p>\n<p>ä½†æ˜¯åœ¨è®¾ç½® nextIndexï¼Œå› ä¸ºæ—¥å¿—ä¸åŒ¹é…ï¼Œæˆ‘å°±éœ€è¦éå†æ‰¾åˆ°æœ€ä¼˜çš„ Indexï¼Œä½†æ˜¯è¿™é‡Œæˆ‘çš„éå†æ¡ä»¶æ˜¯ï¼š</p>\n<p><code>for i = len(rf.logs) - 1; i &gt;= 0; i--</code></p>\n<p>è¿™å°±ä¼šå¯¼è‡´åœ¨å¾ˆç½•è§çš„æƒ…å†µä¸‹ï¼Œi ä¼šè¢«å½’ä¸º 0ï¼Œè€Œæˆ‘ä»¬ç”¨ 0 ç»™ nextIndex èµ‹å€¼ï¼Œå°±å¯¼è‡´ preLogIndex å˜æˆäº† - 1ã€‚è¿™å°±ä¼šå‡ºç° out of rangeã€‚ä½†è¿™ä¸ªæƒ…å†µå¾ˆå°‘è§ï¼Œ100 æ¬¡é‡Œèƒ½å‡ºç° 1 æ¬¡ï¼Ÿ</p>\n<p>æ”¹æˆï¼š <code>for i = len(rf.logs) - 1; i &gt;= 1; i--</code>  å°±è¡Œäº†ã€‚</p>\n<p><strong>éƒ½æ˜¯ç»†èŠ‚ï¼çœŸçš„å¤ªç»†äº†ã€‚ã€‚ã€‚ã€‚</strong></p>\n<h3 id=\"part2d\"><a class=\"anchor\" href=\"#part2d\">#</a> Part2D</h3>\n<p>è¿™ä¸ª lab è¦æ±‚æˆ‘ä»¬å®Œæˆ log compactionã€‚</p>\n<p>éœ€è¦å®ç° <code>Snapshot(index int, snapshot []byte)</code> ï¼Œtester æ¥å®šæœŸè°ƒç”¨ã€‚</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220303200330913.png\" alt=\"image-20220303200330913\" /></p>\n<h4 id=\"æ— ä¼¤é€šå…³34æ›´æ–°\"><a class=\"anchor\" href=\"#æ— ä¼¤é€šå…³34æ›´æ–°\">#</a> æ— ä¼¤é€šå…³ï¼ï¼ï¼ï¼ï¼ï¼ˆ3.4 æ›´æ–°ï¼‰</h4>\n<p>ç»ˆäºæ— ä¼¤é€šå…³äº† lab2 äº†ï¼ŒçœŸçš„æœäº†æˆ‘è‡ªå·±äº†ï¼Œåªç”¨äº†ä¸€ä¸ªç¤¼æ‹œå°±ææ‡‚äº† raftï¼Œç°åœ¨æˆ‘å¯ä»¥è¯´æˆ‘æ˜¯æ‡‚ä¸€äº›åˆ†å¸ƒå¼çŸ¥è¯†äº†ï¼ŒçœŸçš„èˆ’æœå•Šã€‚æˆ‘å°±æ˜¯å¤©æ‰ï¼yesï¼happyï¼</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220304214412025.png\" alt=\"image-20220304214412025\" /></p>\n<p>æ‰¹é‡æµ‹è¯•è¿˜åœ¨è·‘ï¼Œä½†æ˜¯é—®é¢˜ä¸å¤§ï¼Œå˜¿å˜¿ã€‚</p>\n<p>2D å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯éœ€è¦å°†åŸæ¥çš„ç´¢å¼•è¿›è¡Œæ›¿æ¢ï¼Œæˆ‘çš„é€‰æ‹©æ˜¯å†™ä¸¤ä¸ªè½¬æ¢å‡½æ•°ï¼š</p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>rf <span class=\"token operator\">*</span>Raft<span class=\"token punctuation\">)</span> <span class=\"token function\">Convert</span><span class=\"token punctuation\">(</span>index <span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">int</span> <span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token keyword\">return</span> index <span class=\"token operator\">-</span> rf<span class=\"token punctuation\">.</span>lastIncludedIndex</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>rf <span class=\"token operator\">*</span>Raft<span class=\"token punctuation\">)</span> <span class=\"token function\">Reconvert</span><span class=\"token punctuation\">(</span>index <span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">int</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token keyword\">return</span> index <span class=\"token operator\">+</span> rf<span class=\"token punctuation\">.</span>lastIncludedIndex</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨åˆšå¼€å§‹æˆ‘çš„æƒ³æ³•æ˜¯ï¼Œå› ä¸ºæ¯ä¸€æ¬¡åš snap éƒ½ä¼šåˆ‡æ–­ logsï¼Œäºæ˜¯éœ€è¦è€ƒè™‘å¤„ç†ç©º log æ—¥å¿—çš„æƒ…å†µï¼Œä½†æ˜¯å…¶å®æ²¡æœ‰å¿…è¦ï¼Œå¦‚æœè€ƒè™‘ç©º log ä¼šå¯¼è‡´æ•´ä¸ªä»£ç é€»è¾‘å˜å¾—éå¸¸å¤æ‚ã€‚</p>\n<p>è§£å†³æ–¹æ³•ï¼šæ¯ä¸€æ¬¡åš snapshot å¾—åˆ°æ–°çš„ log æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨ logs å‰é¢æ’å…¥ä¸€ä¸ªç©º log entryï¼Œå¹¶ä¸”å®ƒçš„ term ç­‰äº <code>lastIncludeTerm</code> ã€‚äºæ˜¯æˆ‘ä»¬ä¹‹å‰å†™çš„ä»£ç å°±åªè¦ä¸€ç‚¹ç‚¹æ”¹å˜ã€‚</p>\n<p>ç¬¬äºŒä¸ªå‘ç‚¹å°±æ˜¯ï¼Œé€‰æ‹©ä»€ä¹ˆæ—¶å€™è°ƒç”¨ Installsnapshotã€‚æˆ‘æœ€å¼€å§‹æƒ³çš„æ˜¯åœ¨ sendAppendEntries åœ¨è¿™ä¸ªå‡½æ•°çš„è¿”å›é€»è¾‘éƒ¨åˆ†è¿›è¡Œå¤„ç†ï¼Œä½†æ˜¯ç”±äº RPC æ˜¯å»ºç«‹åœ¨ UDP ä¸Šçš„ï¼Œæ•´ä¸ªç½‘ç»œå¼‚å¸¸æ··ä¹±ï¼Œå¯¼è‡´å¯èƒ½å¤šä¸ª Installsnapshot è°ƒç”¨ä¹‹é—´é¡ºåºå¾ˆä¹±ï¼Œä¸åˆ©äºæˆ‘ä»¬çš„æ€è€ƒã€‚</p>\n<p>è§£å†³åŠæ³•ï¼šæŠŠè°ƒç”¨ Installsnapshot æ”¾åˆ° heartbeat å‡½æ•°é‡Œï¼Œè®©æ¯ä¸€æ¬¡ heartbeat è€ƒè™‘è¦ä¸è¦è°ƒç”¨ installsnapshotã€‚</p>\n<h4 id=\"installsnapshot-rpc\"><a class=\"anchor\" href=\"#installsnapshot-rpc\">#</a> Installsnapshot RPC</h4>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220304215521240.png\" alt=\"image-20220304215521240\" /></p>\n<p>æŒ‰ç…§è¦æ±‚å®ç°è¿™ä¸ª RPC å°±è¡Œäº†ï¼Œéœ€è¦æ³¨æ„å› ä¸ºæ•´ä¸ªç½‘ç»œä¸å¯ä¿¡ï¼Œæˆ‘ä»¬éœ€è¦éªŒè¯è¿™ä¸ª InstallSnapshot æ˜¯å¦å·²ç»è¿‡æ—¶ã€‚</p>\n<h3 id=\"é—ç•™çš„é—®é¢˜\"><a class=\"anchor\" href=\"#é—ç•™çš„é—®é¢˜\">#</a> é—ç•™çš„é—®é¢˜</h3>\n<p>è¿™æ˜¯æˆ‘åšè¿™ä¸ª lab å‘ç°çš„ä¸€ä¸ªå¾ˆå¥‡å¦™çš„ç°è±¡ï¼Œä½†æˆ‘å®Œæˆäº† 2D çš„æ—¶å€™ï¼Œå›è¿‡å¤´æˆ‘æ£€æŸ¥ä¹‹å‰çš„ ABC æµ‹è¯•ï¼Œå‘ç° B æµ‹è¯•ä¸­çš„ *ğŸ˜— RPC byte count æµ‹è¯•å‡ºç° RPC byte count failedã€‚</p>\n<p>è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸ºï¼Œæ•´ä¸ªç½‘ç»œæ˜¯ UDP çš„ï¼Œä¼šå‡ºç°è¿™ä¹ˆä¸€ç§æƒ…å†µï¼šRPC åŒ…å‘å‡ºå»åï¼Œå› ä¸º UDP å¹¿æ’­ï¼Œè¢«è‡ªå·±ç«‹å³æ¥å—äº†ï¼Œå¹¶è¿”å›ã€‚è¿™æ ·å°±ä½¿å¾—æ•´ä¸ªç½‘ç»œå˜å¾—å¼‚å¸¸è‡ƒè‚¿ã€‚</p>\n<p>è¿™ä¸ª Bug å‡ºç°çš„åŸå› æ˜¯å› ä¸ºï¼Œæˆ‘åœ¨ä»£ç ä¸­å¢åŠ äº†è¿™æ ·ä¸€ä¸ªé€»è¾‘ï¼Œä¸€æ—¦æ£€æŸ¥åˆ°è‡ªå·±å‘å‡ºçš„ RPC åŒ…è¢«è‡ªå·±æ¥æ”¶åå°± returnã€‚</p>\n<p>ä½†æ˜¯æˆ‘è‡³ä»Šä¹Ÿæ²¡ææ‡‚ï¼Œä¸ºä»€ä¹ˆä¸è¡Œï¼</p>\n<p>è¿™ä¸ªé—®é¢˜ï¼Œæœªæ¥çš„æˆ‘ï¼Œä½ å¯ä»¥è§£å†³çš„å¯¹å§ï¼ŸğŸ˜</p>\n<h3 id=\"raft-basic\"><a class=\"anchor\" href=\"#raft-basic\">#</a> Raft Basic</h3>\n<p>å°† servers åˆ†ä¸ºä¸‰ç§çŠ¶æ€ï¼šleaderã€follower å’Œ candidateã€‚</p>\n<p>follower æ˜¯æ¶ˆæçš„ï¼Œä»–ä»¬åªèƒ½å“åº” leader æˆ–è€… candidate çš„è¯·æ±‚ã€‚candidate æ˜¯é€‰ä¸¾æ—¶äº§ç”Ÿçš„ã€‚</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220226123046018.png\" alt=\"image-20220226123046018\" /></p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220226123113136.png\" alt=\"image-20220226123113136\" /></p>\n<p>å°±åƒå›¾ä¸­æè¿°çš„ï¼Œterm åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ election å’Œ normalã€‚æ¯ä¸ª term éƒ½æœ‰å¯¹äºçš„ current term numberã€‚<strong>å¦‚æœ candidate æˆ–è€… leader å‘ç°ä»–çš„ term è¿‡æ—¶äº†ï¼Œé‚£ä¹ˆä»–ä»¬ä¼šè‡ªåŠ¨å˜ä¸º followsã€‚</strong></p>\n<p>RequestVote RPCs åœ¨é€‰ä¸¾æ—¶ç”± candidate è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶ä¸” AppendEntries RPCs è¢« leader åˆå§‹åŒ–ç”¨äºå¤åˆ¶ log entries å’Œæä¾› heartbeatï¼ˆå°±æ˜¯ç©ºçš„ AppendEntriesï¼‰ã€‚</p>\n<p><strong>è®°ä½ raft ä¸­çš„èŠ‚ç‚¹å…¶å®å°±æ˜¯çŠ¶æ€æœºï¼</strong></p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220228220844868.png\" alt=\"image-20220228220844868\" /></p>\n<p>è¿™é‡Œæˆ‘æœ‰ä¸€ä¸ªæƒ³æ³•ï¼Œå› ä¸ºæ˜¯ state machineï¼Œç”±äº raft å±‚è®°å½•äº† lastApplyï¼Œè€Œä¸” state machine åªèƒ½ apply committed entriesã€‚æ‰€æœ‰çš„æœºå­éƒ½ä¼š apply ç›¸åŒçš„ committed entriesã€‚å› æ­¤è¿™é‡Œå¯èƒ½ä¼šå‡ºç°é‡å¤å“åº”æƒ…å†µï¼Œæ¯”å¦‚ client å‘é€è¯·æ±‚ç»™ leaderï¼Œleader committed è¯·æ±‚åè¿”å›ç»™ client å“åº”ä¹‹åé©¬ä¸ŠæŒ‚æ‰äº†ï¼Œraft é€šè¿‡é€‰ä¸¾äº§ç”Ÿäº†æ–°çš„ leaderï¼Œé‚£ä¹ˆæ–°çš„ leader å¯èƒ½ä¼šè®© state machine é‡å¤ applyï¼Œä¹Ÿå°±æ˜¯é‡å¤å‘é€å“åº”ã€‚</p>\n<p><strong>ä½†æ˜¯è¿™æ²¡æœ‰é—®é¢˜ï¼é‡å¤æ˜¯ tcp å±‚åº”è¯¥è§£å†³çš„é—®é¢˜ã€‚</strong></p>\n<p>LastApply æ°¸è¿œåº”è¯¥å°äºæˆ–ç­‰äº committed indexï¼</p>\n<h3 id=\"leaderé€‰ä¸¾\"><a class=\"anchor\" href=\"#leaderé€‰ä¸¾\">#</a> Leader é€‰ä¸¾</h3>\n<p>server å¼€å¯ï¼Œåˆå§‹çŠ¶æ€ä¸º followerï¼Œå¹¶ä¸”å¦‚æœä»–æ”¶åˆ° <code>leader</code>  æˆ–è€… <code>candidate</code>  çš„æœ‰æ•ˆ RPCsï¼Œé‚£ä¹ˆå°±ä¼šä¸€ç›´ç»´æŒ followerã€‚å¦‚æœ follower åœ¨ election timeout å†…æ²¡æœ‰æ”¶åˆ°ä»»ä½• RPCsï¼Œé‚£ä¹ˆä»–å°±ä¼šå¢åŠ  current term å¹¶ä¸”æˆä¸º candidate å¼€å¯é€‰ä¸¾ã€‚</p>\n<h4 id=\"follower\"><a class=\"anchor\" href=\"#follower\">#</a> follower</h4>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220226150941941.png\" alt=\"image-20220226150941941\" /></p>\n<h4 id=\"candidate\"><a class=\"anchor\" href=\"#candidate\">#</a> candidate</h4>\n<p>é€šè¿‡ RequestVote RPC åŒæ—¶å‘é›†ç¾¤ä¸­æ‰€æœ‰çš„ server è¦æ±‚æŠ•ç¥¨ã€‚</p>\n<h5 id=\"requestvote-rpcçš„ç»“æ„\"><a class=\"anchor\" href=\"#requestvote-rpcçš„ç»“æ„\">#</a> RequestVote RPC çš„ç»“æ„ï¼š</h5>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220226150031701.png\" alt=\"image-20220226150031701\" /></p>\n<h5 id=\"candidateéœ€è¦åšçš„\"><a class=\"anchor\" href=\"#candidateéœ€è¦åšçš„\">#</a> candidate éœ€è¦åšçš„ï¼š</h5>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220226150232338.png\" alt=\"image-20220226150232338\" /></p>\n<p>è¿™é‡Œå…¶å®è¿˜å°‘äº›äº†ä¸€ä¸ªå¾ˆé‡è¦çš„æ¡ä»¶ï¼š</p>\n<blockquote>\n<p>Current terms are exchanged whenever servers communicate; if one serverâ€™s current term is smaller than the otherâ€™s, then it updates its current term to the larger value. If a candidate or leader discovers that its term is out of date, it immediately reverts to follower state. If a server receives a request with a stale term number, it rejects the request.</p>\n</blockquote>\n<p>ä¹Ÿå°±è¯´å¦‚æœ leader æˆ–è€… candidate å‘ç°æœ‰äººçš„ current term number æ¯”å®ƒçš„è¿˜è¦å¤§ï¼Œé‚£ä¹ˆå°±è‡ªåŠ¨å˜æˆ followerï¼Œè¿™ä¸ªç‰¹æ€§å¾ˆé‡è¦ï¼</p>\n<h4 id=\"å…³äºrandomized-election-timeouts\"><a class=\"anchor\" href=\"#å…³äºrandomized-election-timeouts\">#</a> å…³äº randomized election timeouts</h4>\n<p>è®ºæ–‡ä¸­æåˆ°ï¼š</p>\n<blockquote>\n<p>raft uses randomized election timeouts to ensure that split votes are rare and that they are resolved quickly.</p>\n</blockquote>\n<p>è¿™ä¸ªä¸€ç›´å›°æ¼æˆ‘ï¼Œæ•´ä¸ªéšæœº election timeouts æ˜¯å¦‚ä½•è§£å†³ split votesã€‚å› ä¸ºæœ‰ä¸€æ®µè¯ï¼š</p>\n<blockquote>\n<p>This spreads out the servers so that in most cases only a single server will time out; it wins the election and sends heartbeats before any other servers time out.</p>\n</blockquote>\n<p>è¿™æ®µè¯çš„æ„æ€æ˜¯è¯´å…ˆ timeout çš„ server ä¼šè·å¾—é€‰ä¸¾èƒœåˆ©ã€‚è¿™é‡Œå°±æœ‰ä¸€ä¸ªç–‘é—®ä¸ºä»€ä¹ˆå…ˆ timeout çš„ server ä¸€å®šä¼šè·å¾—é€‰ä¸¾èƒœåˆ©ã€‚å…¶å®è¦ææ‡‚è¿˜å¾—çœ‹ followerã€‚follower åšäº†ä¸€ä»¶äº‹ï¼š</p>\n<blockquote>\n<p>If a follower receives no communication over a period of time called the election timeout, then it assumes there is no viable leader and begins an election to choose a new leader.</p>\n</blockquote>\n<p>å¦‚æœ follower åœ¨ <code>election timeout</code>  æ²¡æœ‰æ”¶åˆ° leader æˆ– candidate çš„ rpcï¼Œé‚£ä¹ˆå®ƒä¼šå¼€å¯é€‰ä¸¾ï¼Œæ³¨æ„è¿™é‡Œçš„è¶…æ—¶æ—¶é—´æ˜¯ <code>election timeout</code> ã€‚ä¹Ÿå°±æ˜¯è¯´è¿‡ leader æŒ‚äº†çš„è¯ï¼Œé‚£ä¹ˆ <code>election timeout</code>  æœ€å°çš„é‚£ä¸ªæœºå­å°±ä¼šå…ˆæ„è¯†åˆ°ï¼Œäºæ˜¯ä»–æˆä¸º candidate å¹¶ä¸”å‘å…¶ä»– server å‘é€ RequestVote RPCã€‚è€Œ raft çš„æŠ•ç¥¨æœºåˆ¶å°±æ˜¯å…ˆæ¥å…ˆåˆ°è§„åˆ™ï¼Œå…ˆå‘èµ·æŠ•ç¥¨çš„é‚£ä¸ª server å¾ˆæœ‰å¯èƒ½å¯ä»¥èµ¢å¾—é€‰ä¸¾ã€‚</p>\n<p>candidate åˆå§‹åŒ–ä¹Ÿåšäº†ä¸€ä»¶äº‹ï¼š</p>\n<blockquote>\n<p>Each candidate restarts its randomized election timeout at the start of an<br />\nelection, and it waits for that timeout to elapse before starting the next election</p>\n</blockquote>\n<p>candidate åˆå§‹åŒ–åä¹Ÿä¼šé‡æ–°éšæœºåˆå§‹åŒ–è¿™ä¸ª <code>election timeout</code> ã€‚å¦‚æœåœ¨è¿™ä¸ªé˜¶æ®µå‘ç”Ÿäº† split vote æƒ…å†µï¼Œé‚£ä¹ˆ <code>election timeout</code>  æœ€å°çš„ candidate å°±ä¼šç‡å…ˆè¶…æ—¶ï¼Œå¹¶ä¸”å¼€å¯æ–°çš„æŠ•ç¥¨ï¼Œäºæ˜¯å…¶ä»– candidate çœ‹åˆ°æ–°çš„ RequestVote ä¸­çš„ <code>current term</code>  å¤§äºè‡ªèº«çš„ term numberï¼Œäºæ˜¯è¿™äº› candidate å°±ä¼šè‡ªåŠ¨å˜æˆ followers å¹¶ç»™æ–°çš„ candidate æŠ•ç¥¨ã€‚äºæ˜¯ splitvote é—®é¢˜å°±å¯ä»¥å¾ˆå¥½åœ°è§£å†³äº†ï¼</p>\n<h3 id=\"state\"><a class=\"anchor\" href=\"#state\">#</a> State</h3>\n<h5 id=\"æ‰€æœ‰çš„serveréƒ½æœ‰çš„çŠ¶æ€\"><a class=\"anchor\" href=\"#æ‰€æœ‰çš„serveréƒ½æœ‰çš„çŠ¶æ€\">#</a> æ‰€æœ‰çš„ server éƒ½æœ‰çš„çŠ¶æ€</h5>\n<p><code>committedIndex</code> ï¼šè¿™å°±æ˜¯ logs ä¸­ committed highest log entry indexï¼Œè¿™ä¸ªåˆå§‹åŒ–ä¸º 0ã€‚</p>\n<p><code>log[]</code> ï¼šlog åˆå§‹åŒ–ä¸­ä¼šæŠŠ index ä¸º 0 åˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯åç»­æ·»åŠ  entry çš„ index éƒ½æ˜¯ä» 1 å¼€å§‹ã€‚</p>\n<p><code>lastApplied</code> ï¼šindex of highes log entry applied to state machineã€‚é€šè¿‡ heartbeat å‘é€äº† entry ä¹‹åå—åˆ°äº† confirmï¼Œç¡®å®šæ˜¯ committed ä¹‹åå°±å¯ä»¥æ‰§è¡Œäº†ã€‚è¿™ä¸ª lab å¯èƒ½ä¸ä¼šæ¶‰åŠã€‚</p>\n<p><code>commitIndex</code> ï¼šé€šè¿‡ heartbeat å¾—åˆ°å›å¤ï¼Œleader å°±å¯ä»¥ç¡®è®¤ committed äº†ã€‚</p>\n<h5 id=\"leader-ç»´æŠ¤çš„çŠ¶æ€\"><a class=\"anchor\" href=\"#leader-ç»´æŠ¤çš„çŠ¶æ€\">#</a> leader ç»´æŠ¤çš„çŠ¶æ€</h5>\n<p><code>matchIndex[]</code> ï¼šå¯¹äºæ¯ä¸ª serverï¼Œéœ€è¦å¤åˆ¶çš„æœ€é«˜ log entry indexï¼Œåˆå§‹åŒ–ä¸º 0ã€‚æˆ‘è¿˜æ²¡ææ‡‚è¿™ä¸ªæœ€é«˜éœ€è¦è¢«å¤åˆ¶ä¸ºå•¥è¦åˆå§‹åŒ–ä¸º 0ã€‚</p>\n<p><code>nextIndex[]</code> : leader ä¼šä¿å­˜ä¸‹ä¸€ä¸ªä¸º server å‘é€äº† log entry çš„ indexã€‚è¿™é‡Œçš„ index æˆ‘ç›´æ¥è®¾å®šä¸º log çš„ç´¢å¼•ã€‚ï¼ˆåˆå§‹åŒ–ä¸º <code>len(logs)</code> ï¼‰</p>\n<h3 id=\"å…³äº54-safety\"><a class=\"anchor\" href=\"#å…³äº54-safety\">#</a> å…³äº 5.4 Safety</h3>\n<p>æœ‰ä¸ªå¤§å‰æï¼šleader å¯ä»¥æ— é™ append logï¼Œä½†æ˜¯å®ƒä¸èƒ½é€šè¿‡é€‰ä¸¾ç„¶åå¢å¤§è‡ªå·±çš„ termã€‚</p>\n<h4 id=\"ä¸¥æ ¼é€‰ä¸¾\"><a class=\"anchor\" href=\"#ä¸¥æ ¼é€‰ä¸¾\">#</a> ä¸¥æ ¼é€‰ä¸¾</h4>\n<p>Raft ä¿è¯æ–°é€‰ä¸¾å‡ºæ¥çš„ leader å¿…é¡»æ‹¥æœ‰ä¹‹å‰ term æ‰€æœ‰çš„ committed entriesï¼Œä¹Ÿå°±æ˜¯è¯´ log entries åªèƒ½é€šè¿‡ leader æµå‘ follower è€Œä¸èƒ½ä» follower æµå‘ leaderã€‚</p>\n<p>è¿™é‡Œ candidate èµ¢å¾—é€‰ä¸¾çš„æ¡ä»¶æœ‰æ‰€ä¸åŒã€‚</p>\n<p>candidate åœ¨è¯·æ±‚æŠ•ç¥¨æ—¶ï¼Œä¼šå‘é€è‡ªå·±çš„ last log entry å’Œ follower çš„ last log entry è¿›è¡Œå¯¹æ¯”ã€‚å¦‚æœ candidate last log çš„ term è¦å¤§ï¼Œè·å¾— term ç›¸åŒæ—¶ candidate log entry çš„ index è¦å¤§ï¼Œåˆ™è®¤ä¸º candidate æ˜¯ä¼˜å…ˆçš„ï¼Œè¿™æ—¶å€™æ‰èƒ½è¿›è¡ŒæŠ•ç¥¨ã€‚</p>\n<h4 id=\"committedè§„åˆ™\"><a class=\"anchor\" href=\"#committedè§„åˆ™\">#</a> committed è§„åˆ™</h4>\n<p>è®ºæ–‡çš„ figure 8 ç»™å‡ºäº†è¿™æ ·ä¸€ä¸ªæƒ…å†µï¼š</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220228215916592.png\" alt=\"image-20220228215916592\" /></p>\n<p>åœ¨ <code>c</code>  æƒ…å†µä¸‹ï¼Œ <code>s1</code>  ä½œä¸º leader å°† index 2 å¤åˆ¶ç»™äº† s2ã€s3ã€‚ç„¶åé—®é¢˜æ¥äº†ï¼Œè¿™æ · index 2 å°±æ˜¯ä¸€ä¸ª committed entry äº†ï¼Œä½†æ˜¯å¦‚æœ s1 è¿™æ—¶å€™æŒ‚æ‰ï¼Œs5 å‚ä¸åˆ°é€‰ä¸¾ï¼Œç”±äº s5 åœ¨ term3 æ—¶å€™èµ¢å¾—äº†é€‰ä¸¾ï¼Œæ‰€ä»¥ä»–æœ‰ term3 çš„ log entryï¼Œé‚£ä¹ˆ s5 åœ¨ <code>d</code>  æƒ…å†µå¯ä»¥èµ¢å¾— term5 é€‰ä¸¾ï¼Œå¹¶æŠŠ index 2 å¤åˆ¶ç»™äº†å…¶ä»– serverã€‚å¯ä»¥çœ‹åˆ°æ­¤æ—¶çš„ index 2 çš„ term å˜æˆäº† 3ã€‚ä¹‹å‰çš„ committed è¢«è¦†ç›–äº†ï¼</p>\n<p>äºæ˜¯ raft è§„å®šï¼Œåªæœ‰å½“å‰ term çš„ log entries æ‰èƒ½é€šè¿‡è®¡ç®— replicas æ•°çš„æ–¹å¼è¿›è¡Œ <code>committed</code> ã€‚</p>\n<p>è¿™é‡Œåˆä¼šæœ‰æ–°çš„é—®é¢˜å‡ºç°äº†ï¼å¦‚æœä¸€ä¸ª command å¯¹åº”äº† log entries æ˜¯ä¹‹å‰çš„ termï¼Œé‚£ä¹ˆåŠæ—¶å½“å‰ leader æ”¶åˆ°äº† majority çš„ confirmï¼Œé‚£ä¹ˆ leader ä¹Ÿä¸èƒ½ apply è¿™ä¸ª log entryã€‚ä¸€ç›´åˆ°å½“å‰çš„ term ä¸‹æ¥äº† new commandã€‚é‚£ä¹ˆè¿™ä¸ªæ—§ term ä¸‹çš„ log entry æ‰ä¼šå¾—åˆ° confirmã€‚</p>\n<h4 id=\"safety-argument\"><a class=\"anchor\" href=\"#safety-argument\">#</a> Safety argument</h4>\n<p><strong>é’ˆå¯¹ figure 9 çš„æƒ…å†µ</strong></p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220228224051518.png\" alt=\"image-20220228224051518\" /></p>\n<p>æˆ‘å¯¹äºè¿™å¼ å›¾çš„ç†è§£</p>\n<p>å¦‚æœ s5 å¯ä»¥è·å¾—å¤§éƒ¨åˆ†é€‰ç¥¨çš„è¯ï¼Œé‚£ä¹ˆè‡³å°‘ä¼šå‡ºç° s3 è¿™ç§æ—¢æ”¶åˆ°äº†ä¹‹å‰ leader çš„ log entryã€‚è¯·æ³¨æ„ï¼Œè®ºæ–‡æè¿°ä¸¥æ ¼é€‰ä¸¾æœ‰ä¸€ä¸ªå‰æï¼Œé‚£å°±æ˜¯ï¼šèµ¢å¾—é€‰ä¸¾çš„ server å¿…é¡»è¦åœ¨ majority ä¸­ä¿è¯ up-to-date log entryã€‚è¿™æ„å‘³ç€ leader å¦‚æœè‡ªå·±ä»»æœŸå†…çš„ committed entry ä¸€ç›´æ˜¯ up-to-dateã€‚ä¹Ÿå°±æ˜¯è¯´ s5 ä¸å¯èƒ½é€šè¿‡é€‰ä¸¾ï¼</p>\n<p>æœ‰ä¸€è¯´ä¸€ï¼Œè¿˜æ˜¯æœ‰çš„æŠ½è±¡ã€‚ã€‚ã€‚ã€‚</p>\n<h4 id=\"timing-and-availability\"><a class=\"anchor\" href=\"#timing-and-availability\">#</a> Timing and availability</h4>\n<p>éœ€è¦ä¿è¯</p>\n<p><strong>broadcastTimeâ‰ªelectionTimeoutâ‰ªMTBF</strong></p>\n<p><code>broadcastTime</code>  å°±æ˜¯å¹³è¡Œå‘é€ RPCs çš„å¹³å‡å‘é€æ—¶é—´ + æ¥å—å“åº”æ—¶é—´ã€‚</p>\n<p><code>electionTimeout</code> ï¼šè¿™ä¸ªå°±æ˜¯ä¹‹å‰æåˆ°äº†é€‰ä¸¾è¶…æ—¶ã€‚</p>\n<p><code>MTBF</code>  ï¼šthe average time between failures for a single server</p>\n<p><strong>MTBFs are several months or more</strong>ï¼Œæ‰€ä»¥è¿™ä¸ªä¸ç­‰å¼å¾ˆå®¹æ˜“æ»¡è¶³</p>\n<h3 id=\"log-compaction\"><a class=\"anchor\" href=\"#log-compaction\">#</a> Log compaction</h3>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220301092739411.png\" alt=\"image-20220301092739411\" /></p>\n<p>raft çš„ snap æœºåˆ¶ç”¨äºå‹ç¼©æ—¥å¿—ï¼Œå…¶å®å®ƒä¹Ÿå¾ˆç®€å•ã€‚</p>\n<p><code>last included index</code>  å°±æ˜¯ the last entry the state machine had appliedï¼Œå°±æ˜¯ last apply indexï¼Œæ³¨æ„ï¼Œåªæœ‰ committed çš„ entry æ‰ä¼šè¢« applyï¼Œè€Œ raft å¯ä»¥ç¡®ä¿æ‰€æœ‰ committed entry éƒ½ä¼šåœ¨ state machine å¾—åˆ° applyã€‚</p>\n<p>** å¹¶ä¸”è¿™ä¸ª snapshot è¿˜åŒ…å« state machine stateï¼** è¿™æ˜¯åˆ›å»º snap çš„æœ€å¤§å¼€é”€ã€‚</p>\n<p>æ‰€ä»¥ä¹‹å‰å·²ç» apply çš„ log entry å®é™…ä¸Šå·²ç»æ²¡å•¥å¤ªå¤§å¸®åŠ©äº†ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿å­˜ last ç”¨äº AppendEntries consistency checkã€‚</p>\n<p>å¯¹äºç‰¹æ®Šæƒ…å†µï¼Œæ¯”å¦‚ leader ç°åœ¨éœ€è¦åºŸå¼ƒ log entriesï¼Œä½†æ˜¯è¿™äº› log entries ä¸­è¿˜æœ‰ä¸€äº›æ²¡æœ‰å‘é€ç»™æŸä¸ª followerï¼Œæ¯”å¦‚ follower server æ‰§è¡Œå¾ˆæ…¢ï¼Œè¿™ä¸ª server åˆšåˆšåŠ å…¥ç½‘ç»œã€‚ã€‚ã€‚</p>\n<p>äºæ˜¯è¿™æ˜¯ leader ä¼šè°ƒç”¨ InstallSnapShot RPCï¼š</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220301095816047.png\" alt=\"image-20220301095816047\" /></p>\n<p>leader é€šè¿‡å‘é€ chunk æ–¹å¼ï¼ŒæŠŠ snapshot å‘é€ç»™ followerã€‚</p>\n<p>å¦‚æœ follower çš„ last log entry æ¯”æ¥æ”¶åˆ°çš„ snapshot é‡Œçš„ last index è¿˜è¦ staleï¼Œé‚£ä¹ˆ follower å°±æŠŠå…¨éƒ¨ log entrie ç»™æ‰”äº†ã€‚å¦‚æœ follower pre index å’Œ snap é‡Œçš„ last index é‡åˆï¼Œé‚£ä¹ˆå°±åªä¸¢å¼ƒä¹‹å‰çš„ã€‚</p>\n<p>snapshot çš„åˆ›å»ºè§„åˆ™ï¼š</p>\n<ol>\n<li>å›ºå®š log size è§¦å‘åˆ›å»º snapshotã€‚</li>\n<li>copy-on-write æŠ€æœ¯ç”¨äºåˆ›å»ºã€‚</li>\n</ol>\n<h3 id=\"å¬è®²\"><a class=\"anchor\" href=\"#å¬è®²\">#</a> å¬è®²</h3>\n<p>ä½¿ç”¨ condition</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220226202117673.png\" alt=\"image-20220226202117673\" /></p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220226202457559.png\" alt=\"image-20220226202457559\" /></p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220226210149391.png\" alt=\"image-20220226210149391\" /></p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220226210527368.png\" alt=\"image-20220226210527368\" /></p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220227155319505.png\" alt=\"image-20220227155319505\" /></p>\n<p>è¿™å¼ å›¾å¾ˆå¥½åœ°è§£ç­”äº†æˆ‘çš„ç–‘æƒ‘ï¼Œraft ä¸­çš„ server åªèƒ½æ˜¯ leader æ¥å¯¹å¤–æä¾›æœåŠ¡ï¼Œä» client å‘é€è¯·æ±‚åˆ° leader å“åº”è¿‡ç¨‹åˆ†ä¸ºï¼š</p>\n<ul>\n<li>client å‘ server å‘é€è¯·æ±‚ï¼Œå‘é€ç»™ follower çš„è¯·æ±‚ä¼šè¢« follower è½¬å‘ç»™ leaderã€‚</li>\n<li>leader æŠŠ client command å†™åœ¨ log ä¸­ï¼Œå¹¶é€šè¿‡ Append Entites RPC å‘é€ç»™å…¶ä»– followersã€‚</li>\n<li>followers è¿”å›ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚æœé›†ç¾¤ä¸­ majority éƒ½å“åº”äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ leader çŸ¥é“äº† cluster ä¸­å¤§éƒ¨åˆ†èŠ‚ç‚¹å°±æ”¶åˆ°äº†è¿™äº› log entityï¼Œé‚£ä¹ˆå¯¹åº”çš„ entity å°±æ˜¯ <code>committed</code> ã€‚</li>\n<li>leader ç¡®è®¤ entity æ˜¯ committed ä¹‹åï¼Œå°±ä¼šå¼€å§‹æ‰§è¡Œ entity å¯¹åº”çš„ commandï¼Œå¹¶æŠŠæ‰§è¡Œè¿™ä¸ª command å†æ¬¡å‘é€ç»™ followersã€‚</li>\n<li>followers æ”¶åˆ°ç¡®è®¤æ‰§è¡Œ request ä¹‹åå¼€å§‹æ‰§è¡Œã€‚</li>\n</ul>\n<p>æˆ‘ä¹‹å‰æƒ³åˆ°çš„ split partition é—®é¢˜å°±å¯ä»¥å¾ˆå¥½è§£å†³äº†ï¼Œå¦‚æœé›†ç¾¤åˆ†è£‚ä¸ºä¸¤ä¸ª partitionï¼Œç„¶åå„è‡ªéƒ½æœ‰ leaderï¼Œé‚£ä¹ˆå¯¹äº min partition æ¥è¯´ï¼Œleader æ”¶ä¸åˆ° majority çš„ç¡®è®¤ï¼Œå› æ­¤ leader æ²¡æ³•æ‰§è¡ŒæŒ‡ä»¤ã€‚</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220301110023351.png\" alt=\"image-20220301110023351\" /></p>\n<p>raft ä½¿ç”¨ fast backup æ–¹æ³•ã€‚</p>\n<h3 id=\"çº¿æ€§ä¸€è‡´æ€§\"><a class=\"anchor\" href=\"#çº¿æ€§ä¸€è‡´æ€§\">#</a> çº¿æ€§ä¸€è‡´æ€§</h3>\n<h4 id=\"ä»€ä¹ˆæ˜¯çº¿æ€§ä¸€è‡´æ€§\"><a class=\"anchor\" href=\"#ä»€ä¹ˆæ˜¯çº¿æ€§ä¸€è‡´æ€§\">#</a> <strong>ä»€ä¹ˆæ˜¯çº¿æ€§ä¸€è‡´æ€§ï¼Ÿ</strong></h4>\n<p><strong>Linearizable semantics</strong> ï¼ˆLinearizabilityï¼‰(each operation appears to execute instantaneously, exactly once, at some point between its invocation and its response)</p>\n<ul>\n<li>\n<p>åœ¨ä¸€ä¸ªçº¿æ€§ä¸€è‡´æ€§çš„ç³»ç»Ÿé‡Œé¢ï¼Œä»»ä½•æ“ä½œéƒ½å¯èƒ½åœ¨è°ƒç”¨æˆ–è€…è¿”å›ä¹‹é—´åŸå­å’Œç¬é—´æ‰§è¡Œ</p>\n</li>\n<li>\n<p>çº¿æ€§ä¸€è‡´æ€§ï¼ŒLinearizabilityï¼Œä¹Ÿç§°ä¸ºåŸå­ä¸€è‡´æ€§ï¼ˆatomic consistencyï¼‰ï¼Œå¼ºä¸€è‡´æ€§ï¼ˆstrong consistencyï¼‰ç­‰</p>\n</li>\n<li>\n<p>ä¹Ÿå°±æ˜¯é€šå¸¸æ‰€è¯´çš„ CAP ç†è®ºä¸­çš„ C</p>\n</li>\n</ul>\n<p>å®ç°çº¿æ€§ä¸€è‡´æ€§éœ€è¦æ»¡è¶³ä¸‰ç‚¹ï¼š</p>\n<ul>\n<li>ç¬é—´å®Œæˆï¼ˆåŸå­æ€§ï¼‰</li>\n<li>å‘ç”Ÿåœ¨ Inv å’Œ Resp ä¸¤ä¸ªäº‹ä»¶ä¹‹é—´</li>\n<li>åæ˜ å‡º â€œæœ€æ–°â€ çš„å€¼</li>\n</ul>\n<p>1 å’Œ 2 å¾ˆå¥½ç†è§£ï¼Œä½† â€œæœ€æ–°â€ æ€ä¹ˆç†è§£å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•å°±çœ‹å†™æ“ä½œï¼š<br />\n<img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220301144626139.png\" alt=\"image-20220301144626139\" /></p>\n<p>åœ¨å›¾ä¸­ï¼Œx çš„å€¼è¢«å†™æ“ä½œåˆ’åˆ†ä¸º 3 ä¸ªåŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸå†…å¯¹åº”æœ€æ–°çš„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ â€œæœ€æ–°â€ å¹¶ä¸ä»£è¡¨<strong>ç¡®å®š</strong>ï¼</p>\n<h4 id=\"rafté‡Œçš„çº¿æ€§ä¸€è‡´æ€§\"><a class=\"anchor\" href=\"#rafté‡Œçš„çº¿æ€§ä¸€è‡´æ€§\">#</a> Raft é‡Œçš„çº¿æ€§ä¸€è‡´æ€§</h4>\n<p>åœ¨ raft é‡Œæ˜¯è¿™æ ·å®šä¹‰çš„ï¼š</p>\n<ul>\n<li>åŒä¸€ä¸ª client çš„æ“ä½œä¸èƒ½å¹¶å‘ã€‚</li>\n<li>å¦‚æœè¯»æ“ä½œè§‚å¯Ÿåˆ°å†™æ“ä½œï¼Œé‚£ä¹ˆè¯»æ“ä½œå¿…é¡»ç­‰å¾…å†™æ“ä½œå®Œæˆä¹‹åæ‰èƒ½æ‰§è¡Œã€‚</li>\n</ul>\n<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æŠŠä¸‹é¢è¿™ç§æƒ…å†µæ‹†å¼€ï¼Œå˜æˆä¸€ä¸ªçº¿æ€§ä¸€è‡´çš„æ“ä½œã€‚</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturespicturespicturesimage-20220301122149285.png\" alt=\"image-20220301122149285\" /></p>\n<h3 id=\"é‡åˆ°çš„é—®é¢˜\"><a class=\"anchor\" href=\"#é‡åˆ°çš„é—®é¢˜\">#</a> é‡åˆ°çš„é—®é¢˜</h3>\n<h4 id=\"227æ—¥æ›´æ–°\"><a class=\"anchor\" href=\"#227æ—¥æ›´æ–°\">#</a> 2.27 æ—¥æ›´æ–°ï¼š</h4>\n<p>æˆåŠŸå®Œæˆäº† Lab2Aï¼Œä½†æ˜¯è¿˜é—ç•™äº†ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ä¸ºä»€ä¹ˆé™åˆ¶é€‰ä¸¾æ‰§è¡Œæ—¶é—´æ‰èƒ½é€šè¿‡ testï¼ŒæŒ‰é“ç†åªè¦é€‰ä¸¾è¶…æ—¶ä¹‹åï¼Œä¹‹å‰é€‰ä¸¾çš„ç»“æœå°±ä¼šè¢«åºŸå¼ƒçš„ã€‚ã€‚ã€‚</p>\n<pre><code>Test (2A): initial election ...\nlabgob warning: Decoding into a non-default variable/field Term may not work\n  ... Passed --   3.0  3   56    6872    0\nTest (2A): election after network failure ...\n  ... Passed --   9.2  3  238   17813    0\nTest (2A): multiple elections ...\n  ... Passed --   6.5  7  642   55493    0\nPASS\nok  \t6.824/raft\t18.733s\n\n</code></pre>\n<h4 id=\"31å·æ›´æ–°\"><a class=\"anchor\" href=\"#31å·æ›´æ–°\">#</a> 3.1 å·æ›´æ–°</h4>\n<p>raft åœ¨ leader å½“é€‰ä¹‹åä¼šç«‹å³åœ¨ leader çš„ log ä¸­ç”Ÿæˆä¸€æ¡ no-hup æ—¥å¿—å¹¶é€šè¿‡ heartbeat ä¼ é€’ç»™å…¶ä»– serverã€‚ä½†æ˜¯åœ¨ MIT6.824 å®éªŒä¸­æ²¡åŠæ³•å®ç° no-hupã€‚</p>\n<h4 id=\"34-æ›´æ–°\"><a class=\"anchor\" href=\"#34-æ›´æ–°\">#</a> 3.4 æ›´æ–°</h4>\n<p>æ„‰å¿«é€šå…³ï¼</p>\n",
            "tags": [
                "MIT6.824"
            ]
        },
        {
            "id": "https://songlinlife.top/2022/Artur-%E8%B0%83%E5%BA%A6%E5%99%A8/",
            "url": "https://songlinlife.top/2022/Artur-%E8%B0%83%E5%BA%A6%E5%99%A8/",
            "title": "Artur: è°ƒåº¦å™¨",
            "date_published": "2022-02-25T13:46:15.000Z",
            "content_html": "<p>è¿™ç©æ„æœ‰ç‚¹åƒæˆ‘ä¹‹å‰å†™è¿‡çš„ MapReduceï¼Œä¹Ÿæ˜¯å• master è´Ÿè´£è°ƒåº¦ï¼Œå¤š worker è´Ÿè´£æ‰§è¡Œ taskã€‚å¹¶ä¸”ä¸€ä¸ª worker åªå…è®¸æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œä½†æ‰§è¡Œå®Œä»»åŠ¡åå¯ä»¥é‡æ–°ç”³è¯· taskã€‚</p>\n<p>Artur å°±æ˜¯è´Ÿè´£ä¹‹å‰ <code>perceval</code>  ä»»åŠ¡çš„è°ƒåº¦ï¼Œåˆ†ä¸º <code>arthurd</code>  å’Œ  <code>arthurw</code> ã€‚ <code>arthurd</code>  ä¹Ÿå°±æ˜¯æœåŠ¡ç«¯ï¼Œè´Ÿè´£ assign taskã€‚è€Œ  <code>arturw</code>  è´Ÿè´£ç”³è¯· task ç„¶åæ‰§è¡Œã€‚</p>\n<h3 id=\"é…ç½®æ–‡ä»¶\"><a class=\"anchor\" href=\"#é…ç½®æ–‡ä»¶\">#</a> é…ç½®æ–‡ä»¶</h3>\n<p><code>Arturd</code> ï¼š</p>\n<figure class=\"highlight ini\"><figcaption data-lang=\"ini\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token header\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">arthur</span><span class=\"token punctuation\">]</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key attr-name\">archive_path</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">/tmp/.arthur/archive</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key attr-name\">debug</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">True</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key attr-name\">log_path</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">/tmp/logs/arthurd</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key attr-name\">no_archive</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">True</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key attr-name\">sync_mode</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">True</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token header\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">connection</span><span class=\"token punctuation\">]</span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token key attr-name\">host</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">127.0.0.1</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token key attr-name\">port</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">8080</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token header\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">elasticsearch</span><span class=\"token punctuation\">]</span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token key attr-name\">es_index</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">http://localhost:9200/items</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token header\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">redis</span><span class=\"token punctuation\">]</span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token key attr-name\">database</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">redis://localhost/8</span></pre></td></tr></table></figure><p>å¯ä»¥æŒ‡å®š portï¼Œç”¨äºæä¾›æœåŠ¡ã€‚</p>\n<p><code>Arturw</code> ï¼š</p>\n<pre><code class=\"language-sh\">arthurw -d redis://localhost/8\n</code></pre>\n<p>ç›´æ¥ç»™ redis æ•°æ®åº“åœ°å€ã€‚</p>\n<h3 id=\"æ·»åŠ task\"><a class=\"anchor\" href=\"#æ·»åŠ task\">#</a> æ·»åŠ  task</h3>\n<pre><code class=\"language-sh\">$ cat tasks.json\n&#123;\n    &quot;tasks&quot;: [\n        &#123;\n            &quot;task_id&quot;: &quot;arthur.git&quot;,\n            &quot;backend&quot;: &quot;git&quot;,\n            &quot;backend_args&quot;: &#123;\n                &quot;gitpath&quot;: &quot;/tmp/git/arthur.git/&quot;,\n                &quot;uri&quot;: &quot;https://github.com/chaoss/grimoirelab-kingarthur.git&quot;,\n                &quot;from_date&quot;: &quot;2015-03-01&quot;\n            &#125;,\n            &quot;category&quot;: &quot;commit&quot;,\n            &quot;scheduler&quot;: &#123;\n                &quot;delay&quot;: 10\n            &#125;\n        &#125;,\n        &#123;\n            &quot;task_id&quot;: &quot;bugzilla_mozilla&quot;,\n            &quot;backend&quot;: &quot;bugzillarest&quot;,\n            &quot;backend_args&quot;: &#123;\n                &quot;url&quot;: &quot;https://bugzilla.mozilla.org/&quot;,\n                &quot;from_date&quot;: &quot;2016-09-19&quot;\n            &#125;,\n            &quot;category&quot;: &quot;bug&quot;,\n            &quot;archive&quot;: &#123;\n                &quot;fetch_from_archive&quot;: true,\n                &quot;archived_after&quot;: &quot;2018-02-26 09:00&quot;\n            &#125;,\n            &quot;scheduler&quot;: &#123;\n                &quot;delay&quot;: 60,\n                &quot;max_retries&quot;: 5\n            &#125;\n        &#125;\n    ]\n&#125;\n</code></pre>\n<p>ç„¶åå‘é€ï¼š</p>\n<pre><code class=\"language-sh\">curl -H &quot;Content-Type: application/json&quot; --data @tasks.json http://127.0.0.1:8080/add\n</code></pre>\n<p>å¯ä»¥è¿™å¾ˆ restfulã€‚</p>\n<h3 id=\"åç»­\"><a class=\"anchor\" href=\"#åç»­\">#</a> åç»­</h3>\n<p>æœ¬æ¥æƒ³è‡ªå·±è¿è¡Œä¸€ä¸‹çš„ï¼Œä½†æ˜¯å‘ƒå‘ƒæˆ‘çš„ redis é•œåƒä¸€ç›´æ‹‰ä¸ä¸‹æ¥ï¼Œå°±æ‡’å¾—å¼„äº†ã€‚</p>\n",
            "tags": [
                "xlab"
            ]
        },
        {
            "id": "https://songlinlife.top/2022/Graal-%E5%AD%98%E5%82%A8%E5%BA%93%E5%88%86%E6%9E%90%E5%99%A8/",
            "url": "https://songlinlife.top/2022/Graal-%E5%AD%98%E5%82%A8%E5%BA%93%E5%88%86%E6%9E%90%E5%99%A8/",
            "title": "Graal: å­˜å‚¨åº“åˆ†æå™¨",
            "date_published": "2022-02-25T12:08:11.000Z",
            "content_html": "<p>Graal leverages on the Git backend of <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2NoYW9zcy9ncmltb2lyZWxhYi1wZXJjZXZhbA==\">Perceval</span> and enhances it to set up ad-hoc source code analysis. Thus, it fetches the commits from a Git repository and provides a mechanism to plug third party tools/libraries focused on source code analysis.</p>\n<p>Graal å°±æ˜¯ä½¿ç”¨äº†ä¹‹å‰æåˆ°çš„ perceval ç»„ä»¶çš„ git backendã€‚æ‹‰å– repo çš„ commits å¹¶ä¸”æä¾›ä¸€ç§æ–¹æ³•ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·ç”¨äºæºç åˆ†æã€‚</p>\n<h2 id=\"how-it-works\"><a class=\"anchor\" href=\"#how-it-works\">#</a> How it works</h2>\n<p>å°±æ˜¯æ‹‰å–ä¸€ä¸ª git repo é•œåƒä»¥åŠ commits çš„ meta dataã€‚é€šè¿‡åˆ›å»ºå·¥ä½œæ ‘æ¥æ‰§è¡Œ checkout æ“ä½œã€‚Graal è·å– json åï¼Œåˆ†ä¸ºä¸‰æ­¥ï¼š</p>\n<ul>\n<li>Filterã€‚é€šè¿‡ json æ–‡æ¡£ï¼Œé€‰æ‹©æˆ–è€…ä¸¢å¼ƒ commitã€‚ç„¶ååœ¨å·¥ä½œæ ‘ä¸Šç”¨ commit hash æ¥æ‰§è¡Œ checkout æ“ä½œã€‚</li>\n<li>Analyzeã€‚å°±æ˜¯å¼•å…¥åˆ†æå·¥å…·ã€‚</li>\n<li>Post-processã€‚æœ€åä¸€æ­¥å¤„ç† json æ–‡æ¡£ï¼Œæ¯”å¦‚åˆ é™¤æˆ–è€…é‡å‘½åã€‚</li>\n</ul>\n<h3 id=\"å®‰è£…æ•™ç¨‹\"><a class=\"anchor\" href=\"#å®‰è£…æ•™ç¨‹\">#</a> å®‰è£…æ•™ç¨‹</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2NoYW9zcy9ncmltb2lyZWxhYi1ncmFhbA==\">https://github.com/chaoss/grimoirelab-graal</span></p>\n<h3 id=\"å¸¸è§åç«¯\"><a class=\"anchor\" href=\"#å¸¸è§åç«¯\">#</a> å¸¸è§åç«¯</h3>\n<p><strong>CoCom</strong>: ä»£ç å¤æ‚åº¦åˆ†æã€‚</p>\n<p><strong>CoDep</strong>ï¼šè§£æ python æ¨¡å—çš„ä¾èµ–å¹¶ä¸”è½¬æ¢ä¸º json æ ¼å¼ï¼Œè€Œä¸”è¿˜å¯ä»¥ä½¿ç”¨ graph å¯è§†åŒ–ã€‚</p>\n<p><strong>CoQua</strong>ï¼šæ£€æŸ¥ä»£ç çš„è´¨é‡ã€‚</p>\n<p><strong>CoVuln</strong>ï¼šæ£€æŸ¥ä»£ç çš„å®‰å…¨æ€§æ¯”å¦‚å°†åœ¨çš„ sql æ³¨å…¥ã€shell æ³¨å…¥ã€‚</p>\n<p><strong>CoLic</strong> ï¼šæ‰«æä»£ç å¹¶ä¸”æå– licens å’Œç‰ˆæƒä¿¡æ¯ã€‚</p>\n<p><strong>CoLang</strong> ï¼šè·å¾— git repo çš„ä»£ç è¯­è¨€åˆ†å¸ƒæ´å¯Ÿã€‚</p>\n<h3 id=\"ç”¨æ³•\"><a class=\"anchor\" href=\"#ç”¨æ³•\">#</a> ç”¨æ³•</h3>\n<p>å’Œ <code>perceval</code>  ç›¸ç±»ä¼¼ï¼š</p>\n<pre><code class=\"language-sh\">$ graal cocom https://github.com/chaoss/grimoirelab-perceval --git-path /tmp/graal-cocom &gt; /graal-cocom.test\nStarting the quest for the Graal.\nGit worktree /tmp/... created!\nFetching commits: ...\nGit worktree /tmp/... deleted!\nFetch process completed: .. commits inspected\nQuest completed.\n</code></pre>\n<h4 id=\"pythonä¸­\"><a class=\"anchor\" href=\"#pythonä¸­\">#</a> python ä¸­ï¼š</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#! /usr/bin/env python3</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">from</span> graal<span class=\"token punctuation\">.</span>backends<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>cocom <span class=\"token keyword\">import</span> CoCom</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># URL for the git repo to analyze</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>repo_uri <span class=\"token operator\">=</span> â€™http<span class=\"token punctuation\">:</span><span class=\"token operator\">//</span>github<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>chaoss<span class=\"token operator\">/</span>grimoirelab<span class=\"token operator\">-</span>percevalâ€™</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># directory where to mirror the repo</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>repo_dir <span class=\"token operator\">=</span> â€™<span class=\"token operator\">/</span>tmp<span class=\"token operator\">/</span>graal<span class=\"token operator\">-</span>cocomâ€™</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># Cocom object initialization</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>cc <span class=\"token operator\">=</span> CoCom<span class=\"token punctuation\">(</span>uri<span class=\"token operator\">=</span>repo_uri<span class=\"token punctuation\">,</span> git_path<span class=\"token operator\">=</span>repo_dir<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># fetch all commits</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>commits <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>commit <span class=\"token keyword\">for</span> commit <span class=\"token keyword\">in</span> cc<span class=\"token punctuation\">.</span>fetch<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></pre></td></tr></table></figure>",
            "tags": [
                "xlab"
            ]
        },
        {
            "id": "https://songlinlife.top/2022/MIT6.824/MIT6-824-The-Design-of-a-Practical-System-for-Fault-Tolerant-Virtual-Machines/",
            "url": "https://songlinlife.top/2022/MIT6.824/MIT6-824-The-Design-of-a-Practical-System-for-Fault-Tolerant-Virtual-Machines/",
            "title": "MIT6.824: The Design of a Practical System for Fault-Tolerant Virtual Machines",
            "date_published": "2022-02-25T02:18:21.000Z",
            "content_html": "<h3 id=\"é”™è¯¯å®¹å¿\"><a class=\"anchor\" href=\"#é”™è¯¯å®¹å¿\">#</a> é”™è¯¯å®¹å¿</h3>\n<h3 id=\"è®ºæ–‡\"><a class=\"anchor\" href=\"#è®ºæ–‡\">#</a> è®ºæ–‡</h3>\n<h4 id=\"primarybackup\"><a class=\"anchor\" href=\"#primarybackup\">#</a> primary/backup</h4>\n<p>è¿™ç¯‡ paper æå‡ºäº†ä¸€ç§ VM é”™è¯¯å®¹å¿çš„æ–¹æ³•ï¼Œç®€å•æ¥è¯´å°±æ˜¯è®¾ç½® Primary/backupã€‚primary ç”¨äºæä¾›æœåŠ¡ï¼Œè€Œ backup ç”¨äºåš primary çš„å¤‡ä»½ã€‚å¦‚æœ primary æŒ‚æ‰ä¹‹åï¼Œé‚£ä¹ˆ backup èƒ½å¤Ÿè‡ªåŠ¨åœ°æ¥ç®¡æœåŠ¡ï¼Œç»™å¤–ç•Œ client ä¸€ç§æ²¡æœ‰å‘ç”Ÿè¿‡æ•…éšœçš„é”™è§‰ã€‚</p>\n<p>è¯¥æ–¹æ³•çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ä¿è¯ primary å’Œ backup çŠ¶æ€ç›¸åŒï¼Œæ–¹æ³•ä¹Ÿå¾ˆç®€å•ã€‚primary æ‰§è¡Œä»€ä¹ˆæ“ä½œï¼Œbackup ä¹Ÿæ‰§è¡Œä»€ä¹ˆæ“ä½œã€‚å¦‚æœæœ‰ä¸€ä¸ªä¸ç¡®å®šçš„ä¿¡æ¯ï¼Œé‚£ä¹ˆè¿™äº›ä¿¡æ¯ä¼šè¢« primary ä¼ é€ç»™ backupã€‚è¿™æ ·ä¿è¯è‹¥ backup å’Œ primary ä¸€ç›´çŠ¶æ€ç›¸åŒã€‚</p>\n<p>The Design of a Practical System for Fault-Tolerant</p>\n<h4 id=\"åŸºæœ¬è®¾è®¡\"><a class=\"anchor\" href=\"#åŸºæœ¬è®¾è®¡\">#</a> åŸºæœ¬è®¾è®¡</h4>\n<p>é¦–å…ˆæ˜¯ shared disk æ¶æ„ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220225110519498.png\" alt=\"image-20220225110519498\" /></p>\n<p>åªæœ‰ primary ä¼šè¢«æš´éœ²åœ¨ç½‘ç»œä¸­ï¼Œæ‰€ä»¥ client çš„è¾“å…¥éƒ½ä¼šè¾“å‡ºç»™ primaryã€‚primary çš„æ‰€æœ‰è¾“å‡ºéƒ½é€šè¿‡ logging channel ç»™ä¼ é€ç»™ backupã€‚</p>\n<p>ç¡®å®šæ“ä½œçš„ä¸‰ä¸ªè¦æ±‚ï¼š</p>\n<ul>\n<li>primary å¿…é¡»æ•è·ç¡®å®šçš„å’Œéç¡®å®šçš„ä¿¡æ¯ã€‚</li>\n<li>ç¡®åœ°å°†è¾“å…¥å’Œä¸ç¡®å®šä¿¡æ¯åº”ç”¨åˆ° backup</li>\n<li>ä¸èƒ½é™ä½æ€§èƒ½</li>\n</ul>\n<h4 id=\"ftåè®®\"><a class=\"anchor\" href=\"#ftåè®®\">#</a> FT åè®®</h4>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220225113932596.png\" alt=\"image-20220225113932596\" /></p>\n<p>primary å°† output operation ä¼ é€’ç»™ backupï¼Œå¹¶æ¨è¿Ÿ outputï¼ŒçŸ¥é“ backup è¿”å›ç¡®è®¤ã€‚ä½†æ˜¯è¿™ä¹Ÿæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœ primary å‘é€ output operation åç«‹å³æŒ‚äº†ï¼Œé‚£ä¹ˆ output ä¹Ÿä¼šè¢«å‘é€ 2 æ¬¡ã€‚ä½†æ˜¯ tcp åè®®å¯ä»¥å¤„ç†è¿™äº›é‡å¤åŒ…ã€‚</p>\n",
            "tags": [
                "MIT6.824"
            ]
        },
        {
            "id": "https://songlinlife.top/2022/xlab/%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%E7%BB%84%E4%BB%B6%E2%80%94%E2%80%94Perceval/",
            "url": "https://songlinlife.top/2022/xlab/%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%E7%BB%84%E4%BB%B6%E2%80%94%E2%80%94Perceval/",
            "title": "æ•°æ®é‡‡é›†ç»„ä»¶â€”â€”Perceval",
            "date_published": "2022-02-24T13:54:45.000Z",
            "content_html": "<h1 id=\"æ•°æ®é‡‡é›†ç»„ä»¶perceval\"><a class=\"anchor\" href=\"#æ•°æ®é‡‡é›†ç»„ä»¶perceval\">#</a> æ•°æ®é‡‡é›†ç»„ä»¶ â€”â€”Perceval</h1>\n<h3 id=\"å®˜æ–¹æ–‡æ¡£\"><a class=\"anchor\" href=\"#å®˜æ–¹æ–‡æ¡£\">#</a> å®˜æ–¹æ–‡æ¡£</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZXJjZXZhbC5yZWFkdGhlZG9jcy5pby9lbi9sYXRlc3Qv\">https://perceval.readthedocs.io/en/latest/</span></p>\n<h3 id=\"ä»‹ç»\"><a class=\"anchor\" href=\"#ä»‹ç»\">#</a> ä»‹ç»</h3>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2NoYW9zcy9ncmltb2lyZWxhYi1wZXJjZXZhbA==\">Perceval</span> is a Python module for retrieving data from repositories related to software development. It works with many data sources, from git repositories and GitHub projects to mailing lists, Gerrit or StackOverflow, In this chapter, you will learn the basics of working with Perceval, including how to use it to retrieve information from some kinds of repositories. Youâ€™re on your way to software development analysis!</p>\n</blockquote>\n<p><code>perceval</code>  å°±æ˜¯ <code>grimoirelab</code>  çš„æ•°æ®æºé‡‡é›†ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯æœ€åŸºç¡€çš„ç»„ä»¶ã€‚</p>\n<h3 id=\"å®‰è£…\"><a class=\"anchor\" href=\"#å®‰è£…\">#</a> å®‰è£…</h3>\n<pre><code class=\"language-sh\">pip3 install perceval\n</code></pre>\n<p>æˆ–è€…ä¹Ÿå¯ä»¥ç”¨ docker æ–¹å¼ï¼š</p>\n<pre><code class=\"language-sh\">docker run -it grimoirelab/perceval\n</code></pre>\n<h3 id=\"é£Ÿç”¨æ–¹å¼\"><a class=\"anchor\" href=\"#é£Ÿç”¨æ–¹å¼\">#</a> é£Ÿç”¨æ–¹å¼</h3>\n<p>è¿™ä¸ªå·¥å…·è¯´ç™½äº†å°±æ˜¯é‡‡é›†å·¥å…·ï¼Œå®ƒæ”¯æŒçš„åç«¯æœ‰ï¼š</p>\n<pre><code>    askbot           Fetch questions and answers from Askbot site\n    bugzilla         Fetch bugs from a Bugzilla server\n    bugzillarest     Fetch bugs from a Bugzilla server (&gt;=5.0) using its REST API\n    confluence       Fetch contents from a Confluence server\n    discourse        Fetch posts from Discourse site\n    dockerhub        Fetch repository data from Docker Hub site\n    gerrit           Fetch reviews from a Gerrit server\n    git              Fetch commits from Git\n    github           Fetch issues, pull requests and repository information from GitHub\n    gitlab           Fetch issues, merge requests from GitLab\n    gitter           Fetch messages from a Gitter room\n    googlehits       Fetch hits from Google API\n    groupsio         Fetch messages from Groups.io\n    hyperkitty       Fetch messages from a HyperKitty archiver\n    jenkins          Fetch builds from a Jenkins server\n    jira             Fetch issues from JIRA issue tracker\n    launchpad        Fetch issues from Launchpad issue tracker\n    mattermost       Fetch posts from a Mattermost server\n    mbox             Fetch messages from MBox files\n    mediawiki        Fetch pages and revisions from a MediaWiki site\n    meetup           Fetch events from a Meetup group\n    nntp             Fetch articles from a NNTP news group\n    pagure           Fetch issues from Pagure\n    phabricator      Fetch tasks from a Phabricator site\n    pipermail        Fetch messages from a Pipermail archiver\n    redmine          Fetch issues from a Redmine server\n    rocketchat       Fetch messages from a Rocket.Chat channel\n    rss              Fetch entries from a RSS feed server\n    slack            Fetch messages from a Slack channel\n    stackexchange    Fetch questions from StackExchange sites\n    supybot          Fetch messages from Supybot log files\n    telegram         Fetch messages from the Telegram server\n    twitter          Fetch tweets from the Twitter Search API\n</code></pre>\n<p>æœ‰ç‚¹æ„å¤–ï¼Œæˆ‘æ²¡æœ‰æƒ³åˆ°è¿ Twitter éƒ½èƒ½æ”¯æŒã€‚ã€‚ã€‚ã€‚</p>\n<h4 id=\"git\"><a class=\"anchor\" href=\"#git\">#</a> git</h4>\n<pre><code class=\"language-sh\">time perceval git https://github.com/grimoirelab/perceval.git \\\n  --git-path /tmp/perceval.git &gt; /tmp/perceval.test\n</code></pre>\n<p>è¿™æ¡å‘½ä»¤ä¼šå°†æ‹‰å–åˆ°çš„ git commit æ•°æ®ä¿å­˜åˆ°å¯¹åº”äº†æ–‡ä»¶ï¼Œæ ¼å¼ä¸º jsonã€‚</p>\n<p>åŒæ—¶è¿˜æ”¯æŒ python è„šæœ¬çš„æ–¹å¼ï¼š</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#! /usr/bin/env python3</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">from</span> perceval<span class=\"token punctuation\">.</span>backends<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>git <span class=\"token keyword\">import</span> Git</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># url for the git repo to analyze</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>repo_url <span class=\"token operator\">=</span> <span class=\"token string\">'http://github.com/grimoirelab/perceval.git'</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># directory for letting Perceval clone the git repo</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>repo_dir <span class=\"token operator\">=</span> <span class=\"token string\">'/tmp/perceval.git'</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># create a Git object, pointing to repo_url, using repo_dir for cloning</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>repo <span class=\"token operator\">=</span> Git<span class=\"token punctuation\">(</span>uri<span class=\"token operator\">=</span>repo_url<span class=\"token punctuation\">,</span> gitpath<span class=\"token operator\">=</span>repo_dir<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># fetch all commits as an iterator, and iterate it printing each hash</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">for</span> commit <span class=\"token keyword\">in</span> repo<span class=\"token punctuation\">.</span>fetch<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>commit<span class=\"token punctuation\">[</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'commit'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"github\"><a class=\"anchor\" href=\"#github\">#</a> github</h4>\n<pre><code class=\"language-sh\"> perceval github grimoirelab perceval --sleep-for-rate \\\n    -t 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 &gt; ~/tmp/github.json\n</code></pre>\n<p>é€šè¿‡ perceval  backend repoOwner è¿™ç§æ–¹å¼æ¥è·å–æ•°æ®</p>\n<p>é€šè¿‡  <code>--category issue</code>  æ¥æŒ‡å®šè·å– issue ä¿¡æ¯ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ github ä¼šæŠŠ pr å½“åš issue è¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥ä¹Ÿä¼šè‡ªåŠ¨å¾—åˆ°æ‰€æœ‰ pr ä¿¡æ¯ã€‚</p>\n<pre><code class=\"language-è·å–æ•°æ®æ ¼å¼\">&#123;\n    &quot;backend_name&quot;: &quot;GitHub&quot;,\n    &quot;backend_version&quot;: &quot;0.27.0&quot;,\n    &quot;category&quot;: &quot;issue&quot;,\n    &quot;classified_fields_filtered&quot;: null,\n    &quot;data&quot;: &#123;\n        &quot;active_lock_reason&quot;: null,\n        &quot;assignee&quot;: null,\n        &quot;assignee_data&quot;: &#123;&#125;,\n        &quot;assignees&quot;: [],\n        &quot;assignees_data&quot;: [],\n        &quot;author_association&quot;: &quot;CONTRIBUTOR&quot;,\n        &quot;body&quot;: &quot;Based on Sphynx, prepared for ReadTheDocs.\\n\\nRight now, this produces (from jgbarah/perceval repository) [this documentation in ReadTheDocs](http://perceval.readthedocs.org). Once this PR is accepted, I plan to switch ReadTheDocs to point to this repostory (master branch), so that the documentation gets rebuilt every time changes are made to the source code.\\n\\nThe configuration (docs/conf.py) include lines for running sphinx-apidoc, which generates automatically the docs/perceval.rst file, which is the entry point for the automatically generated documentation, produced based on the docstring comments in the source code.\\n\\nThe file index.rst is still a bare bones schema. It should be completed in a later patch, with more detailed information about Perceval itself.\\n&quot;,\n        &quot;closed_at&quot;: &quot;2016-01-04T13:51:56Z&quot;,\n        &quot;comments&quot;: 0,\n        &quot;comments_data&quot;: [],\n        &quot;comments_url&quot;: &quot;https://api.github.com/repos/chaoss/grimoirelab-perceval/issues/3/comments&quot;,\n        &quot;created_at&quot;: &quot;2016-01-03T23:46:04Z&quot;,\n        &quot;draft&quot;: false,\n        &quot;events_url&quot;: &quot;https://api.github.com/repos/chaoss/grimoirelab-perceval/issues/3/events&quot;,\n        &quot;html_url&quot;: &quot;https://github.com/chaoss/grimoirelab-perceval/pull/3&quot;,\n        &quot;id&quot;: 124679251,\n        &quot;labels&quot;: [],\n        &quot;labels_url&quot;: &quot;https://api.github.com/repos/chaoss/grimoirelab-perceval/issues/3/labels&#123;/name&#125;&quot;,\n        &quot;locked&quot;: false,\n        &quot;milestone&quot;: null,\n        &quot;node_id&quot;: &quot;MDExOlB1bGxSZXF1ZXN0NTQ5MzUxODA=&quot;,\n        &quot;number&quot;: 3,\n        &quot;performed_via_github_app&quot;: null,\n        &quot;pull_request&quot;: &#123;\n            &quot;diff_url&quot;: &quot;https://github.com/chaoss/grimoirelab-perceval/pull/3.diff&quot;,\n            &quot;html_url&quot;: &quot;https://github.com/chaoss/grimoirelab-perceval/pull/3&quot;,\n            &quot;merged_at&quot;: null,\n            &quot;patch_url&quot;: &quot;https://github.com/chaoss/grimoirelab-perceval/pull/3.patch&quot;,\n            &quot;url&quot;: &quot;https://api.github.com/repos/chaoss/grimoirelab-perceval/pulls/3&quot;\n        &#125;,\n        &quot;reactions&quot;: &#123;\n            &quot;+1&quot;: 0,\n            &quot;-1&quot;: 0,\n            &quot;confused&quot;: 0,\n            &quot;eyes&quot;: 0,\n            &quot;heart&quot;: 0,\n            &quot;hooray&quot;: 0,\n            &quot;laugh&quot;: 0,\n            &quot;rocket&quot;: 0,\n            &quot;total_count&quot;: 0,\n            &quot;url&quot;: &quot;https://api.github.com/repos/chaoss/grimoirelab-perceval/issues/3/reactions&quot;\n        &#125;,\n        &quot;reactions_data&quot;: [],\n        &quot;repository_url&quot;: &quot;https://api.github.com/repos/chaoss/grimoirelab-perceval&quot;,\n        &quot;state&quot;: &quot;closed&quot;,\n        &quot;timeline_url&quot;: &quot;https://api.github.com/repos/chaoss/grimoirelab-perceval/issues/3/timeline&quot;,\n        &quot;title&quot;: &quot;Config files for a documentation, using Sphinx.&quot;,\n        &quot;updated_at&quot;: &quot;2016-01-04T17:42:23Z&quot;,\n        &quot;url&quot;: &quot;https://api.github.com/repos/chaoss/grimoirelab-perceval/issues/3&quot;,\n        &quot;user&quot;: &#123;\n            &quot;avatar_url&quot;: &quot;https://avatars.githubusercontent.com/u/1039693?v=4&quot;,\n            &quot;events_url&quot;: &quot;https://api.github.com/users/jgbarah/events&#123;/privacy&#125;&quot;,\n            &quot;followers_url&quot;: &quot;https://api.github.com/users/jgbarah/followers&quot;,\n            &quot;following_url&quot;: &quot;https://api.github.com/users/jgbarah/following&#123;/other_user&#125;&quot;,\n            &quot;gists_url&quot;: &quot;https://api.github.com/users/jgbarah/gists&#123;/gist_id&#125;&quot;,\n            &quot;gravatar_id&quot;: &quot;&quot;,\n            &quot;html_url&quot;: &quot;https://github.com/jgbarah&quot;,\n            &quot;id&quot;: 1039693,\n            &quot;login&quot;: &quot;jgbarah&quot;,\n            &quot;node_id&quot;: &quot;MDQ6VXNlcjEwMzk2OTM=&quot;,\n            &quot;organizations_url&quot;: &quot;https://api.github.com/users/jgbarah/orgs&quot;,\n            &quot;received_events_url&quot;: &quot;https://api.github.com/users/jgbarah/received_events&quot;,\n            &quot;repos_url&quot;: &quot;https://api.github.com/users/jgbarah/repos&quot;,\n            &quot;site_admin&quot;: false,\n            &quot;starred_url&quot;: &quot;https://api.github.com/users/jgbarah/starred&#123;/owner&#125;&#123;/repo&#125;&quot;,\n            &quot;subscriptions_url&quot;: &quot;https://api.github.com/users/jgbarah/subscriptions&quot;,\n            &quot;type&quot;: &quot;User&quot;,\n            &quot;url&quot;: &quot;https://api.github.com/users/jgbarah&quot;\n        &#125;,\n        &quot;user_data&quot;: &#123;\n            &quot;avatar_url&quot;: &quot;https://avatars.githubusercontent.com/u/1039693?v=4&quot;,\n            &quot;bio&quot;: null,\n            &quot;blog&quot;: &quot;http://gsyc.es/~jgb&quot;,\n            &quot;company&quot;: null,\n            &quot;created_at&quot;: &quot;2011-09-09T21:47:40Z&quot;,\n            &quot;email&quot;: null,\n            &quot;events_url&quot;: &quot;https://api.github.com/users/jgbarah/events&#123;/privacy&#125;&quot;,\n            &quot;followers&quot;: 100,\n            &quot;followers_url&quot;: &quot;https://api.github.com/users/jgbarah/followers&quot;,\n            &quot;following&quot;: 0,\n            &quot;following_url&quot;: &quot;https://api.github.com/users/jgbarah/following&#123;/other_user&#125;&quot;,\n            &quot;gists_url&quot;: &quot;https://api.github.com/users/jgbarah/gists&#123;/gist_id&#125;&quot;,\n            &quot;gravatar_id&quot;: &quot;&quot;,\n            &quot;hireable&quot;: null,\n            &quot;html_url&quot;: &quot;https://github.com/jgbarah&quot;,\n            &quot;id&quot;: 1039693,\n            &quot;location&quot;: null,\n            &quot;login&quot;: &quot;jgbarah&quot;,\n            &quot;name&quot;: &quot;Jesus M. Gonzalez-Barahona&quot;,\n            &quot;node_id&quot;: &quot;MDQ6VXNlcjEwMzk2OTM=&quot;,\n            &quot;organizations&quot;: [\n                &#123;\n                    &quot;avatar_url&quot;: &quot;https://avatars.githubusercontent.com/u/1843608?v=4&quot;,\n                    &quot;description&quot;: null,\n                    &quot;events_url&quot;: &quot;https://api.github.com/orgs/MetricsGrimoire/events&quot;,\n                    &quot;hooks_url&quot;: &quot;https://api.github.com/orgs/MetricsGrimoire/hooks&quot;,\n                    &quot;id&quot;: 1843608,\n                    &quot;issues_url&quot;: &quot;https://api.github.com/orgs/MetricsGrimoire/issues&quot;,\n                    &quot;login&quot;: &quot;MetricsGrimoire&quot;,\n                    &quot;members_url&quot;: &quot;https://api.github.com/orgs/MetricsGrimoire/members&#123;/member&#125;&quot;,\n                    &quot;node_id&quot;: &quot;MDEyOk9yZ2FuaXphdGlvbjE4NDM2MDg=&quot;,\n                    &quot;public_members_url&quot;: &quot;https://api.github.com/orgs/MetricsGrimoire/public_members&#123;/member&#125;&quot;,\n                    &quot;repos_url&quot;: &quot;https://api.github.com/orgs/MetricsGrimoire/repos&quot;,\n                    &quot;url&quot;: &quot;https://api.github.com/orgs/MetricsGrimoire&quot;\n                &#125;,\n                &#123;\n                    &quot;avatar_url&quot;: &quot;https://avatars.githubusercontent.com/u/1918070?v=4&quot;,\n                    &quot;description&quot;: null,\n                    &quot;events_url&quot;: &quot;https://api.github.com/orgs/Bitergia/events&quot;,\n                    &quot;hooks_url&quot;: &quot;https://api.github.com/orgs/Bitergia/hooks&quot;,\n                    &quot;id&quot;: 1918070,\n                    &quot;issues_url&quot;: &quot;https://api.github.com/orgs/Bitergia/issues&quot;,\n                    &quot;login&quot;: &quot;Bitergia&quot;,\n                    &quot;members_url&quot;: &quot;https://api.github.com/orgs/Bitergia/members&#123;/member&#125;&quot;,\n                    &quot;node_id&quot;: &quot;MDEyOk9yZ2FuaXphdGlvbjE5MTgwNzA=&quot;,\n                    &quot;public_members_url&quot;: &quot;https://api.github.com/orgs/Bitergia/public_members&#123;/member&#125;&quot;,\n                    &quot;repos_url&quot;: &quot;https://api.github.com/orgs/Bitergia/repos&quot;,\n                    &quot;url&quot;: &quot;https://api.github.com/orgs/Bitergia&quot;\n                &#125;,\n                &#123;\n                    &quot;avatar_url&quot;: &quot;https://avatars.githubusercontent.com/u/2191340?v=4&quot;,\n                    &quot;description&quot;: null,\n                    &quot;events_url&quot;: &quot;https://api.github.com/orgs/VizGrimoire/events&quot;,\n                    &quot;hooks_url&quot;: &quot;https://api.github.com/orgs/VizGrimoire/hooks&quot;,\n                    &quot;id&quot;: 2191340,\n                    &quot;issues_url&quot;: &quot;https://api.github.com/orgs/VizGrimoire/issues&quot;,\n                    &quot;login&quot;: &quot;VizGrimoire&quot;,\n                    &quot;members_url&quot;: &quot;https://api.github.com/orgs/VizGrimoire/members&#123;/member&#125;&quot;,\n                    &quot;node_id&quot;: &quot;MDEyOk9yZ2FuaXphdGlvbjIxOTEzNDA=&quot;,\n                    &quot;public_members_url&quot;: &quot;https://api.github.com/orgs/VizGrimoire/public_members&#123;/member&#125;&quot;,\n                    &quot;repos_url&quot;: &quot;https://api.github.com/orgs/VizGrimoire/repos&quot;,\n                    &quot;url&quot;: &quot;https://api.github.com/orgs/VizGrimoire&quot;\n                &#125;,\n                &#123;\n                    &quot;avatar_url&quot;: &quot;https://avatars.githubusercontent.com/u/3017044?v=4&quot;,\n                    &quot;description&quot;: null,\n                    &quot;events_url&quot;: &quot;https://api.github.com/orgs/AlertProject/events&quot;,\n                    &quot;hooks_url&quot;: &quot;https://api.github.com/orgs/AlertProject/hooks&quot;,\n                    &quot;id&quot;: 3017044,\n                    &quot;issues_url&quot;: &quot;https://api.github.com/orgs/AlertProject/issues&quot;,\n                    &quot;login&quot;: &quot;AlertProject&quot;,\n                    &quot;members_url&quot;: &quot;https://api.github.com/orgs/AlertProject/members&#123;/member&#125;&quot;,\n                    &quot;node_id&quot;: &quot;MDEyOk9yZ2FuaXphdGlvbjMwMTcwNDQ=&quot;,\n                    &quot;public_members_url&quot;: &quot;https://api.github.com/orgs/AlertProject/public_members&#123;/member&#125;&quot;,\n                    &quot;repos_url&quot;: &quot;https://api.github.com/orgs/AlertProject/repos&quot;,\n                    &quot;url&quot;: &quot;https://api.github.com/orgs/AlertProject&quot;\n                &#125;,\n                &#123;\n                    &quot;avatar_url&quot;: &quot;https://avatars.githubusercontent.com/u/16151805?v=4&quot;,\n                    &quot;description&quot;: &quot;&quot;,\n                    &quot;events_url&quot;: &quot;https://api.github.com/orgs/grimoirelab/events&quot;,\n                    &quot;hooks_url&quot;: &quot;https://api.github.com/orgs/grimoirelab/hooks&quot;,\n                    &quot;id&quot;: 16151805,\n                    &quot;issues_url&quot;: &quot;https://api.github.com/orgs/grimoirelab/issues&quot;,\n                    &quot;login&quot;: &quot;grimoirelab&quot;,\n                    &quot;members_url&quot;: &quot;https://api.github.com/orgs/grimoirelab/members&#123;/member&#125;&quot;,\n                    &quot;node_id&quot;: &quot;MDEyOk9yZ2FuaXphdGlvbjE2MTUxODA1&quot;,\n                    &quot;public_members_url&quot;: &quot;https://api.github.com/orgs/grimoirelab/public_members&#123;/member&#125;&quot;,\n                    &quot;repos_url&quot;: &quot;https://api.github.com/orgs/grimoirelab/repos&quot;,\n                    &quot;url&quot;: &quot;https://api.github.com/orgs/grimoirelab&quot;\n                &#125;\n            ],\n            &quot;organizations_url&quot;: &quot;https://api.github.com/users/jgbarah/orgs&quot;,\n            &quot;public_gists&quot;: 0,\n            &quot;public_repos&quot;: 41,\n            &quot;received_events_url&quot;: &quot;https://api.github.com/users/jgbarah/received_events&quot;,\n            &quot;repos_url&quot;: &quot;https://api.github.com/users/jgbarah/repos&quot;,\n            &quot;site_admin&quot;: false,\n            &quot;starred_url&quot;: &quot;https://api.github.com/users/jgbarah/starred&#123;/owner&#125;&#123;/repo&#125;&quot;,\n            &quot;subscriptions_url&quot;: &quot;https://api.github.com/users/jgbarah/subscriptions&quot;,\n            &quot;twitter_username&quot;: null,\n            &quot;type&quot;: &quot;User&quot;,\n            &quot;updated_at&quot;: &quot;2022-02-16T16:51:43Z&quot;,\n            &quot;url&quot;: &quot;https://api.github.com/users/jgbarah&quot;\n        &#125;\n    &#125;,\n    &quot;origin&quot;: &quot;https://github.com/grimoirelab/perceval&quot;,\n    &quot;perceval_version&quot;: &quot;0.17.16&quot;,\n    &quot;search_fields&quot;: &#123;\n        &quot;item_id&quot;: &quot;124679251&quot;,\n        &quot;owner&quot;: &quot;grimoirelab&quot;,\n        &quot;repo&quot;: &quot;perceval&quot;\n    &#125;,\n    &quot;tag&quot;: &quot;https://github.com/grimoirelab/perceval&quot;,\n    &quot;timestamp&quot;: 1645709133.739694,\n    &quot;updated_on&quot;: 1451929343.0,\n    &quot;uuid&quot;: &quot;c403532b196ed4020cc86d001feb091c009d3d26&quot;\n&#125;\n</code></pre>\n<h3 id=\"è·å–å™¨çš„æ¶æ„\"><a class=\"anchor\" href=\"#è·å–å™¨çš„æ¶æ„\">#</a> è·å–å™¨çš„æ¶æ„</h3>\n<p>Client: interacts directly with the data source.</p>\n<p>Backend: orchestrates the fetching process by using the Client.</p>\n<p>CommandLine: defines the arguments to initialize and run the Backend from the command line.</p>\n",
            "tags": [
                "xlab"
            ]
        },
        {
            "id": "https://songlinlife.top/2022/MIT6.824/MIT6-824-GFS/",
            "url": "https://songlinlife.top/2022/MIT6.824/MIT6-824-GFS/",
            "title": "MIT6.824: GFS",
            "date_published": "2022-02-23T02:56:45.000Z",
            "content_html": "<h3 id=\"gfsgoogle-file-system\"><a class=\"anchor\" href=\"#gfsgoogle-file-system\">#</a> GFSï¼ˆGoogle File Systemï¼‰</h3>\n<blockquote>\n<p>In this paper, we present file system interface extensions designed to support distributed applications, discuss many aspects of our design, and report measurements from both micro-benchmarks and real world use.</p>\n</blockquote>\n<p>è¿™ç¯‡æ–‡ç« ä»‹ç»æ—¨åœ¨<strong>æ”¯æŒåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„æ–‡ä»¶ç³»ç»Ÿæ¥å£æ‰©å±•</strong>ï¼Œè®¨è®ºäº†æˆ‘ä»¬è®¾è®¡çš„è®¸å¤šæ–¹é¢ï¼Œå¹¶æŠ¥å‘Šäº†ä»å¾®åŸºå‡†æµ‹è¯•å’ŒçœŸå®ä¸–ç•Œä½¿ç”¨ä¸¤æ–¹é¢çš„æµ‹é‡ç»“æœã€‚</p>\n<h4 id=\"keywords\"><a class=\"anchor\" href=\"#keywords\">#</a> Keywords</h4>\n<p>Fault tolerance, scalability, data storage, clustered storage</p>\n<h4 id=\"introduction\"><a class=\"anchor\" href=\"#introduction\">#</a> Introduction</h4>\n<blockquote>\n<p>constant monitoring, error detection, fault tolerance, and automatic recovery must be integral to the system.</p>\n</blockquote>\n<p>ä½œè€…è®¤ä¸ºæŒç»­ç›‘æ§ï¼Œé”™è¯¯æ£€æµ‹ï¼Œæ•…éšœå®¹å¿ï¼Œè‡ªåŠ¨æ¢å¤æ˜¯ç³»ç»Ÿçš„å…³é”®æ‰€åœ¨ã€‚</p>\n<h4 id=\"è®¾è®¡ç†å¿µ\"><a class=\"anchor\" href=\"#è®¾è®¡ç†å¿µ\">#</a> è®¾è®¡ç†å¿µ</h4>\n<ul>\n<li>ç³»ç»Ÿç”±è®¸å¤šä¾¿å®œçš„æœºå™¨ç»„æˆï¼Œæ‰€ä»¥ç»å¸¸ä¼šæœ‰ fail æƒ…å†µï¼Œç›‘æ§ã€æ£€æµ‹ã€æ•…éšœæ¢å¤æ˜¯æ—¥å¸¸ã€‚</li>\n<li>ç³»ç»Ÿä¼šå­˜å‚¨å¾ˆå¤š GB çº§åˆ«çš„å¤§æ–‡ä»¶ã€‚</li>\n<li>è¯»è´Ÿè½½ä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼šå¤§æµå¼è¯»å’Œå°çš„éšæœºè¯»ã€‚</li>\n<li>å†™è´Ÿè½½é€šå¸¸æ˜¯ append dataã€‚ä¹Ÿå°±æ˜¯è¯´æ–‡ä»¶æ˜¯è¢« append è€Œä¸æ˜¯ä¿®æ”¹ã€‚å› æ­¤ä¸€ä¸ªæ–‡ä»¶ä¸€æ—¦å†™å®Œä¹‹åå°±å¾ˆå°‘è¢«ä¿®æ”¹ã€‚</li>\n<li>ç³»ç»Ÿå®ç°äº†å¤šå®¢æˆ·ç«¯å¹¶å‘ append åŒä¸€ä¸ªæ–‡ä»¶</li>\n<li>é«˜ç¨³å®šå¸¦å®½æ¯”ä½å»¶è¿Ÿæ›´é‡è¦ã€‚</li>\n</ul>\n<h4 id=\"æ¶æ„\"><a class=\"anchor\" href=\"#æ¶æ„\">#</a> æ¶æ„</h4>\n<p>ä¸€ä¸ª master æœºï¼ˆä»¥åŠå¤šä¸ª master æœºçš„ remote å‰¯æœ¬ï¼‰ï¼Œå¤šä¸ª chunkserversï¼Œä»¥åŠå¤šä¸ª clientsã€‚</p>\n<p>æ¯ä¸€ä¸ª chunk æœ‰ 64Mï¼Œå¹¶ä¸”è¢«ä¸€ä¸ª 64bit çš„ chunk handle ç»™å”¯ä¸€æ ‡è¯†ã€‚chunkhandle æ˜¯ chunk åˆ›å»ºæ—¶ç”± master æœºåˆ†é…çš„ï¼Œå¹¶ä¸”å¦‚æœ client è¦è®¿é—® chunk å¹¶ä¸”æŒæœ‰ chunk handleã€‚</p>\n<h4 id=\"è¯»æ“ä½œ\"><a class=\"anchor\" href=\"#è¯»æ“ä½œ\">#</a> è¯»æ“ä½œ</h4>\n<ol>\n<li>client å°† filename å’Œ byte offset è½¬æˆ chunk indexã€‚</li>\n<li>client å‘ master å‘é€ requestï¼ŒåŒ…å« chunk index å’Œ filename</li>\n<li>master è¿”å› chunk handle å’Œå‰¯æœ¬çš„ locationã€‚</li>\n<li>client ä½¿ç”¨ filename å’Œ chunk index ä½œä¸º keyï¼Œå°† master è¿”å›çš„æ•°æ®ä½œä¸º valueï¼Œç¼“å­˜èµ·æ¥ã€‚è¿™æ · client åœ¨ä¸€æ®µæ—¶é—´å†…å°±å¯ä»¥ä¸ç”¨å†å’Œ master æ²Ÿé€šäº†ã€‚</li>\n<li>client è®¿é—®è·ç¦»å®ƒæœ€è¿‘çš„ replicasã€‚</li>\n</ol>\n<h4 id=\"metadata\"><a class=\"anchor\" href=\"#metadata\">#</a> MetaData</h4>\n<p>ä¸‰ç§ä¸»è¦çš„ MetaDataï¼šthe file and chunk namespaces, the mapping from files to chunks, and the locations of each chunkâ€™s replicasã€‚</p>\n<p>ä¸»è¦ MetaData éƒ½æ˜¯å­˜æ”¾åœ¨ Master æœºçš„å†…å­˜ä¸­ï¼Œä½†æ˜¯ <code>namespace</code>  å’Œ <code>mapping</code>  æ˜¯ä¼šå†™åˆ° local disk çš„ log ä¸­ï¼Œå¹¶ä¸”åœ¨ remote æœºä¸­å­˜æ”¾å¤‡ä»½ã€‚ä½†æ˜¯ location ä¸ä¼šæœ‰æŒç»­å­˜å‚¨ã€‚</p>\n<p>å› ä¸ºé›†ç¾¤ç»å¸¸ä¼šæœ‰æœºå™¨åŠ å…¥ã€å®•æœºã€é‡å¯ç­‰æƒ…å†µï¼Œæ‰€ä»¥æŒç»­åŒ–å­˜å‚¨ location ä¸æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ï¼Œæœ€å¥½è¿˜æ˜¯å‘¨æœŸæ€§è¯¢é—® chunkserversã€‚</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220223133116965.png\" alt=\"image-20220223133116965\" /></p>\n<h4 id=\"consistentå’Œdefined\"><a class=\"anchor\" href=\"#consistentå’Œdefined\">#</a> consistent å’Œ defined</h4>\n<p>å¦‚æœæ‰€æœ‰ client çœ‹åˆ°ç›¸åŒçš„æ•°æ®ï¼Œå°±è¢«è®¤ä¸ºæ˜¯ consistentã€‚</p>\n<p>å¦‚æœæ–‡ä»¶æ•°æ®æ”¹åŠ¨åï¼Œfile region è¿˜æ˜¯ consistent çš„ï¼Œå¹¶ä¸”æ‰€æœ‰ client éƒ½ä¼šçœ‹åˆ° mutation writes çš„å…¨éƒ¨å†…å®¹ï¼Œé‚£ä¹ˆå°±è¯´æ˜ region æ˜¯_defined_ã€‚</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220225093959514.png\" alt=\"image-20220225093959514\" /></p>\n<p>å¯¹äº GFS æ¥è¯´ï¼Œwrite å’Œ append è™½ç„¶éƒ½æ˜¯ mutation ä½†æ˜¯ä»–ä»¬è¿˜æ˜¯æœ‰ä¸åŒçš„ã€‚</p>\n<h4 id=\"writeå’Œappend\"><a class=\"anchor\" href=\"#writeå’Œappend\">#</a> Write å’Œ Append</h4>\n<p>è¯´å®è¯æˆ‘è¯»ç¬¬ä¸€éè®ºæ–‡æ—¶å€™æä¸æ‡‚ä¸ºä»€ä¹ˆ write æ“ä½œæ˜¯ undefined ä½† consistent è€Œ Record Append æ“ä½œæ˜¯ defined ä½† inconsistentã€‚å…¶å®è¿™ä¸ªä¸åŒç‚¹å°±æ˜¯ GFS è®¾è®¡çš„å·§å¦™ä¹‹å¤„ï¼Œwrite chunk æ“ä½œéœ€è¦åˆ¶å®š offsetï¼Œè€Œ Append æ“ä½œåˆ™ä¸ç”¨ã€‚</p>\n<p>æ•™æˆå…³äº Append æ“ä½œçš„è¿™ä¸ªä¾‹å­è®²çš„å¾ˆå¥½ï¼š</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220225095400456.png\" alt=\"image-20220225095400456\" /></p>\n<p>å¯¹äº append æ“ä½œï¼Œå¦‚æœç¬¬ä¸€æ¬¡ Append æ“ä½œå¤±è´¥ä¹‹åï¼Œé‚£ä¹ˆä¼šé‡æ–°å‘èµ· append è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯ primary å†å†™ä¸€éç„¶åè®©å…¶ä»–å‰¯æœ¬ä¹Ÿå†™ä¸€éï¼Œé‚£ä¹ˆé—®é¢˜å°±æ¥äº†ï¼Œä¹‹å‰çš„ Append æ“ä½œä¸­ï¼Œæœ‰çš„ replicas æˆåŠŸå†™å…¥äº† dataï¼Œæœ‰çš„æ²¡æœ‰ã€‚å¤±è´¥çš„æ“ä½œä¸ä¼šè¦æ±‚è¿™äº› replicas åˆ é™¤ä¹‹å‰ append å¤±è´¥æ“ä½œå†™çš„æ•°æ®ï¼Œè€Œæ˜¯é‡æ–°å†å°¾éƒ¨è¿›è¡Œ Appendï¼Œå¹¶ä¸”è¦æ±‚åŒä¸€ä¸ª Records åœ¨æ‰€æœ‰çš„ replicas ä¸­å…·æœ‰ç›¸åŒçš„ offsetã€‚é‚£ä¹ˆå¾ˆæ˜¾ç„¶ä¸Šè¿°çš„ä¸‰ä¸ª replicas ä¸­æ•°æ®æ˜¯ä¸ä¸€è‡´çš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸€ä¸ª append æ“ä½œå†™çš„æ•°æ®ï¼Œæ•°æ®ä¸ä¼šè¢«è¦†ç›–ï¼Œé‚£ä¹ˆä»–å°±æ˜¯ä¸€ä¸ª defined æ“ä½œã€‚</p>\n<p>å¯¹äº write æ“ä½œï¼Œå› ä¸ºæ‰€æœ‰ client æœºå¹¶å‘å†™ç›¸åŒçš„ offsetï¼Œé‚£ä¹ˆåŠæ—¶å¤±è´¥åï¼Œæœ‰çš„ replicas å†™äº†ï¼Œæœ‰çš„æ²¡æœ‰ï¼Œé‚£ä¹ˆåœ¨ä¸‹ä¸€æ¬¡é‡æ–°å‘èµ· Write æ“ä½œä¸­ï¼Œä¼šå†™è¦†ç›–æ‰ä¹‹å‰å†™çš„æ•°æ®ã€‚å› æ­¤ write æ“ä½œæ˜¯ä¸€è‡´çš„ï¼Œå¹¶ä¸”å› ä¸ºå†™è¦†ç›–ï¼Œæˆ‘ä»¬æ²¡æ³•çŸ¥é“åˆ°åº•æ˜¯ä»€ä¹ˆåºåˆ—å†™çš„ï¼Œæ‰€æœ‰æ˜¯ undefinedã€‚</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220225094811181.png\" alt=\"image-20220225094811181\" /></p>\n<h4 id=\"snapshot\"><a class=\"anchor\" href=\"#snapshot\">#</a> snapshot</h4>\n<p>è¯´å®è¯ï¼Œæˆ‘æ²¡çœ‹æ‡‚å—å¼•ç”¨ã€‚ã€‚ã€‚</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220223150359437.png\" alt=\"image-20220223150359437\" /></p>\n<h3 id=\"ä¸Šè¯¾\"><a class=\"anchor\" href=\"#ä¸Šè¯¾\">#</a> ä¸Šè¯¾</h3>\n<p>consistency ä¼šå¯¼è‡´ low performance</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220223182829839.png\" alt=\"image-20220223182829839\" /></p>\n<p>ä¸å¥½çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼š</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220223184155101.png\" alt=\"image-20220223184155101\" /></p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220223185145057.png\" alt=\"image-20220223185145057\" /></p>\n",
            "tags": [
                "MIT6.824"
            ]
        },
        {
            "id": "https://songlinlife.top/2022/MIT6.824/MIT6-824-mapreduce/",
            "url": "https://songlinlife.top/2022/MIT6.824/MIT6-824-mapreduce/",
            "title": "MIT6.824: mapreduce",
            "date_published": "2022-02-20T02:28:51.000Z",
            "content_html": "<h3 id=\"å¼€æ–°å‘äº†\"><a class=\"anchor\" href=\"#å¼€æ–°å‘äº†\">#</a> å¼€æ–°å‘äº†ï¼</h3>\n<p>ä»¤äººæ„Ÿå¹ï¼Œè‡ªå·±è™½ç„¶å¼€äº†å¾ˆå¤šä¸ªå‘ï¼Œä½†æ˜¯èƒ½å¤Ÿå®Œæˆçš„å´å¾ˆå°‘ï¼Œè¿™æ¬¡çš„ MIT6.824 æ˜¯æˆ‘ç¡®å®šå­¦çš„ä¸€é—¨è¯¾ç¨‹ï¼Œè¦æƒ³å…¥é—¨åˆ†å¸ƒå¼ç»•ä¸å¼€çš„ä¸€é—¨è¯¾ï¼Œæ²¡åŠæ³•ï¼Œè€è€å®å®å­¦ä¸€æ¬¡ï¼ŒæŠŠæ‰€æœ‰çš„ lab åšå®Œï¼Œè¿™å°±æ˜¯æˆ‘çš„ç›®æ ‡ï¼</p>\n<h3 id=\"è®ºæ–‡é˜…è¯»\"><a class=\"anchor\" href=\"#è®ºæ–‡é˜…è¯»\">#</a> è®ºæ–‡é˜…è¯»</h3>\n<p>å› ä¸ºè¿™é—¨è¯¾å¿…é¡»è¦çœ‹è®ºæ–‡ï¼Œæ‰€ä»¥å°±å¾ˆç—›è‹¦ã€‚ã€‚ã€‚</p>\n<h4 id=\"é—®é¢˜\"><a class=\"anchor\" href=\"#é—®é¢˜\">#</a> é—®é¢˜</h4>\n<p>åŸæœ‰çš„è®¡ç®—æ˜¯å¾ˆç®€å•çš„ï¼Œä½†æ˜¯å› ä¸ºæ•°æ®å¾ˆå¤§éœ€è¦åšæˆåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ‰€ä»¥å¦‚ä½• <code>å¹¶è¡ŒåŒ–è®¡ç®—</code> ã€ <code>åˆ†å‘æ•°æ®</code> å’Œ <code>å¤„ç†æ•…éšœ</code> ç­‰é—®é¢˜ä½¿å¾—åŸæœ¬ç®€å•çš„è®¡ç®—å˜å¾—æ™¦æ¶©éš¾æ‡‚ï¼Œéœ€è¦å¤§é‡å¤æ‚çš„ä»£ç æ¥å¤„ç†è¿™äº›é—®é¢˜ã€‚</p>\n<h4 id=\"mapreduceå‡½æ•°\"><a class=\"anchor\" href=\"#mapreduceå‡½æ•°\">#</a> MapReduce å‡½æ•°</h4>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">map</span><span class=\"token punctuation\">(</span>String key<span class=\"token punctuation\">,</span> String value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// key: document name</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// value: document contents</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">for</span> each word w in value<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    \t<span class=\"token function\">EmitIntermediate</span><span class=\"token punctuation\">(</span>w<span class=\"token punctuation\">,</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span>String key<span class=\"token punctuation\">,</span> Iterator values<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// key: a word</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// values: a list of counts</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token builtin\">int</span> result <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">for</span> each v in values<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    \tresult <span class=\"token operator\">+=</span> <span class=\"token function\">ParseInt</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token function\">Emit</span><span class=\"token punctuation\">(</span><span class=\"token function\">AsString</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>map ç”¨äºå‘å°„ä¸­é—´é”®å€¼å¯¹ï¼Œè€Œ reduce å‡½æ•°åˆ™è´Ÿè´£å¯¹ä¸­é—´é”®å€¼å¯¹ä¸­ç›¸åŒçš„ key è¿›è¡Œ aggregate å¤„ç†ã€‚</p>\n<h4 id=\"æ‰§è¡Œæ¦‚è¿°\"><a class=\"anchor\" href=\"#æ‰§è¡Œæ¦‚è¿°\">#</a> æ‰§è¡Œæ¦‚è¿°</h4>\n<p>é¦–å…ˆæ˜ç¡® map æœºå’Œ reduce æœºç»„æˆäº†ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ‰€ä»¥è¿™é‡Œæœ‰ä¸€ä¸ª master æœºç”¨äº assign ä»»åŠ¡ã€‚</p>\n<ol>\n<li>å°† raw data åˆ‡åˆ†ä¸º M ä¸ª splitsã€‚æ¯ä¸€ä¸ª split å¤§å°å¯ä»¥ç”±ç”¨æˆ·è¿›è¡ŒæŒ‡å®šã€‚</li>\n<li>master æœºå°† map ä»»åŠ¡å’Œ reduce ä»»åŠ¡åˆ†åˆ«è‡ªæ‹ç»™ä¸åŒçš„ workersã€‚</li>\n<li>map æœºè¯»å– input splitï¼Œé€šè¿‡ <code>Map</code>  å‡½æ•°å°† k/v å¯¹è¿›è¡Œè¾“å‡ºã€‚è¿™äº›ä¸­é—´é”®å€¼å¯¹ç¼“å­˜åœ¨ map æœºçš„å†…å­˜ä¸­ã€‚</li>\n<li>è¿™äº›ç¼“å­˜çš„é”®å€¼å¯¹ä¼šå®šæœŸå­˜æœ¬åœ°ç£ç›˜ï¼ŒåŒæ—¶ä¼šè¢«åˆ†åŒºå‡½æ•°åˆ†ä¸º R ä¸ª regionsã€‚å¯ä»¥ç”¨ hash (key) mod Rã€‚local disk çš„ä½ç½®ä¼šè¢«å‘é€ç»™ master å³ï¼Œmaster æœºæ¥å‘Šè¯‰ reduce æœºå­˜å‚¨ä½ç½®ã€‚</li>\n<li>reduce æœºè¢« master æœºå‘ŠçŸ¥å­˜å‚¨ä½ç½®åï¼Œé€šè¿‡ rpc è¿œç¨‹è°ƒç”¨æ¥è¯»å–æœ‰ map æœºåˆ¶é€ çš„ç¼“å­˜ kv ä¸­é—´å¯¹ã€‚å½“ reduce æœºè¯»å–å®Œäº†æ‰€æœ‰çš„æ•°æ®åï¼Œä¼šé€šè¿‡ sort æ“ä½œæ¥å°†ç›¸åŒ key è¿›è¡Œ groupã€‚å› ä¸ºä¸­é—´æ•°æ®å¯ä»¥è¿‡å¤§ï¼Œä»¥è‡³äºéš¾ä»¥è¯»å…¥åˆ°å†…å­˜ä¸­ï¼Œå› æ­¤ sort æ“ä½œæ˜¯å¿…é¡»çš„ã€‚</li>\n<li>reduce å³ä½¿ç”¨ <code>Reduce</code>  å‡½æ•°æ¥å¯¹è¿™äº›æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå¹¶å°†æ•°æ®è¾“å‡ºåˆ°æœ€ç»ˆçš„åˆ†åŒºã€‚</li>\n<li>å½“ mapreduce æ“ä½œæ‰§è¡Œå®Œæ¯•åï¼Œmaster æœºè´Ÿè´£å”¤é†’ç”¨æˆ·ç¨‹åºï¼Œå¹¶æŠŠ MapReduce è°ƒç”¨è¾“å‡ºè¿”å›ç»™ç”¨æˆ·ç¨‹åºã€‚</li>\n</ol>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220220115958846.png\" alt=\"image-20220220115958846\" /></p>\n<h4 id=\"ä½¿ç”¨ä¾‹å­\"><a class=\"anchor\" href=\"#ä½¿ç”¨ä¾‹å­\">#</a> ä½¿ç”¨ä¾‹å­</h4>\n<p>è®¡ç®— URL çš„é¢‘ç‡ï¼Œè¿™ä¸ªå°±å’Œ wordcount å‡½æ•°ç›¸åŒã€‚</p>\n<p>ReverseWeb-Link Graph: map å‡½æ•°è¾“å‡º &lt;target, source&gt;ï¼Œtarget æ˜¯å¯¹åº”çš„ urlï¼Œè€Œ source å°±æ˜¯ target url å‡ºç°çš„ç½‘é¡µ URLï¼Œè€Œ reduce è´Ÿè´£å°† source è¿›è¡Œ concatï¼Œè¾“å‡º &lt; target, list (source)&gt;</p>\n<p>Inverted Index: å’Œä¸Šé¢çš„ä¾‹å­ç±»ä¼¼ã€‚</p>\n<h3 id=\"åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç‰¹æ€§\"><a class=\"anchor\" href=\"#åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç‰¹æ€§\">#</a> åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç‰¹æ€§</h3>\n<h4 id=\"é”™è¯¯å®¹å¿\"><a class=\"anchor\" href=\"#é”™è¯¯å®¹å¿\">#</a> é”™è¯¯å®¹å¿</h4>\n<p>Availabilityï¼šå³ä½¿ä¸€äº›æœºå™¨å‘ç”Ÿäº†æ•…éšœï¼Œç³»ç»Ÿä¾æ—§å¯ä»¥æä¾›æ— è¯¯çš„æœåŠ¡ï¼Œæ³¨æ„ï¼Œå¦‚æœå¾ˆå¤šæœºå™¨éƒ½å®•æœºï¼Œavailable system ä»ç„¶ä¼šåœæ­¢è¿è¡Œï¼Œä½†å¾—åˆ°ä¿®å¤åï¼Œç³»ç»Ÿå¯ä»¥ç»§ç»­æ­£ç¡®è¿è¡Œã€‚</p>\n<p>Recoverabilityï¼šç³»ç»Ÿå‘ç”Ÿæ•…éšœåï¼Œç»è¿‡ä¿®å¤ä»ç„¶å¯ä»¥æ­£ç¡®è¿è¡Œï¼Œå› æ­¤ Availability å°±åŒ…å«äº†ç³»ç»Ÿéœ€è¦ Recoverabilityã€‚</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220221152942785.png\" alt=\"image-20220221152942785\" /></p>\n<h3 id=\"lab1\"><a class=\"anchor\" href=\"#lab1\">#</a> LAB1</h3>\n<h4 id=\"job\"><a class=\"anchor\" href=\"#job\">#</a> Job</h4>\n<p>å®ç°åˆ†å¸ƒå¼ MapReduceï¼ŒåŒ…å«ä¸¤ä¸ªç¨‹åºï¼Œmaster å’Œ workerã€‚worker å’Œ master ä¹‹é—´é€šä¿¡é€šè¿‡ RPCï¼Œæ¯ä¸ª worker process å°†ä¼šå‘ master è¯¢é—®ä»»åŠ¡ï¼Œè¯»å–ä»»åŠ¡è¾“å…¥ï¼Œæ‰§è¡Œä»»åŠ¡ï¼Œå¹¶å°†ä»»åŠ¡ç»“æœè¾“å‡ºåˆ°ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ä¸­ã€‚å¦‚æœ worker ä¸ä¸èƒ½åœ¨ 10s çš„æ—¶é—´å†…å®Œæˆä»»åŠ¡ï¼Œmaster éœ€è¦å°†ä»»åŠ¡åˆ†é…ç»™å¦ä¸€ä¸ª workerã€‚</p>\n<p>æ‰§è¡Œè¿‡ç¨‹ï¼š</p>\n<p>ç”Ÿæˆæ’ä»¶</p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">go</span> build <span class=\"token operator\">-</span>buildmode<span class=\"token operator\">=</span>plugin <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>mrapps<span class=\"token operator\">/</span>wc<span class=\"token punctuation\">.</span><span class=\"token keyword\">go</span></pre></td></tr></table></figure><p>åœ¨ main ç›®å½•ä¸‹æ‰§è¡Œï¼š</p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">go</span> run mrmaster<span class=\"token punctuation\">.</span><span class=\"token keyword\">go</span> pg<span class=\"token operator\">-</span><span class=\"token operator\">*</span><span class=\"token punctuation\">.</span>txt</pre></td></tr></table></figure><p>è¿™ä¸ªå°±æ˜¯ master å‡½æ•°</p>\n<p>æ‰§è¡Œ worker</p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">go</span> run mrworker<span class=\"token punctuation\">.</span><span class=\"token keyword\">go</span> wc<span class=\"token punctuation\">.</span>so</pre></td></tr></table></figure><h4 id=\"éœ€è¦éµå®ˆçš„è§„åˆ™\"><a class=\"anchor\" href=\"#éœ€è¦éµå®ˆçš„è§„åˆ™\">#</a> éœ€è¦éµå®ˆçš„è§„åˆ™</h4>\n<ol>\n<li>map å‡½æ•°ä¼ é€’çš„ä¸­é—´ key éœ€è¦åˆ†é…åˆ° nReduce ä¸ª bucket ä¸­ï¼Œè€Œ <code>NReduce</code>  è¿™ä¸ªå‚æ•°ä¼šè¢« <code>main/mrmaster.go</code>  ä¼ é€’ç»™ <code>MakeMaster()</code></li>\n<li>ç»“æœéœ€è¦ä¿æŒä¸º <code>mr-out-X</code>  è¿™ç§æ ¼å¼ï¼Œå…¶ä¸­ <code>X</code>  æ˜¯ <code>reduce</code>  çš„ç¼–å·ã€‚</li>\n<li><code>mr-out-x</code>  æ–‡ä»¶ä¸­æ¯ä¸€è¡Œè®°å½•äº† reduce çš„è¾“å‡ºï¼Œå¹¶ä¸”æ ¼å¼ä¸º  <code>%v %v</code></li>\n<li>åªèƒ½æ”¹åŠ¨è¿™ä¸‰ä¸ªæ–‡ä»¶ <code>mr/worker.go</code> ,  <code>mr/master.go</code> ,  <code>mr/rpc.go</code> ã€‚</li>\n<li>worker éœ€è¦æŠŠ map çš„ä¸­é—´ç»“æœä¿å­˜åˆ°å½“å‰ç›®å½•ä¸­ã€‚</li>\n<li>mr/master.go ä¸­éœ€è¦å®ç° <code>Done()</code>  æ–¹æ³•ï¼Œå¦‚æœè¿”å› <code>true</code>  è¡¨ç¤º MapReduce ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œ  <code>mrmaster.go</code>  æ‰ä¼šé€€å‡ºã€‚</li>\n<li>worker è¿˜éœ€è¦å®ç° <code>call</code>  æ–¹æ³•ï¼Œå¦‚æœ worker ä¸èƒ½å’Œ master è¿›è¡Œæ²Ÿé€šï¼Œé‚£ä¹ˆ worker å°±ä¼šç»ˆæ­¢ã€‚ï¼ˆè¿˜å¯ä»¥å®ç°ä¸€ä¸ª pseudo-taskï¼Œè¿™ä¸ªä»»åŠ¡å°±æ˜¯â€please exit&quot;.</li>\n</ol>\n<h4 id=\"æç¤º\"><a class=\"anchor\" href=\"#æç¤º\">#</a> æç¤º</h4>\n<ol>\n<li><code>mr/worker.go</code>  é€šè¿‡ RPC å‘ master è¿›è¡Œ taskï¼Œmaster å‘é€ä¸€ä¸ªè¿˜æ²¡è¿›è¿‡ map çš„æ–‡ä»¶åï¼Œç„¶å worker å°±å¼€å§‹è¯»å–è¿™ä¸ªæ–‡ä»¶å¹¶è°ƒç”¨ Map å‡½æ•°ã€‚</li>\n<li>Map å’Œ Reduce å‡½æ•°ä¸ç”¨è‡ªå·±å†™ï¼Œå·²ç»åœ¨ plugin ä¿é‡å®ç°äº†ã€‚</li>\n<li>æ¯æ¬¡éƒ½è¦å…ˆ ``go build -buildmode=plugin ../mrapps/wc.go`</li>\n<li><code>mr-X-Y</code>  çš„æ–¹å¼ç»™ä¸­é—´æ–‡ä»¶å‘½åï¼ŒX å€¼ Map taskï¼Œ Y æŒ‡ Reduce taskã€‚</li>\n<li>kv é”®å€¼å¯¹å¯ä»¥ä½¿ç”¨ json æ–‡ä»¶æ ¼å¼è¿›è¡Œå­˜å‚¨ã€‚</li>\n<li>The map part of your worker can use the  <code>ihash(key)</code>  function (in  <code>worker.go</code> ) to pick the reduce task for a given keyã€‚ä¹Ÿå°±æ˜¯è¯´ <code>ihash</code>  æ–¹å¼åœ¨ map é˜¶æ®µå°±çŸ¥é“è¿™ä¸ª key è¯¥ç”±å“ªä¸ª reduce è¿›è¡Œå¤„ç†ã€‚</li>\n<li><code>mrsequential.go</code>  çš„ä»£ç å¯ä»¥å€Ÿé‰´ã€‚<strong>æ³¨æ„ sortã€‚</strong></li>\n<li>master ä½œä¸º RPC æœåŠ¡å™¨ï¼Œå®ƒæ˜¯å¹¶å‘çš„ï¼Œæ‰€ä»¥åˆ°æ³¨æ„åŠ é”ã€‚</li>\n<li><code>go build -race</code>  å¯ä»¥ç”¨ä½œæ£€æŸ¥å¹¶å‘ã€‚</li>\n<li>æ‰€æœ‰çš„ map æ‰§è¡Œå®Œæ¯•ä¹‹å reduce æ‰ä¼šæ‰§è¡Œï¼Œæ‰€ä»¥ reduce worker éœ€è¦ç­‰å¾…ã€‚</li>\n<li>å¯¹äºæ‰§è¡Œè¶…æ—¶çš„ workerï¼Œmaster éœ€è¦é‡æ–°åˆ†é…ä»»åŠ¡ã€‚</li>\n<li><code>mrapps/crash.go</code>  ç”¨äºæ£€æµ‹å´©æºƒå›å¤ã€‚</li>\n<li>map å‡½æ•°å…ˆç”¨ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å†™ä¸­é—´æ•°æ®ï¼Œå½“æ‰€æœ‰çš„æ•°æ®å†™å®Œä¹‹åï¼Œåœ¨å°†æ–‡ä»¶åè‡ªåŠ¨é‡å‘½åã€‚</li>\n</ol>\n<h4 id=\"é‡åˆ°çš„é—®é¢˜\"><a class=\"anchor\" href=\"#é‡åˆ°çš„é—®é¢˜\">#</a> é‡åˆ°çš„é—®é¢˜</h4>\n<ol>\n<li>taskstate 0 ç©ºé—² 1 å¤„ç†ä¸­ 2 å¤„ç†å®Œæ¯•</li>\n<li>å‘ç‚¹ï¼šåªæœ‰å½“å‰ worker æ‰§è¡Œå®Œäº†ä¸€ä¸ª maptask æˆ–è€… reduce task æ‰èƒ½å†æ‰§è¡Œ map æˆ–è€… reduce taskã€‚ä¸èƒ½åœ¨ä¸€ä¸ª worker æœºä¸ŠåŒæ—¶å¹¶å‘æ‰§è¡Œå¤šä¸ª Map æˆ– reduce å‡½æ•°ã€‚</li>\n<li>å†™ä¸­é—´æ–‡ä»¶éœ€è¦ä½¿ç”¨ os.O_TRUNCï¼Œä¸ç„¶æ‰§è¡Œ sh è„šæœ¬ä¼šå‡ºé”™ã€‚</li>\n<li>æœ€åçš„æµ‹è¯•ç‚¹åªèƒ½ç”¨ Sock æ–¹å¼è¿›è¡Œ rpcï¼Œä¸èƒ½ç”¨ tcp æ–¹å¼ã€‚</li>\n</ol>\n<h4 id=\"repo\"><a class=\"anchor\" href=\"#repo\">#</a> Repo</h4>\n<p>ä»£ç æ”¾åœ¨äº† github ä¸Šï¼š</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1NvbmdsaW5MaWZlL01hcFJlZHVjZQ==\">MapReduce</span></p>\n<p>å®Œæˆäº†æ‰€æœ‰æµ‹è¯•ç‚¹ï¼š</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220224114038738.png\" alt=\"image-20220224114038738\" /></p>\n",
            "tags": [
                "MIT6.824"
            ]
        },
        {
            "id": "https://songlinlife.top/2022/Bot/Bot-%E8%8E%B7%E5%8F%96%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE/",
            "url": "https://songlinlife.top/2022/Bot/Bot-%E8%8E%B7%E5%8F%96%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE/",
            "title": "Bot: è·å–åŸºç¡€æ•°æ®",
            "date_published": "2022-02-19T08:46:11.000Z",
            "content_html": "<h3 id=\"ç­›é€‰è´¦å·\"><a class=\"anchor\" href=\"#ç­›é€‰è´¦å·\">#</a> ç­›é€‰è´¦å·</h3>\n<p>æˆ‘çš„åˆå§‹æƒ³æ³•æ˜¯å…ˆè·å–å¤´éƒ¨å‰ 10000 åæ´»è·ƒçš„ github è´¦å·ã€‚</p>\n<p>github æ—¥å¿—æ•°æ®æœ‰çš„ action ç§ç±»ï¼š</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"PublicEvent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"WatchEvent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token property\">\"action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"started\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"IssueCommentEvent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token property\">\"action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"created\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ForkEvent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token property\">\"action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"PullRequestEvent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token property\">\"action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"opened\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CreateEvent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token property\">\"action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"DeleteEvent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token property\">\"action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"PullRequestEvent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token property\">\"action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"closed\"</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"PushEvent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token property\">\"action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"IssuesEvent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token property\">\"action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"reopened\"</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"IssuesEvent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token property\">\"action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"closed\"</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"PullRequestReviewCommentEvent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token property\">\"action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"created\"</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"IssuesEvent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token property\">\"action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"opened\"</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"MemberEvent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token property\">\"action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"added\"</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CommitCommentEvent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token property\">\"action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ReleaseEvent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token property\">\"action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"published\"</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"GollumEvent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>    <span class=\"token property\">\"action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"PullRequestEvent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token property\">\"action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"reopened\"</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>å¯¹äºè¿™äº›è¡Œä¸ºï¼Œæˆ‘ç›®å‰è¿˜æ²¡æ³•ç¡®è®¤å“ªäº›æ˜¯ github bot è´¦å·ä¸èƒ½æœ‰çš„ã€‚</p>\n<p>æ‰€ä»¥ï¼Œæˆ‘æ‰“ç®—å…ˆç›´æ¥è®¡ç®—è¿™äº›è¡Œä¸ºçš„æ•°ï¼Œç„¶åç¡®å®š botã€‚</p>\n<h4 id=\"æ ¹æ®æ—¥æœŸå’Œè¡Œä¸ºæ•°è¿›è¡Œç­›é€‰\"><a class=\"anchor\" href=\"#æ ¹æ®æ—¥æœŸå’Œè¡Œä¸ºæ•°è¿›è¡Œç­›é€‰\">#</a> æ ¹æ®æ—¥æœŸå’Œè¡Œä¸ºæ•°è¿›è¡Œç­›é€‰</h4>\n<p>å…ˆç­›é€‰  <code>2020-6-20</code>  åˆ° <code>2020-6-26</code>  çš„è¿™ä¸€å‘¨æ•°æ®ã€‚</p>\n",
            "tags": [
                "Bot"
            ]
        },
        {
            "id": "https://songlinlife.top/2022/%E6%88%91%E7%9A%84node%E8%AE%BE%E7%BD%AE/",
            "url": "https://songlinlife.top/2022/%E6%88%91%E7%9A%84node%E8%AE%BE%E7%BD%AE/",
            "title": "æˆ‘çš„nodeè®¾ç½®",
            "date_published": "2022-02-17T02:52:20.000Z",
            "content_html": "<p>è¿™ä¸ªæ–‡ç« ç”¨äºè®°å½•æˆ‘çš„ node è®¾ç½®</p>\n<h3 id=\"å®‰è£…nvm\"><a class=\"anchor\" href=\"#å®‰è£…nvm\">#</a> å®‰è£… nvm</h3>\n<pre><code class=\"language-sh\">cd ~/\ngit clone https://github.com/nvm-sh/nvm.git .nvm\ncd ~/.nvm\nsource ~/.nvm/nvm.sh\nexport NVM_DIR=&quot;$HOME/.nvm&quot;\n[ -s &quot;$NVM_DIR/nvm.sh&quot; ] &amp;&amp; \\. &quot;$NVM_DIR/nvm.sh&quot;  # This loads nvm\n[ -s &quot;$NVM_DIR/bash_completion&quot; ] &amp;&amp; \\. &quot;$NVM_DIR/bash_completion&quot;  # This loads nvm bash_completion\n</code></pre>\n<h3 id=\"å®‰è£…node\"><a class=\"anchor\" href=\"#å®‰è£…node\">#</a> å®‰è£… node</h3>\n<pre><code class=\"language-sh\">nvm install 6\nnvm use 16\nnode -v\n</code></pre>\n<h3 id=\"ä½¿ç”¨cnpmä»£æ›¿npmå‘½ä»¤\"><a class=\"anchor\" href=\"#ä½¿ç”¨cnpmä»£æ›¿npmå‘½ä»¤\">#</a> ä½¿ç”¨ cnpm ä»£æ›¿ npm å‘½ä»¤</h3>\n<pre><code class=\"language-sh\">alias cnpm=&quot;npm --registry=https://registry.npm.taobao.org \\\n--cache=$HOME/.npm/.cache/cnpm \\\n--disturl=https://npm.taobao.org/dist \\\n--userconfig=$HOME/.cnpmrc&quot;\n</code></pre>\n<h3 id=\"åˆ›å»ºglobalæ–‡ä»¶å¤¹\"><a class=\"anchor\" href=\"#åˆ›å»ºglobalæ–‡ä»¶å¤¹\">#</a> åˆ›å»º global æ–‡ä»¶å¤¹</h3>\n<pre><code class=\"language-sh\">mkdir ~/.npm-global\nnpm config set prefix '~/.npm-global'\nexport PATH=$PATH:$/.npm-global/bin\n</code></pre>\n",
            "tags": [
                "js"
            ]
        },
        {
            "id": "https://songlinlife.top/2022/%E5%AF%86%E7%A0%81%E5%AD%A6/%E5%AF%86%E7%A0%81%E5%AD%A601/",
            "url": "https://songlinlife.top/2022/%E5%AF%86%E7%A0%81%E5%AD%A6/%E5%AF%86%E7%A0%81%E5%AD%A601/",
            "title": "å¯†ç å­¦01",
            "date_published": "2022-02-16T06:47:27.000Z",
            "content_html": "<h3 id=\"å¯¹ç§°åŠ å¯†\"><a class=\"anchor\" href=\"#å¯¹ç§°åŠ å¯†\">#</a> å¯¹ç§°åŠ å¯†</h3>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220216151636419.png\" alt=\"image-20220216151636419\" /></p>\n<p>è¯æ˜ OTP æ˜¯ prefect secrecyã€‚</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220216165451603.png\" alt=\"image-20220216165451603\" /></p>\n<p>å‰ç¼€é¢„æµ‹ï¼š</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220216173007164.png\" alt=\"image-20220216173007164\" /></p>\n<p>å¯å¿½ç•¥ä¸ä¸å¯å¿½ç•¥ï¼š</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220216174024970.png\" alt=\"image-20220216174024970\" /></p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220216190332209.png\" alt=\"image-20220216190332209\" /></p>\n<p>Salsa20ï¼š</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220216201312134.png\" alt=\"image-20220216201312134\" /></p>\n",
            "tags": [
                "å¯†ç å­¦"
            ]
        },
        {
            "id": "https://songlinlife.top/2022/js/js%E5%AD%A6%E4%B9%A0/",
            "url": "https://songlinlife.top/2022/js/js%E5%AD%A6%E4%B9%A0/",
            "title": "jså­¦ä¹ ",
            "date_published": "2022-01-28T14:35:17.000Z",
            "content_html": "<h3 id=\"var\"><a class=\"anchor\" href=\"#var\">#</a> Var</h3>\n<h3 id=\"å®šä¹‰å˜é‡\"><a class=\"anchor\" href=\"#å®šä¹‰å˜é‡\">#</a> å®šä¹‰å˜é‡</h3>\n<h4 id=\"var-2\"><a class=\"anchor\" href=\"#var-2\">#</a> var</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> a <span class=\"token comment\">// å®šä¹‰äº† a</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a <span class=\"token operator\">=</span> <span class=\"token number\">2</span></pre></td></tr></table></figure><p>var æ˜¯å®šä¹‰å˜é‡çš„ä¸€ç§æ–¹å¼ï¼Œå®ƒçš„ä½œç”¨äºå°±æ˜¯å½“å‰çš„å±€éƒ¨ç¯å¢ƒï¼Œå¯ä»¥æ˜¯å‡½æ•°é‡Œçš„å±€éƒ¨å˜é‡ã€‚</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>a <span class=\"token operator\">=</span> <span class=\"token number\">2</span></pre></td></tr></table></figure><p>è¿™æ ·çš„æœªå£°æ˜å˜é‡å°±æ˜¯å…¨å±€å˜é‡</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> x <span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">var</span> x<span class=\"token operator\">=</span>y<span class=\"token operator\">=</span><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>æ¥çœ‹è¿™æ®µä»£ç ï¼Œæ‰“å°æ˜¯æ˜¯ <code>0 1</code>  è€Œä¸æ˜¯æŠ¥é”™æœªå®šä¹‰ã€‚å› ä¸º <code>x</code>  åœ¨å…¨å±€è¢«å®šä¹‰ï¼Œè€Œ <code>y</code>  è™½ç„¶åœ¨å‡½æ•° <code>f</code>  é‡Œè¢«å®šä¹‰ï¼Œä½†è¢«å£°æ˜ä¸ºäº†å…¨éƒ¨å˜é‡ã€‚</p>\n<p>ä½†æ˜¯æ³¨æ„ï¼Œå¦‚æœè¿™æ ·å†™ï¼š</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">var</span> x<span class=\"token punctuation\">,</span>y<span class=\"token operator\">=</span>x<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºå®šä¹‰ y ä¸ºå±€éƒ¨å˜é‡ã€‚</p>\n<p>å¤šä¸ªå˜é‡åˆå§‹åŒ–ï¼š</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> x<span class=\"token punctuation\">,</span>y<span class=\"token operator\">=</span>x<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>è¿˜æ˜¯çœ‹è¿™ä¸ªä»£ç ï¼Œå®ƒä¼šå…ˆå®šä¹‰ä¸¤ä¸ªå˜é‡ï¼Œ <code>x</code>  å’Œ  <code>y</code> ï¼Œå…¶ä¸­ <code>x</code>  ä¼šè¢«å…ˆèµ‹å€¼ä¸º 0ï¼Œç„¶åå†å°† x çš„å€¼èµ‹å€¼ç»™ yï¼Œæœ€åä¸¤ä¸ªå˜é‡éƒ½è¢«åˆå§‹åŒ–ä¸º 0.</p>\n<p>ä½†æ˜¯å¦‚æœæ˜¯ï¼š</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> x<span class=\"token operator\">=</span>y<span class=\"token punctuation\">,</span>y<span class=\"token operator\">=</span><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>x å°±æ˜¯ <code>undefined</code> ï¼Œå› ä¸º x ç”¨ y èµ‹å€¼ï¼Œè€Œæ­¤æ—¶ y è¿˜æ²¡æœ‰èµ‹å€¼ã€‚</p>\n<p>é‡å¤å®šä¹‰ï¼š</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> myName <span class=\"token operator\">=</span> <span class=\"token string\">'Chris'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> myName <span class=\"token operator\">=</span> <span class=\"token string\">'Bob'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>myName<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>ç”¨ <code>var</code>  æ¥é‡å¤å®šä¹‰å˜é‡ä¸ä¼šæŠ¥é”™ã€‚</p>\n<h3 id=\"å˜é‡æå‡\"><a class=\"anchor\" href=\"#å˜é‡æå‡\">#</a> å˜é‡æå‡</h3>\n<p>å˜é‡æå‡æŒ‡çš„æ˜¯ï¼š</p>\n<blockquote>\n<p>ç”±äºå˜é‡å£°æ˜ï¼ˆä»¥åŠå…¶ä»–å£°æ˜ï¼‰æ€»æ˜¯åœ¨ä»»æ„ä»£ç æ‰§è¡Œä¹‹å‰å¤„ç†çš„ï¼Œæ‰€ä»¥åœ¨ä»£ç ä¸­çš„ä»»æ„ä½ç½®å£°æ˜å˜é‡æ€»æ˜¯ç­‰æ•ˆäºåœ¨ä»£ç å¼€å¤´å£°æ˜ã€‚è¿™æ„å‘³ç€å˜é‡å¯ä»¥åœ¨å£°æ˜ä¹‹å‰ä½¿ç”¨ï¼Œè¿™ä¸ªè¡Œä¸ºå«åš â€œhoistingâ€ã€‚â€œhoistingâ€ å°±åƒæ˜¯æŠŠæ‰€æœ‰çš„å˜é‡å£°æ˜ç§»åŠ¨åˆ°å‡½æ•°æˆ–è€…å…¨å±€ä»£ç çš„å¼€å¤´ä½ç½®ã€‚</p>\n</blockquote>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>bla <span class=\"token operator\">=</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> bla<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// ...</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// å¯ä»¥éšå¼åœ°ï¼ˆimplicitlyï¼‰å°†ä»¥ä¸Šä»£ç ç†è§£ä¸ºï¼š</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">var</span> bla<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>bla <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>è¯´ç™½äº†ï¼Œå°±æ˜¯ç”¨ <code>var</code>  å£°æ˜çš„å˜é‡ä¼šæŠŠå£°æ˜ï¼ˆæ³¨æ„æ˜¯å£°æ˜ï¼Œè€Œä¸æ˜¯èµ‹å€¼ï¼‰è‡ªåŠ¨æŒªåŠ¨åˆ°ä½œç”¨åŸŸçš„é¡¶éƒ¨ã€‚</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> s </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>s <span class=\"token operator\">=</span><span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>æ‰“å°ï¼š</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220128230024614.png\" alt=\"image-20220128230024614\" /></p>\n<p>ç¬¬ä¸€ä¸ªæ‰“å°ä»£ç   <code>console.log(s)</code> ï¼Œ <code>s</code>  è™½ç„¶æ²¡æœ‰å®šä¹‰ï¼Œä½†æ˜¯ç”±äºå˜é‡æå‡ï¼Œvar æŒªåŠ¨åˆ°äº†æœ€å‰è¾¹ï¼Œæ‰€ä»¥ç»“æœæ˜¯  <code>undefined</code>  è€Œä¸æ˜¯æŠ¥é”™ã€‚</p>\n<h3 id=\"æ•°ç»„\"><a class=\"anchor\" href=\"#æ•°ç»„\">#</a> æ•°ç»„</h3>\n<h5 id=\"æ•°ç»„push\"><a class=\"anchor\" href=\"#æ•°ç»„push\">#</a> æ•°ç»„ push</h5>\n<p>push æ˜¯åœ¨åé¢è¿›è¡Œæ’å…¥</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> array <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> newFirstElement <span class=\"token operator\">=</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>array<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>newFirstElement<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> newArray <span class=\"token operator\">=</span> array</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>newArray<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p>\n<p><code>[ 3, 2, 1, 4 ]</code></p>\n<p>ç”¨ <code>popï¼ˆï¼‰</code> æ¥å–å‡ºæœ€åä¸€ä¸ªå…ƒç´ </p>\n<h5 id=\"åœ¨å‰é¢æ’å…¥\"><a class=\"anchor\" href=\"#åœ¨å‰é¢æ’å…¥\">#</a> åœ¨å‰é¢æ’å…¥</h5>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> array <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> newFirstElement <span class=\"token operator\">=</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>array<span class=\"token punctuation\">.</span><span class=\"token function\">unshift</span><span class=\"token punctuation\">(</span>newFirstElement<span class=\"token punctuation\">)</span> <span class=\"token comment\">// [ 4, 3, 2, 1 ]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>array<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>ç”¨ <code>unshift</code>  åœ¨å‰é¢æ’å…¥ï¼Œç”¨ <code>shift</code>  å–å‡ºå‰é¢çš„é‚£ä¸ªæ•°ã€‚</p>\n",
            "tags": [
                "js"
            ]
        },
        {
            "id": "https://songlinlife.top/2022/HTML%EF%BC%9A%E5%AD%A6%E4%B9%A0/",
            "url": "https://songlinlife.top/2022/HTML%EF%BC%9A%E5%AD%A6%E4%B9%A0/",
            "title": "HTMLä¸CSSå­¦ä¹ ",
            "date_published": "2022-01-24T12:39:15.000Z",
            "content_html": "<h1 id=\"ä»é›¶å¼€å§‹å†™html\"><a class=\"anchor\" href=\"#ä»é›¶å¼€å§‹å†™html\">#</a> ä»é›¶å¼€å§‹å†™ HTMLã€‚ã€‚ã€‚</h1>\n<p>æ— è¯­äº†ï¼Œä¸ºäº†å®ç°ä¸€äº›é¡¹ç›®ã€‚ã€‚ã€‚ã€‚å¿…é¡»å­¦ä¸€ä¸‹å‰ç«¯çŸ¥è¯†äº†ã€‚ã€‚ã€‚</p>\n<pre><code>&lt;div&gt; å…ƒç´ æ²¡æœ‰ç‰¹å®šçš„å«ä¹‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç”±äºå®ƒå±äºå—çº§å…ƒç´ ï¼Œæµè§ˆå™¨ä¼šåœ¨å…¶å‰åæ˜¾ç¤ºæŠ˜è¡Œã€‚\n</code></pre>\n<h3 id=\"html5æ–°å¢çš„ç‰¹æ€§\"><a class=\"anchor\" href=\"#html5æ–°å¢çš„ç‰¹æ€§\">#</a> html5 æ–°å¢çš„ç‰¹æ€§ï¼š</h3>\n<ul>\n<li>ç”¨äºç»˜ç”»çš„ canvas å…ƒç´ </li>\n<li>ç”¨äºåª’ä»‹å›æ”¾çš„ video å’Œ audio å…ƒç´ </li>\n<li>å¯¹æœ¬åœ°ç¦»çº¿å­˜å‚¨çš„æ›´å¥½çš„æ”¯æŒ</li>\n<li>æ–°çš„ç‰¹æ®Šå†…å®¹å…ƒç´ ï¼Œæ¯”å¦‚ articleã€footerã€headerã€navã€section</li>\n<li>æ–°çš„è¡¨å•æ§ä»¶ï¼Œæ¯”å¦‚ calendarã€dateã€timeã€emailã€urlã€search</li>\n</ul>\n<p>Canvas æ˜¯é‡ç‚¹ï¼æˆ‘éœ€è¦çš„å°±æ˜¯ç»˜å›¾ç•Œé¢ã€‚ã€‚ã€‚</p>\n<h3 id=\"ä¸‹æ‹‰é€‰æ‹©\"><a class=\"anchor\" href=\"#ä¸‹æ‹‰é€‰æ‹©\">#</a> ä¸‹æ‹‰é€‰æ‹©</h3>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>weather<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Select the weather type today: <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>weather<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>option</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>--Make a choice--<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>option</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>option</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sunny<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Sunny<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>option</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>option</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rainy<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Rainy<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>option</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>option</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>snowing<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Snowing<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>option</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>option</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>overcast<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Overcast<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>option</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p>\n<p>&lt;select id=&quot;weather&quot;&gt;<br />\n&lt;option value=&quot;&quot;&gt;--Make a choice--&lt;/option&gt;<br />\n&lt;option value=&quot;sunny&quot;&gt;Sunny&lt;/option&gt;<br />\n&lt;option value=&quot;rainy&quot;&gt;Rainy&lt;/option&gt;<br />\n&lt;option value=&quot;snowing&quot;&gt;Snowing&lt;/option&gt;<br />\n&lt;option value=&quot;overcast&quot;&gt;Overcast&lt;/option&gt;<br />\n&lt;/select&gt;</p>\n<h3 id=\"fromè¡¨å•\"><a class=\"anchor\" href=\"#fromè¡¨å•\">#</a> from è¡¨å•</h3>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220127162528190.png\" alt=\"image-20220127162528190\" /></p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://106.54.162.114:2021/web<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>post</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1000<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1500<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><code>form</code>  è¡¨å•ä¸­ <code>action</code>  è¡¨ç¤ºè¦è·³è½¬åˆ°å“ªé‡Œå»ï¼Œ <code>method</code>  è¡¨ç¤ºç”¨ä»€ä¹ˆè¯·æ±‚åè®®ï¼Œ <code>id</code>  ç”¨äºè¡¨ç¤ºè¿™ä¸ª <code>form</code>  è¡¨å•çš„ <code>id</code> ã€‚è¿™æ · js è„šæœ¬å°±å¯ä»¥ç”¨åˆ°ã€‚</p>\n<p>æ ¹æ® <code>input</code>  çš„ typeï¼Œé€‰æ‹© <code>submit</code>  è¿™ä¸ªç±»åˆ«ï¼Œå®ƒä¼šåœ¨ç‚¹å‡»çš„æ—¶å€™ï¼ŒæŠŠå…¶ name å’Œ value é”®å€¼å¯¹é€å‡ºå»ï¼Œè¿™æ ·å°±å‘é€äº†ä¸€æ¬¡è¯·æ±‚ã€‚</p>\n<p>æ•ˆæœå›¾ï¼š</p>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220127164138654.png\" alt=\"image-20220127164138654\" /></p>\n<p>è¿˜å¯ä»¥è¿™æ ·å†™ï¼š</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://106.54.162.114:2021/web<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>post</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>id<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>æäº¤<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220127164734689.png\" alt=\"image-20220127164734689\" /></p>\n<p>ç‚¹å‡»æäº¤åä¹Ÿèƒ½é€å‡º <code>post</code>  è¯·æ±‚ã€‚</p>\n<h3 id=\"css\"><a class=\"anchor\" href=\"#css\">#</a> CSS</h3>\n<h4 id=\"å¼•ç”¨cssæ–‡ä»¶\"><a class=\"anchor\" href=\"#å¼•ç”¨cssæ–‡ä»¶\">#</a> å¼•ç”¨ css æ–‡ä»¶</h4>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/css/style.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>è¿™é‡Œ  <code>href</code>  æˆ‘ç”¨çš„æ˜¯é™æ€é“¾æ¥ï¼Œç›®å‰è¿˜æ²¡ææ¸…æ¥šå’‹ç”¨æ–‡ä»¶è·¯å¾„ã€‚ã€‚ã€‚</p>\n<h4 id=\"ç›’å­\"><a class=\"anchor\" href=\"#ç›’å­\">#</a> ç›’å­</h4>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220128162131652.png\" alt=\"image-20220128162131652\" /></p>\n<p><code>padding</code> ï¼š å†…è¾¹æ¡†ã€‚</p>\n<p><code>margin</code> ï¼šå¤–è¾¹æ¡†ã€‚</p>\n<p><code>border</code> ï¼šè¾¹æ¡†</p>\n<figure class=\"highlight css\"><figcaption data-lang=\"CSS\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">border</span><span class=\"token punctuation\">:</span> 10px dashed #555<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 25px<span class=\"token punctuation\">;</span>  <span class=\"token comment\">/* å¹³æ»‘ */</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> 10px 15px 15px 15px<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* è®¾ç½® padding å¤§å° */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> 50px<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* è®¾ç½®å¤–è¾¹æ¡† */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token property\">box-sizing</span><span class=\"token punctuation\">:</span> border-box<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* é˜²æ­¢å‡ºç°ç•Œé¢ä¸å¤Ÿç”¨æƒ…å†µ */</span></pre></td></tr></table></figure><p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220128162501705.png\" alt=\"image-20220128162501705\" /></p>\n<h6 id=\"float\"><a class=\"anchor\" href=\"#float\">#</a> float</h6>\n<p>ç”¨å®Œ float è®°å¾—è¦ clearï¼Œè¿™é‡Œç»™å‡ºä¸€ä¸ªæ–¹æ³•ã€‚</p>\n<figure class=\"highlight css\"><figcaption data-lang=\"CSS\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token selector\">.clear</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">clear</span><span class=\"token punctuation\">:</span>both<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿™æ ·åœ¨ <code>html</code>  é‡Œå°±ç”¨å†™ï¼š</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>clear<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h5 id=\"background\"><a class=\"anchor\" href=\"#background\">#</a> background</h5>\n<figure class=\"highlight css\"><figcaption data-lang=\"CSS\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">background-image</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">\"/img/back.jpg\"</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token property\">background-size</span><span class=\"token punctuation\">:</span> cover<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>å¯ä»¥æ·»åŠ ä¸Šå›¾ç‰‡ï¼Œå¹¶ä¸”æ˜¯ä»¥ cover å½¢å¼åŠ ä¸Šçš„ã€‚</p>\n<h4 id=\"å­—ä½“\"><a class=\"anchor\" href=\"#å­—ä½“\">#</a> å­—ä½“</h4>\n<p><code>text-aligin: justify</code>  å¯¹é½</p>\n<h4 id=\"é€‰æ‹©å™¨\"><a class=\"anchor\" href=\"#é€‰æ‹©å™¨\">#</a> é€‰æ‹©å™¨</h4>\n<h5 id=\"å¤šä¸ªç±»æŒ‡å‘ä¸€ä¸ªç±»\"><a class=\"anchor\" href=\"#å¤šä¸ªç±»æŒ‡å‘ä¸€ä¸ªç±»\">#</a> å¤šä¸ªç±»æŒ‡å‘ä¸€ä¸ªç±»</h5>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>notebox<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    This is an informational note.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>notebox warning<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    This note shows a warning.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>notebox danger<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    This note shows danger!</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>danger<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    This won't get styled â€” it also needs to have the notebox class</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><figure class=\"highlight css\"><figcaption data-lang=\"CSS\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token selector\">.notebox</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> 4px solid #666<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> .5em<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token selector\">.notebox.warning</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token property\">border-color</span><span class=\"token punctuation\">:</span> orange<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token property\">font-weight</span><span class=\"token punctuation\">:</span> bold<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token selector\">.notebox.danger</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token property\">border-color</span><span class=\"token punctuation\">:</span> red<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token property\">font-weight</span><span class=\"token punctuation\">:</span> bold<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯ä»¥ä¸åŠ ç©ºæ ¼åº”ç”¨ç±»ã€‚</p>\n<h5 id=\"æŒ‡å‘ç‰¹å®šå…ƒç´ çš„ç±»\"><a class=\"anchor\" href=\"#æŒ‡å‘ç‰¹å®šå…ƒç´ çš„ç±»\">#</a> æŒ‡å‘ç‰¹å®šå…ƒç´ çš„ç±»</h5>\n<figure class=\"highlight css\"><figcaption data-lang=\"CSS\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token selector\">span.highlight</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> yellow<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token selector\">h1.highlight</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> pink<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>é’ˆå¯¹ <code>span</code>  å’Œ  <code>h1</code> ï¼Œè™½ç„¶ç±»åéƒ½ä¸º <code>highlight</code> ï¼Œä½†åº”ç”¨ä¸åŒé¢œè‰²ã€‚</p>\n<h5 id=\"idé€‰æ‹©å™¨\"><a class=\"anchor\" href=\"#idé€‰æ‹©å™¨\">#</a> ID é€‰æ‹©å™¨</h5>\n<figure class=\"highlight css\"><figcaption data-lang=\"CSS\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token selector\">#one</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> yellow<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token selector\">h1#heading</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> rebeccapurple<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¬¬äºŒä¸ªä»£ç å—æŒ‡çš„æ˜¯ <code>h1</code>  å…ƒç´ çš„ <code>heading</code>  ç±»ã€‚</p>\n",
            "tags": [
                "çäº‹"
            ]
        },
        {
            "id": "https://songlinlife.top/2022/Golang%EF%BC%9Amongodb%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE/",
            "url": "https://songlinlife.top/2022/Golang%EF%BC%9Amongodb%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE/",
            "title": "Golangï¼šmongodbå¢åˆ æ”¹",
            "date_published": "2022-01-24T08:19:26.000Z",
            "content_html": "<h3 id=\"æ’å…¥ä¸€æ¡æ•°æ®\"><a class=\"anchor\" href=\"#æ’å…¥ä¸€æ¡æ•°æ®\">#</a> æ’å…¥ä¸€æ¡æ•°æ®ï¼š</h3>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token keyword\">var</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\tclient     <span class=\"token operator\">=</span> mongodb<span class=\"token punctuation\">.</span><span class=\"token function\">MgoCli</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\terr        <span class=\"token builtin\">error</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\tcollection <span class=\"token operator\">*</span>mongo<span class=\"token punctuation\">.</span>Collection</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\tiResult    <span class=\"token operator\">*</span>mongo<span class=\"token punctuation\">.</span>InsertOneResult</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\tid         primitive<span class=\"token punctuation\">.</span>ObjectID</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token comment\">// é€‰æ‹©æ•°æ®åº“ my_db é‡Œçš„æŸä¸ªè¡¨</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tcollection <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">Database</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my_db\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my_collection\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token comment\">// æ’å…¥æŸä¸€æ¡æ•°æ®</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tlogRecord <span class=\"token operator\">:=</span> model<span class=\"token punctuation\">.</span>LogRecord<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\tJobName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"job1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\tCommand<span class=\"token punctuation\">:</span> <span class=\"token string\">\"echo 1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\tErr<span class=\"token punctuation\">:</span>     <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\tContent<span class=\"token punctuation\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\tTp<span class=\"token punctuation\">:</span> model<span class=\"token punctuation\">.</span>ExecTime<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\tStartTime<span class=\"token punctuation\">:</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Unix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\tEndTime<span class=\"token punctuation\">:</span>   time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Unix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t<span class=\"token keyword\">if</span> iResult<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> collection<span class=\"token punctuation\">.</span><span class=\"token function\">InsertOne</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">TODO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> logRecord<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Print</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t<span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t<span class=\"token comment\">//_id: é»˜è®¤ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€ ID</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\tid <span class=\"token operator\">=</span> iResult<span class=\"token punctuation\">.</span>InsertedID<span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>primitive<span class=\"token punctuation\">.</span>ObjectID<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è‡ªå¢ID\"</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">.</span><span class=\"token function\">Hex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"æ’å…¥å¤šæ¡æ•°æ®\"><a class=\"anchor\" href=\"#æ’å…¥å¤šæ¡æ•°æ®\">#</a> æ’å…¥å¤šæ¡æ•°æ®</h3>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token keyword\">var</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\tclient <span class=\"token operator\">=</span> mongodb<span class=\"token punctuation\">.</span><span class=\"token function\">MgoCli</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\terr        <span class=\"token builtin\">error</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\tcollection <span class=\"token operator\">*</span>mongo<span class=\"token punctuation\">.</span>Collection</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\tresult     <span class=\"token operator\">*</span>mongo<span class=\"token punctuation\">.</span>InsertManyResult</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\tid         primitive<span class=\"token punctuation\">.</span>ObjectID</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tcollection <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">Database</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my_db\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"table1\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token comment\">// æ‰¹é‡æ’å…¥</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tresult<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> collection<span class=\"token punctuation\">.</span><span class=\"token function\">InsertMany</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">TODO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token keyword\">interface</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\tmodel<span class=\"token punctuation\">.</span>LogRecord<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\tJobName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"job multi1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\tCommand<span class=\"token punctuation\">:</span> <span class=\"token string\">\"echo multi1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\tErr<span class=\"token punctuation\">:</span>     <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\tContent<span class=\"token punctuation\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\tTp<span class=\"token punctuation\">:</span> model<span class=\"token punctuation\">.</span>ExecTime<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\t\tStartTime<span class=\"token punctuation\">:</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Unix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\t\tEndTime<span class=\"token punctuation\">:</span>   time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Unix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\tmodel<span class=\"token punctuation\">.</span>LogRecord<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\tJobName<span class=\"token punctuation\">:</span> <span class=\"token string\">\"job multi2\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t\tCommand<span class=\"token punctuation\">:</span> <span class=\"token string\">\"echo multi2\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\tErr<span class=\"token punctuation\">:</span>     <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t\tContent<span class=\"token punctuation\">:</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\tTp<span class=\"token punctuation\">:</span> model<span class=\"token punctuation\">.</span>ExecTime<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t\tStartTime<span class=\"token punctuation\">:</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Unix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\t\tEndTime<span class=\"token punctuation\">:</span>   time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Unix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t<span class=\"token keyword\">if</span> result <span class=\"token operator\">==</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"result nil\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t<span class=\"token keyword\">for</span> <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> v <span class=\"token operator\">:=</span> <span class=\"token keyword\">range</span> result<span class=\"token punctuation\">.</span>InsertedIDs <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\tid <span class=\"token operator\">=</span> v<span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>primitive<span class=\"token punctuation\">.</span>ObjectID<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è‡ªå¢ID\"</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">.</span><span class=\"token function\">Hex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰§è¡Œ <code>Insert</code>  å‘½ä»¤åï¼Œè¿˜è¦å†æ‰§è¡Œ</p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> v <span class=\"token operator\">:=</span> <span class=\"token keyword\">range</span> result<span class=\"token punctuation\">.</span>InsertedIDs <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\tid <span class=\"token operator\">=</span> v<span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>primitive<span class=\"token punctuation\">.</span>ObjectID<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è‡ªå¢ID\"</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">.</span><span class=\"token function\">Hex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>bson</code>  è®¾ç½® <code>ObjectID</code></p>\n<h3 id=\"è®¾ç½®find-limit\"><a class=\"anchor\" href=\"#è®¾ç½®find-limit\">#</a> è®¾ç½® find limit</h3>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token keyword\">var</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\tclient     <span class=\"token operator\">=</span> mongodb<span class=\"token punctuation\">.</span><span class=\"token function\">MgoCli</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\tcollection <span class=\"token operator\">*</span>mongo<span class=\"token punctuation\">.</span>Collection</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\terr        <span class=\"token builtin\">error</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\tcursor     <span class=\"token operator\">*</span>mongo<span class=\"token punctuation\">.</span>Cursor</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tcollection <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">Database</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my_db\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"table1\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tfilter <span class=\"token operator\">:=</span> bson<span class=\"token punctuation\">.</span>M<span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"jobName\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"job multi1\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token keyword\">if</span> cursor<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> collection<span class=\"token punctuation\">.</span><span class=\"token function\">Find</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">TODO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> filter<span class=\"token punctuation\">,</span>options<span class=\"token punctuation\">.</span><span class=\"token function\">Find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">SetSkip</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">.</span><span class=\"token function\">Find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">SetLimit</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token keyword\">defer</span> <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">=</span> cursor<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">TODO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t<span class=\"token keyword\">var</span> results <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>model<span class=\"token punctuation\">.</span>LogRecord</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">=</span> cursor<span class=\"token punctuation\">.</span><span class=\"token function\">All</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">TODO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>results<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t<span class=\"token keyword\">for</span> <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> result <span class=\"token operator\">:=</span> <span class=\"token keyword\">range</span> results <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"update\"><a class=\"anchor\" href=\"#update\">#</a> update</h3>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token keyword\">var</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\tclient     <span class=\"token operator\">=</span> mongodb<span class=\"token punctuation\">.</span><span class=\"token function\">MgoCli</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\tcollection <span class=\"token operator\">*</span>mongo<span class=\"token punctuation\">.</span>Collection</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\terr        <span class=\"token builtin\">error</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\tuResult    <span class=\"token operator\">*</span>mongo<span class=\"token punctuation\">.</span>UpdateResult</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tcollection <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">Database</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my_db\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"table1\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tfilter <span class=\"token operator\">:=</span> bson<span class=\"token punctuation\">.</span>M<span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"jobName\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"job multi1\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tupdate <span class=\"token operator\">:=</span> bson<span class=\"token punctuation\">.</span>M<span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"$set\"</span><span class=\"token punctuation\">:</span> model<span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\tUpdateByJobName<span class=\"token punctuation\">&#123;</span>Command<span class=\"token punctuation\">:</span> <span class=\"token string\">\"byModel\"</span><span class=\"token punctuation\">,</span>Content<span class=\"token punctuation\">:</span><span class=\"token string\">\"model\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token keyword\">if</span> uResult<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> collection<span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t<span class=\"token function\">UpdateMany</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">TODO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> filter<span class=\"token punctuation\">,</span> update<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t<span class=\"token comment\">//uResult.MatchedCount è¡¨ç¤ºç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„è®°å½•æ•°ï¼Œå³æ›´æ–°äº†å¤šå°‘æ¡æ•°æ®ã€‚</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>uResult<span class=\"token punctuation\">.</span>MatchedCount<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"åˆ é™¤æ•°æ®\"><a class=\"anchor\" href=\"#åˆ é™¤æ•°æ®\">#</a> åˆ é™¤æ•°æ®</h3>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">sql</span> :<span class=\"token operator\">=</span> <span class=\"token punctuation\">`</span>&#123;<span class=\"token string\">\"name\"</span>:<span class=\"token string\">\"jack\"</span>&#125;<span class=\"token punctuation\">`</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>var bs interface&#123;&#125;</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>bson<span class=\"token punctuation\">.</span>UnmarshalExtJSON<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>byte<span class=\"token punctuation\">(</span><span class=\"token keyword\">sql</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>bs<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>collection<span class=\"token punctuation\">.</span>DeleteMany<span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span>TODO<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> bs<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œå…ˆ <code>sqlstr</code>  è½¬ <code>interface</code> ï¼Œ ç„¶è€Œç›´æ¥ä¼ å…¥å‚æ•°ã€‚</p>\n",
            "tags": [
                "Go"
            ]
        },
        {
            "id": "https://songlinlife.top/2022/Go/Golang%EF%BC%9A%E6%9F%A5%E8%AF%A2MongoDB/",
            "url": "https://songlinlife.top/2022/Go/Golang%EF%BC%9A%E6%9F%A5%E8%AF%A2MongoDB/",
            "title": "Golangï¼šæŸ¥è¯¢MongoDB",
            "date_published": "2022-01-24T07:42:28.000Z",
            "content_html": "<h3 id=\"è¿æ¥æ•°æ®åº“\"><a class=\"anchor\" href=\"#è¿æ¥æ•°æ®åº“\">#</a> è¿æ¥æ•°æ®åº“</h3>\n<ol>\n<li>æ‰“å¼€ sshtunnel</li>\n<li>è·å– client</li>\n</ol>\n<h3 id=\"è·å¾—collection\"><a class=\"anchor\" href=\"#è·å¾—collection\">#</a> è·å¾— collection</h3>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">GetNpmRecords</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span>mongo<span class=\"token punctuation\">.</span>Collection <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tclient <span class=\"token operator\">:=</span> <span class=\"token function\">MgoCli</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tdb <span class=\"token operator\">:=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">Database</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\ts<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">:=</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">ListCollectionNames</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">TODO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> bson<span class=\"token punctuation\">.</span>M<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"s: %v\\n\"</span><span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tnpm_records <span class=\"token operator\">:=</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">Collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"npm_records\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token keyword\">return</span> npm_records</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"æŸ¥è¯¢\"><a class=\"anchor\" href=\"#æŸ¥è¯¢\">#</a> æŸ¥è¯¢</h3>\n<h4 id=\"é€šè¿‡structè¿›è¡Œå…³è”\"><a class=\"anchor\" href=\"#é€šè¿‡structè¿›è¡Œå…³è”\">#</a> é€šè¿‡ struct è¿›è¡Œå…³è”</h4>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">CursorTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tnpm_records <span class=\"token operator\">:=</span> <span class=\"token function\">GetNpmRecords</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tsqlstr <span class=\"token operator\">:=</span> <span class=\"token string\">`[&#123;\"$match\":&#123;\"name\":\"response-json-formatter\"&#125;&#125;,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t&#123;\"$project\":&#123;\"name\":1, \"version\":1&#125;&#125;,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t&#123;\"$limit\":5&#125;</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t]`</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token keyword\">var</span> bdoc <span class=\"token keyword\">interface</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\terr2 <span class=\"token operator\">:=</span> bson<span class=\"token punctuation\">.</span><span class=\"token function\">UnmarshalExtJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token function\">byte</span><span class=\"token punctuation\">(</span>sqlstr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>bdoc<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"err2: %v\\n\"</span><span class=\"token punctuation\">,</span> err2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bdoc: %v\\n\"</span><span class=\"token punctuation\">,</span> bdoc<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tcursor<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> npm_records<span class=\"token punctuation\">.</span><span class=\"token function\">Aggregate</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">TODO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> bdoc<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token keyword\">defer</span> cursor<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">TODO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\ttmp <span class=\"token operator\">:=</span> <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\tName    <span class=\"token builtin\">string</span> <span class=\"token string\">`bson:\"name\"`</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\tVersion <span class=\"token builtin\">string</span> <span class=\"token string\">`bson:\"version\"`</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t<span class=\"token keyword\">for</span> cursor<span class=\"token punctuation\">.</span><span class=\"token function\">Next</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">TODO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\tcursor<span class=\"token punctuation\">.</span><span class=\"token function\">Decode</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>tmp<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>tmp<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ ¸å¿ƒå‘½ä»¤æ˜¯  <code>bson.UnmarshalExtJSON([]byte(sqlstr), true, &amp;bdoc)</code> ï¼Œå°†æŸ¥è¯¢çš„ SQL è¯­å¥è½¬æ¢ä¸º <code>bson</code> ã€‚</p>\n<p>ç„¶åç›´æ¥è°ƒç”¨ <code>Aggregate</code>  è¿›è¡ŒæŸ¥è¯¢ã€‚</p>\n<h3 id=\"è·å–bsonç»“æœ\"><a class=\"anchor\" href=\"#è·å–bsonç»“æœ\">#</a> è·å– bson ç»“æœ</h3>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">CursorTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tnpm_records <span class=\"token operator\">:=</span> <span class=\"token function\">GetNpmRecords</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tsqlstr <span class=\"token operator\">:=</span> <span class=\"token string\">`[&#123;\"$match\":&#123;\"name\":\"response-json-formatter\"&#125;&#125;,</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t&#123;\"$project\":&#123;\"name\":1, \"version\":1&#125;&#125;,</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t&#123;\"$limit\":5&#125;</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t]`</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token keyword\">var</span> bdoc <span class=\"token keyword\">interface</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\terr2 <span class=\"token operator\">:=</span> bson<span class=\"token punctuation\">.</span><span class=\"token function\">UnmarshalExtJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token function\">byte</span><span class=\"token punctuation\">(</span>sqlstr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>bdoc<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"err2: %v\\n\"</span><span class=\"token punctuation\">,</span> err2<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bdoc: %v\\n\"</span><span class=\"token punctuation\">,</span> bdoc<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tcursor<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> npm_records<span class=\"token punctuation\">.</span><span class=\"token function\">Aggregate</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">TODO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> bdoc<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token keyword\">defer</span> cursor<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">TODO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token keyword\">var</span> results <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>bson<span class=\"token punctuation\">.</span>M <span class=\"token comment\">// å®šä¹‰ bson</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tcursor<span class=\"token punctuation\">.</span><span class=\"token function\">All</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">TODO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>results<span class=\"token punctuation\">)</span> <span class=\"token comment\">// ç„¶å ALL</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t<span class=\"token keyword\">for</span> <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> res <span class=\"token operator\">:=</span> <span class=\"token keyword\">range</span> results <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\tb<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">:=</span> bson<span class=\"token punctuation\">.</span><span class=\"token function\">MarshalExtJSON</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>results<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"b: %v\\n\"</span><span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token comment\">// mongo.Pipeline&#123;bson.D(bdoc)&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"æ€»ç»“\"><a class=\"anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h3>\n<p>é€šè¿‡æ¸¸æ ‡æ–¹å¼å¯ä»¥è·å–ä¸€ä¸ªä¸ªçš„æ•°æ®ï¼Œä½†æ˜¯å¦‚ä½•ä¸€æ¬¡æ€§è·å¾—æ•°æ®åï¼Œå¤„ç†å¹¶ä¿å­˜ã€‚ã€‚ã€‚ã€‚</p>\n<p>è¿™é‡Œåšäº†ä¸€ä¸ªå®éªŒï¼š</p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">for</span> cursor<span class=\"token punctuation\">.</span><span class=\"token function\">Next</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">TODO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\twg<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t<span class=\"token keyword\">go</span> <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t\tcursor<span class=\"token punctuation\">.</span><span class=\"token function\">Decode</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>tmp<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>tmp<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t<span class=\"token keyword\">defer</span> wg<span class=\"token punctuation\">.</span><span class=\"token function\">Done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¯» 10000 ä¸ªæ•°æ®ï¼Œä½¿ç”¨äº†å¹¶å‘å’Œæ²¡ä½¿ç”¨å¹¶å‘è€—æ—¶æ ¹æœ¬æ²¡åŒºåˆ«ã€‚ã€‚ã€‚ã€‚</p>\n<p>Decode ä¸æ˜¯é™åˆ¶æ€§èƒ½åŸå› å§ã€‚ã€‚ã€‚</p>\n",
            "tags": [
                "Go"
            ]
        },
        {
            "id": "https://songlinlife.top/2022/MongoDB-%E5%B8%B8%E7%94%A8%E7%AE%A1%E9%81%93%E5%87%BD%E6%95%B0/",
            "url": "https://songlinlife.top/2022/MongoDB-%E5%B8%B8%E7%94%A8%E7%AE%A1%E9%81%93%E5%87%BD%E6%95%B0/",
            "title": "MongoDB å¸¸ç”¨ç®¡é“å‡½æ•°",
            "date_published": "2022-01-23T15:08:16.000Z",
            "content_html": "<p>å› ä¸º <code>mongoDB</code>  é‡Œå’Œ <code>aggregate</code>  å®åœ¨æ˜¯å¤ªå¼ºå¤§äº†ï¼Œå¯¼è‡´ä»–æœ‰ä¸€å †æŒ‡ä»¤ã€‚ã€‚ã€‚ã€‚è¿™ä¸ªæ–‡ç« ä¸»è¦ä¸ºäº†è®°å½•æˆ‘åœ¨ä½¿ç”¨ MongoDB æ˜¯å¦é‡åˆ°çš„å„ç§å„æ ·å‘½ä»¤ã€‚</p>\n<p>æŒ‡ä»¤åŸºæœ¬æ ¼å¼ï¼š</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>db<span class=\"token punctuation\">.</span>COLLECTION_NAME<span class=\"token punctuation\">.</span>aggregate<span class=\"token punctuation\">(</span>AGGREGATE_OPERATION<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>å®ƒç±»ä¼¼è¿™æ ·çš„å‘½ä»¤æ ¼å¼ï¼š</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>db<span class=\"token punctuation\">.</span>orders<span class=\"token punctuation\">.</span>aggregate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>      &#123; $<span class=\"token keyword\">match</span>: &#123; <span class=\"token keyword\">status</span>: <span class=\"token string\">\"A\"</span> &#125; &#125;<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>      &#123; $<span class=\"token keyword\">group</span>: &#123; _id: <span class=\"token string\">\"$cust_id\"</span><span class=\"token punctuation\">,</span> total: &#123; $sum: <span class=\"token string\">\"$amount\"</span> &#125; &#125; &#125;<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      &#123; $sort: &#123; total: <span class=\"token operator\">-</span><span class=\"token number\">1</span> &#125; &#125;</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   &#123; <span class=\"token keyword\">explain</span>: <span class=\"token boolean\">true</span> &#125;</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"count\"><a class=\"anchor\" href=\"#count\">#</a> count</h3>\n<p><code>mongoDB5.0</code>  æœ‰ <code>count</code>  å‘½ä»¤ï¼Œä½†æ˜¯ä½† <code>mongoDB4.4</code>  ä¸­æ˜¯æ²¡æœ‰ count å‘½ä»¤çš„ã€‚</p>\n<p><code>count</code>  ç­‰ä»·äº  <code>sum:1</code></p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>db<span class=\"token punctuation\">.</span>col<span class=\"token punctuation\">.</span>aggregate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>&#123; <span class=\"token string\">\"$group\"</span>:&#123;<span class=\"token string\">\"_id\"</span>:<span class=\"token string\">\"$title\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"num\"</span>:&#123;<span class=\"token string\">\"$sum\"</span>:<span class=\"token number\">1</span> &#125; &#125; &#125; <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>db<span class=\"token punctuation\">.</span>col<span class=\"token punctuation\">.</span>aggregate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>&#123;</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token string\">\"$group\"</span>:&#123;</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token string\">\"_id\"</span>:<span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token string\">\"cnt\"</span>:&#123;<span class=\"token string\">\"$sum\"</span>:<span class=\"token number\">1</span>&#125;</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t&#125;</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>&#125;</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>ä¸‹é¢è¿™æ¡å‘½ä»¤ç”¨äºæŸ¥è¯¢é›†åˆä¸­æ–‡æ¡£æ€»æ•°</p>\n<h3 id=\"unset\"><a class=\"anchor\" href=\"#unset\">#</a> unset</h3>\n<p><code>&#123; $unset: &quot;&lt;field&gt;&quot; &#125;</code></p>\n<blockquote>\n<p>To remove a single field, the <a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/unset/#mongodb-pipeline-pipe.-unset\"> <code>$unset</code> </a> takes a string that specifies the field to remove:</p>\n</blockquote>\n<p>åˆ é™¤å­—æ®µã€‚</p>\n<h3 id=\"group\"><a class=\"anchor\" href=\"#group\">#</a> group</h3>\n<p>group å‘½ä»¤ï¼Œå°±æ˜¯åˆ¶å®š <code>_id</code>  å’Œ  <code>èšåˆå‡½æ•°</code> ã€‚</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>&#123;</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  $<span class=\"token keyword\">group</span>:</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    &#123;</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      _id: <span class=\"token operator\">&lt;</span>expression<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Group By Expression</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token operator\">&lt;</span>field1<span class=\"token operator\">></span>: &#123; <span class=\"token operator\">&lt;</span>accumulator1<span class=\"token operator\">></span> : <span class=\"token operator\">&lt;</span>expression1<span class=\"token operator\">></span> &#125;<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    &#125;</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> &#125;</pre></td></tr></table></figure><h4 id=\"å¸¸ç”¨èšåˆå‡½æ•°\"><a class=\"anchor\" href=\"#å¸¸ç”¨èšåˆå‡½æ•°\">#</a> å¸¸ç”¨èšåˆå‡½æ•°</h4>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220124102625554.png\" alt=\"image-20220124102625554\" /></p>\n<h3 id=\"å¸¸ç”¨ç®¡é“å‡½æ•°\"><a class=\"anchor\" href=\"#å¸¸ç”¨ç®¡é“å‡½æ•°\">#</a> å¸¸ç”¨ç®¡é“å‡½æ•°</h3>\n<p><img data-src=\"https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220124103901304.png\" alt=\"image-20220124103901304\" /></p>\n",
            "tags": [
                "çäº‹",
                "mongodb"
            ]
        },
        {
            "id": "https://songlinlife.top/2022/ss/golang%E5%92%8Cpython%E8%BF%9E%E6%8E%A5%E9%98%BF%E9%87%8C%E4%BA%91MongoDB%E4%BA%91%E6%95%B0%E6%8D%AE%E5%BA%93/",
            "url": "https://songlinlife.top/2022/ss/golang%E5%92%8Cpython%E8%BF%9E%E6%8E%A5%E9%98%BF%E9%87%8C%E4%BA%91MongoDB%E4%BA%91%E6%95%B0%E6%8D%AE%E5%BA%93/",
            "title": "golangå’Œpythonè¿æ¥é˜¿é‡Œäº‘MongoDBäº‘æ•°æ®åº“ï¼ˆè§£å†³ReplicaSetNoPrimaryé”™è¯¯ï¼‰",
            "date_published": "2022-01-23T13:33:34.000Z",
            "content_html": "<p>æœ€è¿‘ä¸€ç›´è¢«è¿™ä¸ªè¿æ¥é—®é¢˜ç»™å›°æ¼ã€‚ã€‚ã€‚æ€ä¹ˆéƒ½æ²¡æ³•è¿æ¥ä¸Šé˜¿é‡Œäº‘çš„äº‘æœåŠ¡å™¨ã€‚å¯¹äº golang æˆ‘ç”¨çš„æ˜¯  <code>github.com/mongodb/mongo-go-driver </code> ï¼Œæ¯ä¸€é¡¹éƒ½æŒ‰ç…§äº†æ–‡æ¡£å»è®¾ç½®ä½†æ˜¯æ­»æ´»è¿æ¥ä¸ä¸Šï¼Œäºæ˜¯æ›´æ¢ä¸º <code>github.com/globalsign/mgo</code>  ï¼Œè¿™æ ·å°±å¯ä»¥æ­£å¸¸è¿æ¥ã€‚å¯¹äº pythonï¼Œå¦‚æœä½¿ç”¨äº† <code>pymongo4.0.1</code>  ç‰ˆæœ¬ä¹Ÿæ˜¯æ— æ³•è¿æ¥ï¼Œä½†æ˜¯æ›´æ¢ä¸º <code>pymongo3.6</code>  å°±å¯ä»¥æ­£å¸¸è¿æ¥ã€‚</p>\n<p>è¿™ä¸¤ä¸ªç°è±¡éƒ½éå¸¸å¥‡æ€ªï¼Œä½†éƒ½æœ‰ç›¸åŒçš„ç‰¹ç‚¹ï¼Œæ— è®ºæ˜¯ <code>golang</code>  é‡Œçš„ <code>mgo</code>  åº“è¿˜æ˜¯ <code>python</code>  çš„ <code>pymong3.6</code>  éƒ½æ˜¯æŒºè€çš„ç‰ˆæœ¬ã€‚</p>\n<h4 id=\"golangæŠ¥é”™æ—¥å¿—\"><a class=\"anchor\" href=\"#golangæŠ¥é”™æ—¥å¿—\">#</a> golang æŠ¥é”™æ—¥å¿—ï¼š</h4>\n<p>2022/01/23 21:38:18 server selection error: server selection timeout, current topology: { Type: ReplicaSetNoPrimary, Servers: [{ Addr: 139.196.245.210:3717, Type: Unknown, Last error: connection() error occured during connection handshake: connection(139.196.245.210:3717[-127]) socket was unexpectedly closed: EOF }, { Addr: 139.196.245.214:3717, Type: Unknown, Last error: connection() error occured during connection handshake: connection(139.196.245.214:3717[-128]) socket was unexpectedly closed: EOF }, ] }</p>\n<h4 id=\"pythonæŠ¥é”™æ—¥å¿—\"><a class=\"anchor\" href=\"#pythonæŠ¥é”™æ—¥å¿—\">#</a> python æŠ¥é”™æ—¥å¿—</h4>\n<p>pymongo.errors.ServerSelectionTimeoutError: 139.196.245.214:3717: connection closed,139.196.245.210:3717: connection closed, Timeout: 30s, Topology Description: &lt;TopologyDescription id: 61ed5945eba641d6e1b58800, topology_type: ReplicaSetNoPrimary, servers: [&lt;ServerDescription ('139.196.245.210', 3717) server_type: Unknown, rtt: None, error=AutoReconnect('139.196.245.210:3717: connection closed')&gt;, &lt;ServerDescription ('139.196.245.214', 3717) server_type: Unknown, rtt: None, error=AutoReconnect('139.196.245.214:3717: connection closed')&gt;]&gt;</p>\n<p>çœ‹åˆ°è¿™ä¸ªé”™è¯¯æ—¥å¿—çœŸçš„ä»¤äººè¿·æƒ‘ï¼Œä¸ºå•¥ä¼šå‡ºç°è¿™ä¹ˆå¤šçš„ serverï¼Œæˆ‘åªæ˜¯é€šè¿‡è·³æ¿æœºè®¿é—®äº†ä¸€ä¸ªæœåŠ¡ã€‚</p>\n<p>æŸ¥æ‰¾èµ„æ–™åå‘ç°ï¼Œè¿™äº›äº‘æ•°æ®åº“éƒ½æ˜¯å®¹å™¨åŒ–ç®¡ç†ï¼Œä¹Ÿå°±æ˜¯æˆ‘çš„ä¸€å° mongodb äº‘æ•°æ®åº“ï¼Œå…¶å®æœ‰å¤šä¸ªå®¹å™¨ç»„æˆçš„é›†ç¾¤ï¼Œè¿™äº›å®¹å™¨ä¹‹é—´å¯ä»¥ç›¸äº’è®¿é—®ï¼Œä½†æ˜¯å¤–éƒ¨æ— æ³•è®¿é—®é›†ç¾¤çš„èŠ‚ç‚¹ã€‚</p>\n<p>è¿™é‡Œéå¸¸æ„Ÿè°¢ï¼Œ<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC8xNWRkZjU5NWE2Y2M=\">è¿æ¥ Replica Set å‡ºç°é—®é¢˜</span>ç»™å‡ºäº†è§£é‡Šï¼š</p>\n<blockquote>\n<p>MongoDB driver will attempt  <code>server discovery</code>  from given a replica set member(s); it will find all of other nodes within the replica set (via <span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rcy5qaWFuc2h1LmNvbS9nbz90bz1odHRwcyUzQSUyRiUyRmRvY3MubW9uZ29kYi5jb20lMkZtYW51YWwlMkZyZWZlcmVuY2UlMkZtZXRob2QlMkZycy5jb25mJTJG\">rs.conf</span>). The problem here is the replica set is set with name  <code>mongo&lt;N&gt;</code> , the driver (run in Docker host) would not be able to resolve these names. You can confirm this by trying to ping  <code>mongo1</code>  from Docker host.</p>\n<p>You can either try running the application from another Docker instance sharing the same Docker network as the replica set. Or, modify the Docker networking as such to allow resolvable hostnames.</p>\n<p>UPDATE:</p>\n<p>Regarding your comment on why using <span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rcy5qaWFuc2h1LmNvbS9nbz90bz1odHRwcyUzQSUyRiUyRmRvY3MubW9uZ29kYi5jb20lMkZtYW51YWwlMkZtb25nbyUyRg==\">mongo</span> shell, or <span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rcy5qaWFuc2h1LmNvbS9nbz90bz1odHRwcyUzQSUyRiUyRmFwaS5tb25nb2RiLmNvbSUyRnB5dGhvbiUyRmN1cnJlbnQlMkY=\">PyMongo</span> works.</p>\n<p>This is due to the difference in connection mode. When specifying a single node, i.e.  <code>mongodb://node1:27017</code>  in shell or PyMongo, server discovery are not being made. Instead it will attempt to connect to that single node (not as part as a replica set). The catch is that you need to connect to the primary node of the replica set to write (you have to know which one). If you would like to connect as a replica set, you have to define the replica set name.</p>\n<p>In contrast to the  <code>mongo-go-driver</code> , by default it would perform server discovery and attempt to connect as a replica set. If you would like to connect as a single node, then you need to specify  <code>connect=direct</code>  in the connection URI.</p>\n</blockquote>\n<p>ä¹Ÿå°±æ˜¯è¯´ driver ä¼šé»˜è®¤å¼€å¯ <code>æœåŠ¡å‘ç°</code> ï¼Œè¿™å°±å¯¼è‡´æˆ‘ä»¬ä¼šä»å®¹å™¨çš„å¤–éƒ¨æ¥è®¿é—®è¿™ä¸ªé›†ç¾¤çš„å…¶ä»–æœºå™¨ã€‚</p>\n<p>åœ¨ <code>pymongo</code>  å’Œ <code>mgo</code>  è¿™äº›æ¯”è¾ƒæ—§çš„æœåŠ¡å™¨é‡Œï¼Œå› ä¸ºé‚£æ—¶è¿˜æ²¡æœ‰æµè¡Œè¿™ç§é›†ç¾¤åŒ–ç®¡ç†ï¼Œæ‰€ä»¥æ²¡æœ‰æœåŠ¡å‘ç°çš„åŠŸèƒ½ã€‚</p>\n<h3 id=\"è§£å†³åŠæ³•\"><a class=\"anchor\" href=\"#è§£å†³åŠæ³•\">#</a> è§£å†³åŠæ³•</h3>\n<blockquote>\n<p>In contrast to the  <code>mongo-go-driver</code> , by default it would perform server discovery and attempt to connect as a replica set. If you would like to connect as a single node, then you need to specify  <code>connect=direct</code>  in the connection URI.</p>\n</blockquote>\n<p>é‡‡ç”¨ <code>direct</code>  çš„è¿æ¥æ–¹å¼ã€‚</p>\n<p>è¿™é‡Œå¯ä»¥çœ‹ <code>golang</code>  ç»™å‡ºçš„ <code>docs</code> ï¼š</p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> main</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token string\">\"context\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token string\">\"log\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token string\">\"go.mongodb.org/mongo-driver/mongo\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token string\">\"go.mongodb.org/mongo-driver/mongo/options\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token comment\">// Create a direct connection to a host. The driver will send all requests</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token comment\">// to that host and will not automatically discover other hosts in the</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token comment\">// deployment.</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\tclientOpts <span class=\"token operator\">:=</span> options<span class=\"token punctuation\">.</span><span class=\"token function\">Client</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ApplyURI</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t<span class=\"token string\">\"mongodb://localhost:27017/?connect=direct\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tclient<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> mongo<span class=\"token punctuation\">.</span><span class=\"token function\">Connect</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">TODO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> clientOpts<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t<span class=\"token boolean\">_</span> <span class=\"token operator\">=</span> client</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>ApplyURI</code>  æŠŠ  <code>connect=direct</code>  åŠ å…¥ï¼Œè¿™æ ·å°±å¯ä»¥æ„‰å¿«è¿æ¥äº†ã€‚</p>\n<h4 id=\"pymongo\"><a class=\"anchor\" href=\"#pymongo\">#</a> pymongo</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>client <span class=\"token operator\">=</span> MongoClient<span class=\"token punctuation\">(</span><span class=\"token string\">'mongodb://localhost'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>                     port<span class=\"token operator\">=</span><span class=\"token number\">3733</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>                     username<span class=\"token operator\">=</span>username<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                     password<span class=\"token operator\">=</span>password<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                     authSource<span class=\"token operator\">=</span><span class=\"token string\">'admin'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                     directConnection <span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                     authMechanism<span class=\"token operator\">=</span><span class=\"token string\">'SCRAM-SHA-1'</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                     <span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><code>pymongo</code>  ä¸­æœ‰ä¸ªå­—æ®µ  <code>directConnection</code> ï¼Œè¿™ä¸ªå­—æ®µè®¾ç½®ä¸º <code>True</code>  ä»£è¡¨ç›´æ¥è¿æ¥ã€‚</p>\n<h3 id=\"è¿™é‡Œé™„ä¸Šæˆ‘è¿æ¥çš„ä»£ç \"><a class=\"anchor\" href=\"#è¿™é‡Œé™„ä¸Šæˆ‘è¿æ¥çš„ä»£ç \">#</a> è¿™é‡Œé™„ä¸Šæˆ‘è¿æ¥çš„ä»£ç </h3>\n<h4 id=\"golang\"><a class=\"anchor\" href=\"#golang\">#</a> golang</h4>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> main</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token string\">\"context\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token string\">\"log\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token string\">\"os\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token string\">\"time\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token string\">\"github.com/elliotchance/sshtunnel\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token string\">\"go.mongodb.org/mongo-driver/mongo\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token string\">\"go.mongodb.org/mongo-driver/mongo/options\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token string\">\"golang.org/x/crypto/ssh\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\ttunnel <span class=\"token operator\">:=</span> sshtunnel<span class=\"token punctuation\">.</span><span class=\"token function\">NewSSHTunnel</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t<span class=\"token comment\">// åœ¨è¿™é‡Œè®¾ç½®ä½ çš„è·³æ¿æœºåœ°å€.</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t<span class=\"token string\">\"username@ipv4:port\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t<span class=\"token comment\">// é€‰æ‹© sshpassword çš„è¿æ¥æ–¹å¼</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\tssh<span class=\"token punctuation\">.</span><span class=\"token function\">Password</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t<span class=\"token comment\">// é˜¿é‡Œäº‘ mongodb çš„åœ°å€.</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t<span class=\"token string\">\"dds-uf61fd4**********44-pub.mongodb.rds.aliyuncs.com:3717\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t<span class=\"token comment\">// è®¾ç½®æœ¬åœ°ç»‘å®šç«¯å£</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t<span class=\"token string\">\"3733\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\ttunnel<span class=\"token punctuation\">.</span>Log <span class=\"token operator\">=</span> log<span class=\"token punctuation\">.</span><span class=\"token function\">New</span><span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>Stdout<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> log<span class=\"token punctuation\">.</span>Ldate<span class=\"token operator\">|</span>log<span class=\"token punctuation\">.</span>Lmicroseconds<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t<span class=\"token keyword\">go</span> tunnel<span class=\"token punctuation\">.</span><span class=\"token function\">Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\ttime<span class=\"token punctuation\">.</span><span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span> <span class=\"token operator\">*</span> time<span class=\"token punctuation\">.</span>Millisecond<span class=\"token punctuation\">)</span> <span class=\"token comment\">// ç­‰å¾…å¼€å¯ tunnel</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t<span class=\"token function\">MgoCli</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">var</span> mgoCli <span class=\"token operator\">*</span>mongo<span class=\"token punctuation\">.</span>Client</pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">initDb</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t<span class=\"token keyword\">var</span> err <span class=\"token builtin\">error</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\tcredential <span class=\"token operator\">:=</span> options<span class=\"token punctuation\">.</span>Credential<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\tAuthMechanism<span class=\"token punctuation\">:</span> <span class=\"token string\">\"SCRAM-SHA-1\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// é˜¿é‡Œäº‘æœåŠ¡çš„</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\tUsername<span class=\"token punctuation\">:</span>      <span class=\"token string\">\"username\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//mongodb ç”¨æˆ·å</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\tPassword<span class=\"token punctuation\">:</span>      <span class=\"token string\">\"password\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//mongodb å¯†ç </span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\tAuthSource<span class=\"token punctuation\">:</span>    <span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// é»˜è®¤ admin ä¸éœ€è¦æ”¹</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t\tPasswordSet<span class=\"token punctuation\">:</span>   <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\tclientOpts <span class=\"token operator\">:=</span> options<span class=\"token punctuation\">.</span><span class=\"token function\">Client</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ApplyURI</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mongodb://localhost:3733\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\t<span class=\"token function\">SetAuth</span><span class=\"token punctuation\">(</span>credential<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t<span class=\"token comment\">// è¿æ¥åˆ° MongoDB</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\tctx<span class=\"token punctuation\">,</span> cancel <span class=\"token operator\">:=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">WithTimeout</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">Background</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token operator\">*</span>time<span class=\"token punctuation\">.</span>Second<span class=\"token punctuation\">)</span> <span class=\"token comment\">// è®¾ç½® 5s è¶…æ—¶</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token keyword\">defer</span> <span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\tclient<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> mongo<span class=\"token punctuation\">.</span><span class=\"token function\">Connect</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> clientOpts<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\t<span class=\"token comment\">// æ£€æŸ¥è¿æ¥</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\terr <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">Ping</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">TODO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">MgoCli</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span>mongo<span class=\"token punctuation\">.</span>Client <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>\t<span class=\"token keyword\">if</span> mgoCli <span class=\"token operator\">==</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>\t\t<span class=\"token function\">initDb</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>\t<span class=\"token keyword\">return</span> mgoCli</pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"pymongo-2\"><a class=\"anchor\" href=\"#pymongo-2\">#</a> pymongo</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">from</span> pymongo <span class=\"token keyword\">import</span> MongoClient</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">from</span> sshtunnel <span class=\"token keyword\">import</span> SSHTunnelForwarder</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">from</span> pprint <span class=\"token keyword\">import</span> pprint</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> urllib<span class=\"token punctuation\">.</span>parse</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> time</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>tunnel <span class=\"token operator\">=</span> SSHTunnelForwarder<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                        <span class=\"token punctuation\">(</span><span class=\"token string\">\"è·³æ¿æœºip\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">22</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                        ssh_username<span class=\"token operator\">=</span><span class=\"token string\">r\"è·³æ¿æœºç”¨æˆ·å\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                        ssh_password<span class=\"token operator\">=</span><span class=\"token string\">r\"è·³æ¿æœºå¯†ç \"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                        remote_bind_address<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token string\">r\"dds-uf61f**********b.mongodb.rds.aliyuncs.com\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3717</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                        local_bind_address<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">3733</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>tunnel<span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>tunnel<span class=\"token punctuation\">.</span>local_bind_port<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">from</span> pymongo <span class=\"token keyword\">import</span> MongoClient</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>client <span class=\"token operator\">=</span> MongoClient<span class=\"token punctuation\">(</span><span class=\"token string\">'mongodb://localhost'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                     port<span class=\"token operator\">=</span><span class=\"token number\">3733</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                     username<span class=\"token operator\">=</span><span class=\"token string\">'æ•°æ®åº“ç”¨æˆ·å'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                     password<span class=\"token operator\">=</span><span class=\"token string\">'æ•°æ®åº“å¯†ç '</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                     authSource<span class=\"token operator\">=</span><span class=\"token string\">'admin'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                     directConnection <span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> <span class=\"token comment\"># ä½¿ç”¨ç›´æ¥è¿æ¥æ–¹å¼</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                     authMechanism<span class=\"token operator\">=</span><span class=\"token string\">'SCRAM-SHA-256'</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                     <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>db <span class=\"token operator\">=</span> client<span class=\"token punctuation\">[</span><span class=\"token string\">'admin'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>npm <span class=\"token operator\">=</span> db<span class=\"token punctuation\">[</span><span class=\"token string\">'npm_records'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">for</span> item <span class=\"token keyword\">in</span> npm<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>limit<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    pprint<span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"27\"></td><td><pre>tunnel<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure>",
            "tags": [
                "çäº‹"
            ]
        }
    ]
}