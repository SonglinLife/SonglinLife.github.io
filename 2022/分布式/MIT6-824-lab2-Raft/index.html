<!-- build time:Wed Jun 08 2022 16:26:20 GMT+0800 (China Standard Time) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Life" href="https://songlinlife.top/rss.xml"><link rel="alternate" type="application/atom+xml" title="Life" href="https://songlinlife.top/atom.xml"><link rel="alternate" type="application/json" title="Life" href="https://songlinlife.top/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="MIT6.824"><link rel="canonical" href="https://songlinlife.top/2022/%E5%88%86%E5%B8%83%E5%BC%8F/MIT6-824-lab2-Raft/"><title>MIT6.824: lab2 Raft - åˆ†å¸ƒå¼ | Songlin = Life</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">MIT6.824: lab2 Raft</h1><div class="meta"><span class="item" title="åˆ›å»ºæ—¶é—´ï¼š2022-02-26 11:38:28"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">å‘è¡¨äº</span> <time itemprop="dateCreated datePublished" datetime="2022-02-26T11:38:28+08:00">2022-02-26</time> </span><span class="item" title="æœ¬æ–‡å­—æ•°"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">æœ¬æ–‡å­—æ•°</span> <span>12k</span> <span class="text">å­—</span> </span><span class="item" title="é˜…è¯»æ—¶é•¿"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">é˜…è¯»æ—¶é•¿</span> <span>11 åˆ†é’Ÿ</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="åˆ‡æ¢å¯¼èˆªæ "><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Songlin</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclhpw3lwj20zk0m8gvw.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipetlbztpj20zk0m84qp.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipey0a334j20zk0m8qpt.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipeuibk9fj20zk0m8ay2.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipeyhsblkj20zk0m81kx.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipexw3o58j20zk0m8e81.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">é¦–é¡µ</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="item" rel="index" title="åˆ†ç±»äº åˆ†å¸ƒå¼"><span itemprop="name">åˆ†å¸ƒå¼</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://songlinlife.top/2022/%E5%88%86%E5%B8%83%E5%BC%8F/MIT6-824-lab2-Raft/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Kalice"><meta itemprop="description" content=", Life is not about lifestyle, it means Lithium and Ferrum."></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Life"></span><div class="body md" itemprop="articleBody"><p>é¦–å…ˆæˆ‘æ˜¯è¯»äº†è®ºæ–‡ä¹‹åå†å†™è¿™ä¸ª lab çš„ï¼Œä½† raft è®ºæ–‡çš„å†…å®¹å¤ªå¤šäº†ï¼Œåªèƒ½æ…¢æ…¢ä¸€ç‚¹ç‚¹çœ‹ã€‚ç°åœ¨è¿˜æ˜¯å…ˆæŠŠ lab å®Œæˆã€‚</p><p>å¼ºçƒˆå®‰åˆ©ï¼š<span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvbFViVkJWenZOVnhoZ2JjSFFCYmtrUQ==">https://mp.weixin.qq.com/s/lUbVBVzvNVxhgbcHQBbkkQ</span></p><p>å…ˆä¸Šå›¾</p><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220305162951465.png" alt="image-20220305162951465"></p><p>4 ä¸ªå°é¢˜å…¨éƒ¨é€šå…³ï¼Œå¹¶ä¸”å¹¶è¡Œæµ‹è¯• 1000 æ¬¡æ— å‡ºé”™ã€‚</p><h3 id="part-2a"><a class="anchor" href="#part-2a">#</a> Part 2A</h3><p><strong>ä»»åŠ¡è¦æ±‚</strong>ï¼šå®ç°é€‰ä¸¾ç®—æ³•å’Œå¿ƒè·³åŒ…ã€‚å¦‚æœæ—§çš„ leader æ²¡æœ‰é—®é¢˜å°±è®©æ—§çš„ leader ç»§ç»­æ‰§è¡Œï¼Œå¦‚æœæ—§çš„ leader æœ‰é—®é¢˜é‚£ä¹ˆå°±é€‰ä¸¾æ–°çš„ leaderã€‚</p><p>è¿™æ„å‘³ç€æˆ‘ä»¬ä¸ç”¨è®¾ç½® normal termï¼Œåªè¦è€ƒè™‘ leader fail è¿™ç§æƒ…å†µã€‚</p><p><strong>ä»»åŠ¡æç¤º</strong>ï¼š</p><ul><li>å®Œæˆ <code>raft.go</code></li><li>å®Œæˆ <code>RequestVote</code> RPC</li><li>å®ç° <code>AppendEntries</code> RPC</li><li>æ³¨æ„ä¸è¦å‘ç”ŸåŒæ—¶è¿›è¡Œé€‰ä¸¾çš„æƒ…å†µã€‚</li><li>è¦æ±‚ leader å‘ç”Ÿå¿ƒè·³åŒ…æ¯ç§’ä¸è¶…è¿‡ 10 æ¬¡ã€‚</li><li>è¦æ±‚æ—§çš„ leader fail 5 ç§’å†…å®Œæˆé€‰ä¸¾ã€‚</li><li>å› ä¸º tester æ—…ç¨‹æ¯ç§’åªèƒ½å‘é€ 10 æ¬¡å¿ƒè·³ï¼Œæ‰€ä»¥ election timeout å¿…é¡»è¦å¤§äº paper é‡Œæè¿°çš„ 150-300ã€‚</li></ul><h3 id="part2b"><a class="anchor" href="#part2b">#</a> Part2B</h3><h4 id="33æ›´æ–°"><a class="anchor" href="#33æ›´æ–°">#</a> 3.3 æ›´æ–°</h4><p>æˆ‘çœŸçš„æƒ³å¹²æ­»ä»–å¦ˆäº†ï¼ŒæŠ˜è…¾äº†å¥½å‡ å¤©ç»ˆäºæ— ä¼¤æ‰“è¿‡ LAB2Bï¼Œè¿è¡Œ 100 æ¬¡ä¹Ÿæ²¡æœ‰å‡ºé”™ï¼Œè¿™é‡Œé¢çš„å‘ç‚¹çœŸçš„å¾ˆå¤šã€‚</p><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220303115450291.png" alt="image-20220303115450291"></p><p>é¦–å…ˆéœ€è¦æ˜ç¡® committed æ˜¯å¦‚ä½•è¢«ç¡®è®¤çš„ï¼š</p><p>å¯¹äº leader æ¥è¯´ï¼š<strong>nextIndex -&gt; matchIndex -&gt; commitIndex -&gt; applyIndex</strong></p><blockquote><p>If there exists an N such that N &gt; commitIndex, a majority of matchIndex[i] â‰¥ N, and log[N].term == currentTerm: set commitIndex = N</p></blockquote><p>åˆšå¼€å§‹æˆ‘ä¹Ÿæä¸æ‡‚è¿™ä¸ª <code>matchIndex</code> æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œleader æ˜¯é€šè¿‡ check majority matchIndex å¹¶ä¸”å¦‚æœè¯¥ log entry å±äºå½“å‰ term å°±ç¡®è®¤ committedã€‚</p><p>å¯¹äº follower: **preLogIndex -(åŒ¹é…æˆåŠŸ)&gt; len (logs) -compart with leadercommitted&gt; commitIndex -&gt; applyIndex **</p><p><strong>commitIndex = min(len(logs) , leaderCommitted</strong></p><p>å¯¹äº follower æ¥è¯´å¯ä»¥æ˜¯ leader å‘ŠçŸ¥ committedï¼Œä¹Ÿå¯ä»¥æ˜¯é€šè¿‡ append log åè‡ªå·±ç¡®è®¤ï¼Œæ€»ä¹‹è¿™ä¸ªè¿‡ç¨‹é€»è¾‘è‡ªæ´½ã€‚</p><p>ä½†æ˜¯è¿™ä¸ªæœ‰ä¸€ä¸ªå¾ˆä¸¥é‡çš„å‘ç‚¹ï¼Œä¼šå¯¼è‡´æ—¶ä¸æ—¶å‡ºç° <strong>index out of range</strong> è¿™ä¸ªé”™è¯¯ã€‚è¿™ä¸ªé”™è¯¯å…¶å®æœ‰åœ¨ raft guide ä¸Šå†™æ˜ï¼Œä½†æ˜¯æˆ‘å½“æ—¶å¹¶æ²¡æœ‰çœ‹æ‡‚ï¼Œå¯¼è‡´æ‰§è¡Œ 100 æ¬¡æ€»æœ‰å‡ æ¬¡æŠ¥è¿™ä¸ª out of range é”™è¯¯ã€‚ã€‚ã€‚ã€‚</p><p>å‡ºç°è¿™ä¸ªé—®é¢˜çš„åŸå› å°±æ˜¯ follower åº”ç”¨äº† stale AppendEntries PRCï¼Œç„¶åç»™ leader å‘é€äº† reply success = trueã€‚å› ä¸º leader ä¼šé‡å¤å‘é€ AppendEntries PRCï¼Œå¦‚æœæŸä¸ª AppendEntries PRC è¿”å› true åï¼Œleader å°±ä¼šæ‰§è¡Œï¼š<strong>nextIndex[server] += len(args.entries)</strong>ï¼Œè¿™å°±å¯¼è‡´æœ‰æ—¶å€™ leader ä¼šå°†ç›¸åŒçš„ AppendEntries PRC åº”ç”¨ä¸¤æ¬¡åï¼ŒnextIndex [server] += len (args.entries) ä¹Ÿæ‰§è¡Œä¸¤æ¬¡ã€‚æœ€åå¯¼è‡´ nextIndex [server] è¦è¶…è¿‡äº† log çš„é•¿åº¦ã€‚</p><p>è§£å†³æ–¹æ³•ï¼š</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre>last <span class="token operator">:=</span> rf<span class="token punctuation">.</span>logs<span class="token punctuation">[</span>args<span class="token punctuation">.</span>PrevLogIndex<span class="token operator">+</span><span class="token number">1</span> <span class="token punctuation">:</span> <span class="token function">len</span><span class="token punctuation">(</span>rf<span class="token punctuation">.</span>logs<span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// éš¾ç‚¹åœ¨äºå¦‚ä½•åˆ¤æ–­æ—§çš„ rpc</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>last<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">len</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>Entries<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">len</span><span class="token punctuation">(</span>last<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">&#123;</span> <span class="token comment">// åˆ¤æ–­è¦ append çš„ log entries æ˜¯ä¸æ˜¯å·²ç» append ä¸Šäº†</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    flag <span class="token operator">:=</span> <span class="token boolean">true</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>last<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">if</span> last<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>TermNumber <span class="token operator">!=</span> args<span class="token punctuation">.</span>Entries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>TermNumber <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            flag <span class="token operator">=</span> <span class="token boolean">false</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">if</span> flag <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        reply<span class="token punctuation">.</span>XTerm <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token comment">// è¡¨ç¤ºè¿™ä¸ªæ˜¯è¿‡æ—¶çš„ rpc</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">return</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ä¸ªå¾ˆä¸¥é‡çš„å‘ç‚¹ï¼Œå°±æ˜¯é€‰ä¸¾è¶…æ—¶é‡ç½®ï¼Œå®ƒä¼šå¯¼è‡´<strong> rejoin of partitioned leader <em>...</em></strong> è¿™ä¸ªæµ‹è¯•æ—¶ä¸æ—¶å¤±è´¥ï¼Œè¿™æ˜¯å› ä¸ºé€‰ä¸¾ä¸å½“ï¼Œå¯¼è‡´ cluster æ²¡æœ‰åŠæ—¶é€‰ä¸¾å‡º leaderã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œä»€ä¹ˆæ—¶å€™æ‰ä¼šé‡ç½® election timeoutï¼š</p><ul><li>å½“ follower å‡çº§ä¸º candidate æ—¶ä¼šé‡ç½®ã€‚</li><li>å½“ follower æŠ•å‡ºè‡ªå·±çš„ä¸€ç¥¨æ—¶ä¼šé‡ç½®ã€‚</li><li>å½“ follower æ¥å—åˆ° leader çš„ appendEntries PRC æ—¶ä¼šé‡ç½®ã€‚</li></ul><p>ç¬¬ä¸€ç§æƒ…å†µå¾ˆç®€å•ï¼Œå°±æ˜¯å› ä¸ºè¶…æ—¶æ‰ä¼šå‡çº§ä¸º candidateï¼Œæ‰€ä»¥æˆä¸º candidate åå¿…é¡»é‡ç½®ã€‚</p><p>ç¬¬äºŒæƒ…å†µæœ‰äº›å¤æ‚ï¼Œå¦‚æœä¸€ä¸ª leader æˆ–è€… candidate æ¥å—åˆ°ä¸€ä¸ª vote requestï¼Œå…¶ä¸­ rf.currentTerm &lt; args.Termã€‚è¿™è¯´æ˜è¯¥ leader æˆ–è€… candidate å·²ç» out of dateï¼Œå¿…é¡»å¼ºåˆ¶è½¬æ¢ä¸º followerï¼Œæ³¨æ„ï¼Œå¼ºåˆ¶è½¬æ¢ä¸º follower å¹¶ä¸ä»£è¡¨å®ƒå¯ä»¥é‡ç½®å®ƒè‡ªèº«çš„ election timeoutã€‚åªæœ‰æ»¡è¶³ä¸¥æ ¼é€‰ä¸¾è¦æ±‚ï¼ŒæŠŠè‡ªå·±çš„ç¥¨æŠ•å‡ºå»åæ‰å¯ä»¥é‡ç½®ã€‚follower åœ¨æ¯ä¸€ä¸ª Term æœ‰ä¸”åªæœ‰ä¸€å¼ é€‰ç¥¨ï¼ä½† server è¿›è¡Œ term æå‡åå°±å¯ä»¥åˆ†é…ä¸€å¼ æ–°é€‰ç¥¨ã€‚</p><p>ç¬¬ä¸‰ç§æƒ…å†µå…¶å®å’Œç¬¬äºŒç§æƒ…å†µç±»ä¼¼ï¼ŒappendEntries PRC åªèƒ½ç”± leader å‘å‡ºï¼Œä¸€æ—¦å½“å‰ server ç¡®è®¤å…¶è‡ªèº«çš„ currentTerm &lt;= args.Term å°±ä¼šæŠŠé€‰ä¸¾æ—¶é—´é‡ç½®ã€‚</p><p>åªè¦æ³¨æ„è¿™ä¸¤ä¸ªé—®é¢˜ï¼šæ—§ AppendEntries å’Œ election timeoutï¼Œå°±å¯ä»¥è½»æ¾ pass all test äº†ï¼</p><h3 id="part-2c"><a class="anchor" href="#part-2c">#</a> Part 2C</h3><p>è¿™ä¸ª lab è¦æ±‚æˆ‘ä»¬å®ç° persistenceã€‚</p><h4 id="33æ›´æ–°-2"><a class="anchor" href="#33æ›´æ–°-2">#</a> 3.3 æ›´æ–°</h4><p>æ— ä¼¤é€šå…³ï¼Œå°±å¾ˆ niceï¼</p><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220303191029815.png" alt="image-20220303191029815"></p><p>æ‰§è¡Œè¶…è¿‡ 100 æ¬¡ï¼Œä»ç„¶è¿™ä¹ˆåšæŒºï¼å¤ªä½©æœæˆ‘è‡ªå·±äº†ï¼Œå˜¿å˜¿ğŸ˜„</p><p>è¿™ä¸ªåŸºæœ¬æ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯å®ç° <code>persist</code> ï¼Œç„¶åæŠŠ <code>persist()</code> æ’å…¥åˆ° persist state å˜æ¢çš„åœ°æ–¹ï¼Œé€šè¿‡ figure 2 ä¸éš¾çŸ¥é“ï¼š</p><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220303172723928.png" alt="image-20220303172723928"></p><p>åªè¦è¿™ä¸‰ä¸ªå˜é‡æ”¹å˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±æ’å…¥ <code>persist</code> ã€‚</p><p>ä½†æ˜¯è¿™é‡Œä¹Ÿæœ‰ä¸€ä¸ªå‘ç‚¹ï¼Œè¿™å°± appendEntries RPC ä¼šå› ä¸ºç½‘ç»œå‡ºé”™ï¼Œä¸‹é¢æˆ‘æ¥æè¿°ä¸€ä¸‹å‡ºé”™æƒ…å¢ƒï¼š</p><p>é¦–å…ˆæ˜ç¡®ï¼Œå› ä¸ºæˆ‘ä»¬ä¼šä¸æ–­é‡å¤å‘ AppendEntries RPCï¼Œè¿™å°±å¯¼è‡´ follower éœ€è¦æ£€æŸ¥ï¼Œè¿™ä¸ª AppendEntries RPC æ˜¯å¦å·²ç»è¿‡æ—¶ï¼Œå¦‚æœè¿‡æ—¶å°±è¿”å› falseï¼Œå¦‚æœæ²¡è¿‡æ—¶å°±è¿”å› true</p><h5 id="testfigure8unreliable2cæŠ¥é”™è¿”å›trueçš„appendentriesrpcä¸¢å¤±é—®é¢˜"><a class="anchor" href="#testfigure8unreliable2cæŠ¥é”™è¿”å›trueçš„appendentriesrpcä¸¢å¤±é—®é¢˜">#</a> TestFigure8Unreliable2C æŠ¥é”™ï¼Œè¿”å› true çš„ AppendEntriesRPC ä¸¢å¤±é—®é¢˜</h5><p>åŸå› åœ¨äºï¼Œleader é¦–å…ˆå‘é€äº†ä¸€ä»½ entriesï¼Œfollower é€šè¿‡ AppendEntries æ”¶åˆ°äº†è¿™ä»½ Entriesã€‚follower æ£€æŸ¥åˆ°è¿™ä¸ª AppendEntries ä¸­æºå¸¦çš„ Entries æ²¡æœ‰è¢« Append åˆ°è‡ªå·±çš„ logs ä¸­ï¼Œäºæ˜¯å®ƒ appendï¼Œå¹¶è¿”å› trueã€‚ä½†æ˜¯è¿™ä¸ªæœ¬è¯¥è¿”å› true çš„ AppendEntries RPC å› ä¸ºç½‘ç»œæ²¡æœ‰è¿”å›ï¼ˆæ°¸ä¹…ä¸¢å¤±ï¼Œæˆ–è€…è¿”å›å¾ˆæ…¢ï¼Œleader è¶…æ—¶ä¸å†æ¥å—ï¼‰ï¼Œleader äºæ˜¯åˆé‡æ–°å‘é€äº†ä¸€ä»½ç›¸åŒçš„ Entriesã€‚follower æ£€æŸ¥åˆ°è¿™ä¸ª AppendEntries ä¸­æºå¸¦çš„ Entries ä¹‹å‰å·²ç» Append è¿‡äº†ï¼Œäºæ˜¯å®ƒè¿”å›ç»™ leader falseã€‚leader æ”¶åˆ° false åäºæ˜¯é‡å¤å‘é€ï¼Œäºæ˜¯æ•´ä¸ªç³»ç»Ÿé™·å…¥äº† <code>living lock</code> ã€‚</p><p><strong>è§£å†³åŠæ³•</strong>ï¼šå½“ follower æ£€æµ‹åˆ° stale AppendEntriesRPC æ—¶ï¼Œå®ƒå‘Šè¯‰ leaderï¼Œè¿™ä¸ª RPC è¿‡æ—¶äº†ï¼Œå¹¶ä¸”åŒæ—¶è¿”å› follower è‡ªå·±çš„ <code>len(logs)</code> ä¹Ÿå°±æ˜¯ <code>XIndex</code> ã€‚leader æ£€æŸ¥åˆ°è¿‡æ—¶çš„ RPCï¼Œå®ƒé€šè¿‡æ£€æŸ¥ <code>reply.XIndex == len(args.Entris) + rf.nextIndex[server]</code> ï¼Œå¦‚æœæ»¡è¶³è¯´æ˜å®ƒæ²¡æœ‰æ¥å—åˆ°é‚£ä¸ªè¿”å› true çš„ AppendEntriesï¼Œäºæ˜¯å®ƒå°† <code>rf.nextIndex[server] = reply.Xindex</code> ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿè§£å†³è¿”å› true çš„ AppendEntriesRPC ä¸¢å¤±é—®é¢˜ã€‚</p><h5 id="unreliable-churn-out-of-range-é—®é¢˜"><a class="anchor" href="#unreliable-churn-out-of-range-é—®é¢˜">#</a> unreliable churn out of range é—®é¢˜</h5><p>åŸå› åœ¨äºï¼Œç½‘ç»œå¤ªæ··ä¹±äº†ã€‚åœ¨ä¸Šé¢æˆ‘ä»¬æåˆ°ï¼Œè¿”å› true çš„ AppendEntriesRPC ä¼šå› ä¸ºç½‘ç»œä¸¢å¤±ï¼Œç„¶å leader ä¸€ç›´é™·å…¥æ´»é”ã€‚æˆ‘ä»¬çš„è§£å†³åŠæ³•æ˜¯å‘Šè¯‰ leaderï¼Œè¿™ä¸ª AppendEntries è¿‡æ—¶äº†ï¼Œleader æ¥æ£€æŸ¥éœ€ä¸éœ€è¦ä¿®æ”¹ <code>rf.nextIndex</code> ã€‚</p><p>ä½†æ˜¯ï¼ï¼ï¼</p><p>ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œå› ä¸ºç½‘ç»œå¾ˆä¹±ï¼Œå¦‚æœ stale appendEntriesRPC è¦æ¯”é‚£ä¸ªè¿”å› true çš„ AppendEntriesRPC å…ˆè¿”å›å‘¢ï¼Ÿleader å¯¹äº stale AppendEntriesRPCï¼Œå®ƒä¼šè®¤ä¸ºè‡ªå·±ä¹‹å‰çš„é‚£ä¸ªè¿”å› True çš„ AppendEntriesRPC ä¸¢å¤±äº†ã€‚äºæ˜¯ leader ä¿®æ”¹äº†è‡ªå·±çš„ nextIndexã€‚ä½†æ˜¯é‚£ä¸ªè¿”å› true çš„ AppendEntries å› ä¸ºç½‘ç»œè¿˜å¯ä»¥ï¼Œæœ€åè¿˜æ˜¯æˆåŠŸè¿”å›äº†ã€‚leader äºæ˜¯åˆä¿®æ”¹äº†è‡ªå·±çš„ <code>nextIndex</code> ã€‚è¿™å°±å¯¼è‡´äº† out of range çš„å‡ºç°ï¼Œå¹¶ä¸”è¿™ä¸ªé—®é¢˜æ˜¯å¶å‘æ€§çš„ï¼Œå› ä¸ºè¿™å±äºç½‘ç»œä¸­çš„æç«¯æƒ…å†µã€‚</p><p>æˆ‘ä»¬çš„è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼Œå¦‚æœ leader è¦ä¿®æ”¹è‡ªå·±çš„ nextIndexï¼Œå¿…é¡»æ»¡è¶³ï¼š</p><p><code>reply.XIndex == len(args.Entries) + rf.nextIndex[server]</code></p><h5 id="testfigure8unreliable2cç¨€æœ‰out-of-range"><a class="anchor" href="#testfigure8unreliable2cç¨€æœ‰out-of-range">#</a> TestFigure8Unreliable2C ç¨€æœ‰ out of range</h5><p>å› ä¸ºæˆ‘çš„ log æ—¥å¿—çš„ index æ˜¯ä» 1 å¼€å§‹çš„ï¼Œäºæ˜¯åœ¨åˆå§‹åŒ–æ—¶å€™ï¼Œæˆ‘ä¼šé»˜è®¤å°† index = 0 è®¾ç½®ä¸º 0ï¼Œ applyindex =0 , commitIndex= 0ã€‚</p><p>ä½†æ˜¯åœ¨è®¾ç½® nextIndexï¼Œå› ä¸ºæ—¥å¿—ä¸åŒ¹é…ï¼Œæˆ‘å°±éœ€è¦éå†æ‰¾åˆ°æœ€ä¼˜çš„ Indexï¼Œä½†æ˜¯è¿™é‡Œæˆ‘çš„éå†æ¡ä»¶æ˜¯ï¼š</p><p><code>for i = len(rf.logs) - 1; i &gt;= 0; i--</code></p><p>è¿™å°±ä¼šå¯¼è‡´åœ¨å¾ˆç½•è§çš„æƒ…å†µä¸‹ï¼Œi ä¼šè¢«å½’ä¸º 0ï¼Œè€Œæˆ‘ä»¬ç”¨ 0 ç»™ nextIndex èµ‹å€¼ï¼Œå°±å¯¼è‡´ preLogIndex å˜æˆäº† - 1ã€‚è¿™å°±ä¼šå‡ºç° out of rangeã€‚ä½†è¿™ä¸ªæƒ…å†µå¾ˆå°‘è§ï¼Œ100 æ¬¡é‡Œèƒ½å‡ºç° 1 æ¬¡ï¼Ÿ</p><p>æ”¹æˆï¼š <code>for i = len(rf.logs) - 1; i &gt;= 1; i--</code> å°±è¡Œäº†ã€‚</p><p><strong>éƒ½æ˜¯ç»†èŠ‚ï¼çœŸçš„å¤ªç»†äº†ã€‚ã€‚ã€‚ã€‚</strong></p><h3 id="part2d"><a class="anchor" href="#part2d">#</a> Part2D</h3><p>è¿™ä¸ª lab è¦æ±‚æˆ‘ä»¬å®Œæˆ log compactionã€‚</p><p>éœ€è¦å®ç° <code>Snapshot(index int, snapshot []byte)</code> ï¼Œtester æ¥å®šæœŸè°ƒç”¨ã€‚</p><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220303200330913.png" alt="image-20220303200330913"></p><h4 id="æ— ä¼¤é€šå…³34æ›´æ–°"><a class="anchor" href="#æ— ä¼¤é€šå…³34æ›´æ–°">#</a> æ— ä¼¤é€šå…³ï¼ï¼ï¼ï¼ï¼ï¼ˆ3.4 æ›´æ–°ï¼‰</h4><p>ç»ˆäºæ— ä¼¤é€šå…³äº† lab2 äº†ï¼ŒçœŸçš„æœäº†æˆ‘è‡ªå·±äº†ã€‚</p><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220304214412025.png" alt="image-20220304214412025"></p><p>æ‰¹é‡æµ‹è¯•è¿˜åœ¨è·‘ï¼Œä½†æ˜¯é—®é¢˜ä¸å¤§ï¼Œå˜¿å˜¿ã€‚</p><p>2D å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯éœ€è¦å°†åŸæ¥çš„ç´¢å¼•è¿›è¡Œæ›¿æ¢ï¼Œæˆ‘çš„é€‰æ‹©æ˜¯å†™ä¸¤ä¸ªè½¬æ¢å‡½æ•°ï¼š</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>rf <span class="token operator">*</span>Raft<span class="token punctuation">)</span> <span class="token function">Convert</span><span class="token punctuation">(</span>index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token keyword">return</span> index <span class="token operator">-</span> rf<span class="token punctuation">.</span>lastIncludedIndex</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>rf <span class="token operator">*</span>Raft<span class="token punctuation">)</span> <span class="token function">Reconvert</span><span class="token punctuation">(</span>index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token keyword">return</span> index <span class="token operator">+</span> rf<span class="token punctuation">.</span>lastIncludedIndex</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>åœ¨åˆšå¼€å§‹æˆ‘çš„æƒ³æ³•æ˜¯ï¼Œå› ä¸ºæ¯ä¸€æ¬¡åš snap éƒ½ä¼šåˆ‡æ–­ logsï¼Œäºæ˜¯éœ€è¦è€ƒè™‘å¤„ç†ç©º log æ—¥å¿—çš„æƒ…å†µï¼Œä½†æ˜¯å…¶å®æ²¡æœ‰å¿…è¦ï¼Œå¦‚æœè€ƒè™‘ç©º log ä¼šå¯¼è‡´æ•´ä¸ªä»£ç é€»è¾‘å˜å¾—éå¸¸å¤æ‚ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šæ¯ä¸€æ¬¡åš snapshot å¾—åˆ°æ–°çš„ log æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨ logs å‰é¢æ’å…¥ä¸€ä¸ªç©º log entryï¼Œå¹¶ä¸”å®ƒçš„ term ç­‰äº <code>lastIncludeTerm</code> ã€‚äºæ˜¯æˆ‘ä»¬ä¹‹å‰å†™çš„ä»£ç å°±åªè¦ä¸€ç‚¹ç‚¹æ”¹å˜ã€‚</p><p>ç¬¬äºŒä¸ªå‘ç‚¹å°±æ˜¯ï¼Œé€‰æ‹©ä»€ä¹ˆæ—¶å€™è°ƒç”¨ Installsnapshotã€‚æˆ‘æœ€å¼€å§‹æƒ³çš„æ˜¯åœ¨ sendAppendEntries åœ¨è¿™ä¸ªå‡½æ•°çš„è¿”å›é€»è¾‘éƒ¨åˆ†è¿›è¡Œå¤„ç†ï¼Œä½†æ˜¯ç”±äº RPC æ˜¯å»ºç«‹åœ¨ UDP ä¸Šçš„ï¼Œæ•´ä¸ªç½‘ç»œå¼‚å¸¸æ··ä¹±ï¼Œå¯¼è‡´å¯èƒ½å¤šä¸ª Installsnapshot è°ƒç”¨ä¹‹é—´é¡ºåºå¾ˆä¹±ï¼Œä¸åˆ©äºæˆ‘ä»¬çš„æ€è€ƒã€‚</p><p>è§£å†³åŠæ³•ï¼šæŠŠè°ƒç”¨ Installsnapshot æ”¾åˆ° heartbeat å‡½æ•°é‡Œï¼Œè®©æ¯ä¸€æ¬¡ heartbeat è€ƒè™‘è¦ä¸è¦è°ƒç”¨ installsnapshotã€‚</p><h4 id="installsnapshot-rpc"><a class="anchor" href="#installsnapshot-rpc">#</a> Installsnapshot RPC</h4><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220304215521240.png" alt="image-20220304215521240"></p><p>æŒ‰ç…§è¦æ±‚å®ç°è¿™ä¸ª RPC å°±è¡Œäº†ï¼Œéœ€è¦æ³¨æ„å› ä¸ºæ•´ä¸ªç½‘ç»œä¸å¯ä¿¡ï¼Œæˆ‘ä»¬éœ€è¦éªŒè¯è¿™ä¸ª InstallSnapshot æ˜¯å¦å·²ç»è¿‡æ—¶ã€‚</p><h3 id="é—ç•™çš„é—®é¢˜"><a class="anchor" href="#é—ç•™çš„é—®é¢˜">#</a> é—ç•™çš„é—®é¢˜</h3><p>è¿™æ˜¯æˆ‘åšè¿™ä¸ª lab å‘ç°çš„ä¸€ä¸ªå¾ˆå¥‡å¦™çš„ç°è±¡ï¼Œä½†æˆ‘å®Œæˆäº† 2D çš„æ—¶å€™ï¼Œå›è¿‡å¤´æˆ‘æ£€æŸ¥ä¹‹å‰çš„ ABC æµ‹è¯•ï¼Œå‘ç° B æµ‹è¯•ä¸­çš„ *ğŸ˜— RPC byte count æµ‹è¯•å‡ºç° RPC byte count failedã€‚</p><p>è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸ºï¼Œæ•´ä¸ªç½‘ç»œæ˜¯ UDP çš„ï¼Œä¼šå‡ºç°è¿™ä¹ˆä¸€ç§æƒ…å†µï¼šRPC åŒ…å‘å‡ºå»åï¼Œå› ä¸º UDP å¹¿æ’­ï¼Œè¢«è‡ªå·±ç«‹å³æ¥å—äº†ï¼Œå¹¶è¿”å›ã€‚è¿™æ ·å°±ä½¿å¾—æ•´ä¸ªç½‘ç»œå˜å¾—å¼‚å¸¸è‡ƒè‚¿ã€‚</p><p>è¿™ä¸ª Bug å‡ºç°çš„åŸå› æ˜¯å› ä¸ºï¼Œæˆ‘åœ¨ä»£ç ä¸­å¢åŠ äº†è¿™æ ·ä¸€ä¸ªé€»è¾‘ï¼Œä¸€æ—¦æ£€æŸ¥åˆ°è‡ªå·±å‘å‡ºçš„ RPC åŒ…è¢«è‡ªå·±æ¥æ”¶åå°± returnã€‚</p><p>ä½†æ˜¯æˆ‘è‡³ä»Šä¹Ÿæ²¡ææ‡‚ï¼Œä¸ºä»€ä¹ˆä¸è¡Œï¼</p><p>è¿™ä¸ªé—®é¢˜ï¼Œæœªæ¥çš„æˆ‘ï¼Œä½ å¯ä»¥è§£å†³çš„å¯¹å§ï¼ŸğŸ˜</p><h3 id="raft-basic"><a class="anchor" href="#raft-basic">#</a> Raft Basic</h3><p>å°† servers åˆ†ä¸ºä¸‰ç§çŠ¶æ€ï¼šleaderã€follower å’Œ candidateã€‚</p><p>follower æ˜¯æ¶ˆæçš„ï¼Œä»–ä»¬åªèƒ½å“åº” leader æˆ–è€… candidate çš„è¯·æ±‚ã€‚candidate æ˜¯é€‰ä¸¾æ—¶äº§ç”Ÿçš„ã€‚</p><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220226123046018.png" alt="image-20220226123046018"></p><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220226123113136.png" alt="image-20220226123113136"></p><p>å°±åƒå›¾ä¸­æè¿°çš„ï¼Œterm åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ election å’Œ normalã€‚æ¯ä¸ª term éƒ½æœ‰å¯¹äºçš„ current term numberã€‚<strong>å¦‚æœ candidate æˆ–è€… leader å‘ç°ä»–çš„ term è¿‡æ—¶äº†ï¼Œé‚£ä¹ˆä»–ä»¬ä¼šè‡ªåŠ¨å˜ä¸º followsã€‚</strong></p><p>RequestVote RPCs åœ¨é€‰ä¸¾æ—¶ç”± candidate è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶ä¸” AppendEntries RPCs è¢« leader åˆå§‹åŒ–ç”¨äºå¤åˆ¶ log entries å’Œæä¾› heartbeatï¼ˆå°±æ˜¯ç©ºçš„ AppendEntriesï¼‰ã€‚</p><p><strong>è®°ä½ raft ä¸­çš„èŠ‚ç‚¹å…¶å®å°±æ˜¯çŠ¶æ€æœºï¼</strong></p><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220228220844868.png" alt="image-20220228220844868"></p><p>è¿™é‡Œæˆ‘æœ‰ä¸€ä¸ªæƒ³æ³•ï¼Œå› ä¸ºæ˜¯ state machineï¼Œç”±äº raft å±‚è®°å½•äº† lastApplyï¼Œè€Œä¸” state machine åªèƒ½ apply committed entriesã€‚æ‰€æœ‰çš„æœºå­éƒ½ä¼š apply ç›¸åŒçš„ committed entriesã€‚å› æ­¤è¿™é‡Œå¯èƒ½ä¼šå‡ºç°é‡å¤å“åº”æƒ…å†µï¼Œæ¯”å¦‚ client å‘é€è¯·æ±‚ç»™ leaderï¼Œleader committed è¯·æ±‚åè¿”å›ç»™ client å“åº”ä¹‹åé©¬ä¸ŠæŒ‚æ‰äº†ï¼Œraft é€šè¿‡é€‰ä¸¾äº§ç”Ÿäº†æ–°çš„ leaderï¼Œé‚£ä¹ˆæ–°çš„ leader å¯èƒ½ä¼šè®© state machine é‡å¤ applyï¼Œä¹Ÿå°±æ˜¯é‡å¤å‘é€å“åº”ã€‚</p><p><strong>ä½†æ˜¯è¿™æ²¡æœ‰é—®é¢˜ï¼é‡å¤æ˜¯ tcp å±‚åº”è¯¥è§£å†³çš„é—®é¢˜ã€‚</strong></p><p>LastApply æ°¸è¿œåº”è¯¥å°äºæˆ–ç­‰äº committed indexï¼</p><h3 id="leaderé€‰ä¸¾"><a class="anchor" href="#leaderé€‰ä¸¾">#</a> Leader é€‰ä¸¾</h3><p>server å¼€å¯ï¼Œåˆå§‹çŠ¶æ€ä¸º followerï¼Œå¹¶ä¸”å¦‚æœä»–æ”¶åˆ° <code>leader</code> æˆ–è€… <code>candidate</code> çš„æœ‰æ•ˆ RPCsï¼Œé‚£ä¹ˆå°±ä¼šä¸€ç›´ç»´æŒ followerã€‚å¦‚æœ follower åœ¨ election timeout å†…æ²¡æœ‰æ”¶åˆ°ä»»ä½• RPCsï¼Œé‚£ä¹ˆä»–å°±ä¼šå¢åŠ  current term å¹¶ä¸”æˆä¸º candidate å¼€å¯é€‰ä¸¾ã€‚</p><h4 id="follower"><a class="anchor" href="#follower">#</a> follower</h4><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220226150941941.png" alt="image-20220226150941941"></p><h4 id="candidate"><a class="anchor" href="#candidate">#</a> candidate</h4><p>é€šè¿‡ RequestVote RPC åŒæ—¶å‘é›†ç¾¤ä¸­æ‰€æœ‰çš„ server è¦æ±‚æŠ•ç¥¨ã€‚</p><h5 id="requestvote-rpcçš„ç»“æ„"><a class="anchor" href="#requestvote-rpcçš„ç»“æ„">#</a> RequestVote RPC çš„ç»“æ„ï¼š</h5><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220226150031701.png" alt="image-20220226150031701"></p><h5 id="candidateéœ€è¦åšçš„"><a class="anchor" href="#candidateéœ€è¦åšçš„">#</a> candidate éœ€è¦åšçš„ï¼š</h5><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220226150232338.png" alt="image-20220226150232338"></p><p>è¿™é‡Œå…¶å®è¿˜å°‘äº›äº†ä¸€ä¸ªå¾ˆé‡è¦çš„æ¡ä»¶ï¼š</p><blockquote><p>Current terms are exchanged whenever servers communicate; if one serverâ€™s current term is smaller than the otherâ€™s, then it updates its current term to the larger value. If a candidate or leader discovers that its term is out of date, it immediately reverts to follower state. If a server receives a request with a stale term number, it rejects the request.</p></blockquote><p>ä¹Ÿå°±è¯´å¦‚æœ leader æˆ–è€… candidate å‘ç°æœ‰äººçš„ current term number æ¯”å®ƒçš„è¿˜è¦å¤§ï¼Œé‚£ä¹ˆå°±è‡ªåŠ¨å˜æˆ followerï¼Œè¿™ä¸ªç‰¹æ€§å¾ˆé‡è¦ï¼</p><h4 id="å…³äºrandomized-election-timeouts"><a class="anchor" href="#å…³äºrandomized-election-timeouts">#</a> å…³äº randomized election timeouts</h4><p>è®ºæ–‡ä¸­æåˆ°ï¼š</p><blockquote><p>raft uses randomized election timeouts to ensure that split votes are rare and that they are resolved quickly.</p></blockquote><p>è¿™ä¸ªä¸€ç›´å›°æ¼æˆ‘ï¼Œæ•´ä¸ªéšæœº election timeouts æ˜¯å¦‚ä½•è§£å†³ split votesã€‚å› ä¸ºæœ‰ä¸€æ®µè¯ï¼š</p><blockquote><p>This spreads out the servers so that in most cases only a single server will time out; it wins the election and sends heartbeats before any other servers time out.</p></blockquote><p>è¿™æ®µè¯çš„æ„æ€æ˜¯è¯´å…ˆ timeout çš„ server ä¼šè·å¾—é€‰ä¸¾èƒœåˆ©ã€‚è¿™é‡Œå°±æœ‰ä¸€ä¸ªç–‘é—®ä¸ºä»€ä¹ˆå…ˆ timeout çš„ server ä¸€å®šä¼šè·å¾—é€‰ä¸¾èƒœåˆ©ã€‚å…¶å®è¦ææ‡‚è¿˜å¾—çœ‹ followerã€‚follower åšäº†ä¸€ä»¶äº‹ï¼š</p><blockquote><p>If a follower receives no communication over a period of time called the election timeout, then it assumes there is no viable leader and begins an election to choose a new leader.</p></blockquote><p>å¦‚æœ follower åœ¨ <code>election timeout</code> æ²¡æœ‰æ”¶åˆ° leader æˆ– candidate çš„ rpcï¼Œé‚£ä¹ˆå®ƒä¼šå¼€å¯é€‰ä¸¾ï¼Œæ³¨æ„è¿™é‡Œçš„è¶…æ—¶æ—¶é—´æ˜¯ <code>election timeout</code> ã€‚ä¹Ÿå°±æ˜¯è¯´è¿‡ leader æŒ‚äº†çš„è¯ï¼Œé‚£ä¹ˆ <code>election timeout</code> æœ€å°çš„é‚£ä¸ªæœºå­å°±ä¼šå…ˆæ„è¯†åˆ°ï¼Œäºæ˜¯ä»–æˆä¸º candidate å¹¶ä¸”å‘å…¶ä»– server å‘é€ RequestVote RPCã€‚è€Œ raft çš„æŠ•ç¥¨æœºåˆ¶å°±æ˜¯å…ˆæ¥å…ˆåˆ°è§„åˆ™ï¼Œå…ˆå‘èµ·æŠ•ç¥¨çš„é‚£ä¸ª server å¾ˆæœ‰å¯èƒ½å¯ä»¥èµ¢å¾—é€‰ä¸¾ã€‚</p><p>candidate åˆå§‹åŒ–ä¹Ÿåšäº†ä¸€ä»¶äº‹ï¼š</p><blockquote><p>Each candidate restarts its randomized election timeout at the start of an<br>election, and it waits for that timeout to elapse before starting the next election</p></blockquote><p>candidate åˆå§‹åŒ–åä¹Ÿä¼šé‡æ–°éšæœºåˆå§‹åŒ–è¿™ä¸ª <code>election timeout</code> ã€‚å¦‚æœåœ¨è¿™ä¸ªé˜¶æ®µå‘ç”Ÿäº† split vote æƒ…å†µï¼Œé‚£ä¹ˆ <code>election timeout</code> æœ€å°çš„ candidate å°±ä¼šç‡å…ˆè¶…æ—¶ï¼Œå¹¶ä¸”å¼€å¯æ–°çš„æŠ•ç¥¨ï¼Œäºæ˜¯å…¶ä»– candidate çœ‹åˆ°æ–°çš„ RequestVote ä¸­çš„ <code>current term</code> å¤§äºè‡ªèº«çš„ term numberï¼Œäºæ˜¯è¿™äº› candidate å°±ä¼šè‡ªåŠ¨å˜æˆ followers å¹¶ç»™æ–°çš„ candidate æŠ•ç¥¨ã€‚äºæ˜¯ splitvote é—®é¢˜å°±å¯ä»¥å¾ˆå¥½åœ°è§£å†³äº†ï¼</p><h3 id="state"><a class="anchor" href="#state">#</a> State</h3><h4 id="æ‰€æœ‰çš„serveréƒ½æœ‰çš„çŠ¶æ€"><a class="anchor" href="#æ‰€æœ‰çš„serveréƒ½æœ‰çš„çŠ¶æ€">#</a> æ‰€æœ‰çš„ server éƒ½æœ‰çš„çŠ¶æ€</h4><p><code>committedIndex</code> ï¼šè¿™å°±æ˜¯ logs ä¸­ committed highest log entry indexï¼Œè¿™ä¸ªåˆå§‹åŒ–ä¸º 0ã€‚</p><p><code>log[]</code> ï¼šlog åˆå§‹åŒ–ä¸­ä¼šæŠŠ index ä¸º 0 åˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯åç»­æ·»åŠ  entry çš„ index éƒ½æ˜¯ä» 1 å¼€å§‹ã€‚</p><p><code>lastApplied</code> ï¼šindex of highes log entry applied to state machineã€‚é€šè¿‡ heartbeat å‘é€äº† entry ä¹‹åå—åˆ°äº† confirmï¼Œç¡®å®šæ˜¯ committed ä¹‹åå°±å¯ä»¥æ‰§è¡Œäº†ã€‚è¿™ä¸ª lab å¯èƒ½ä¸ä¼šæ¶‰åŠã€‚</p><p><code>commitIndex</code> ï¼šé€šè¿‡ heartbeat å¾—åˆ°å›å¤ï¼Œleader å°±å¯ä»¥ç¡®è®¤ committed äº†ã€‚</p><h4 id="leader-ç»´æŠ¤çš„çŠ¶æ€"><a class="anchor" href="#leader-ç»´æŠ¤çš„çŠ¶æ€">#</a> leader ç»´æŠ¤çš„çŠ¶æ€</h4><p><code>matchIndex[]</code> ï¼šå¯¹äºæ¯ä¸ª serverï¼Œéœ€è¦å¤åˆ¶çš„æœ€é«˜ log entry indexï¼Œåˆå§‹åŒ–ä¸º 0ã€‚æˆ‘è¿˜æ²¡ææ‡‚è¿™ä¸ªæœ€é«˜éœ€è¦è¢«å¤åˆ¶ä¸ºå•¥è¦åˆå§‹åŒ–ä¸º 0ã€‚</p><p><code>nextIndex[]</code> : leader ä¼šä¿å­˜ä¸‹ä¸€ä¸ªä¸º server å‘é€äº† log entry çš„ indexã€‚è¿™é‡Œçš„ index æˆ‘ç›´æ¥è®¾å®šä¸º log çš„ç´¢å¼•ã€‚ï¼ˆåˆå§‹åŒ–ä¸º <code>len(logs)</code> ï¼‰</p><h3 id="å…³äº54-safety"><a class="anchor" href="#å…³äº54-safety">#</a> å…³äº 5.4 Safety</h3><p>æœ‰ä¸ªå¤§å‰æï¼šleader å¯ä»¥æ— é™ append logï¼Œä½†æ˜¯å®ƒä¸èƒ½é€šè¿‡é€‰ä¸¾ç„¶åå¢å¤§è‡ªå·±çš„ termã€‚</p><h4 id="ä¸¥æ ¼é€‰ä¸¾"><a class="anchor" href="#ä¸¥æ ¼é€‰ä¸¾">#</a> ä¸¥æ ¼é€‰ä¸¾</h4><p>Raft ä¿è¯æ–°é€‰ä¸¾å‡ºæ¥çš„ leader å¿…é¡»æ‹¥æœ‰ä¹‹å‰ term æ‰€æœ‰çš„ committed entriesï¼Œä¹Ÿå°±æ˜¯è¯´ log entries åªèƒ½é€šè¿‡ leader æµå‘ follower è€Œä¸èƒ½ä» follower æµå‘ leaderã€‚</p><p>è¿™é‡Œ candidate èµ¢å¾—é€‰ä¸¾çš„æ¡ä»¶æœ‰æ‰€ä¸åŒã€‚</p><p>candidate åœ¨è¯·æ±‚æŠ•ç¥¨æ—¶ï¼Œä¼šå‘é€è‡ªå·±çš„ last log entry å’Œ follower çš„ last log entry è¿›è¡Œå¯¹æ¯”ã€‚å¦‚æœ candidate last log çš„ term è¦å¤§ï¼Œè·å¾— term ç›¸åŒæ—¶ candidate log entry çš„ index è¦å¤§ï¼Œåˆ™è®¤ä¸º candidate æ˜¯ä¼˜å…ˆçš„ï¼Œè¿™æ—¶å€™æ‰èƒ½è¿›è¡ŒæŠ•ç¥¨ã€‚</p><h4 id="committedè§„åˆ™"><a class="anchor" href="#committedè§„åˆ™">#</a> committed è§„åˆ™</h4><p>è®ºæ–‡çš„ figure 8 ç»™å‡ºäº†è¿™æ ·ä¸€ä¸ªæƒ…å†µï¼š</p><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220228215916592.png" alt="image-20220228215916592"></p><p>åœ¨ <code>c</code> æƒ…å†µä¸‹ï¼Œ <code>s1</code> ä½œä¸º leader å°† index 2 å¤åˆ¶ç»™äº† s2ã€s3ã€‚ç„¶åé—®é¢˜æ¥äº†ï¼Œè¿™æ · index 2 å°±æ˜¯ä¸€ä¸ª committed entry äº†ï¼Œä½†æ˜¯å¦‚æœ s1 è¿™æ—¶å€™æŒ‚æ‰ï¼Œs5 å‚ä¸åˆ°é€‰ä¸¾ï¼Œç”±äº s5 åœ¨ term3 æ—¶å€™èµ¢å¾—äº†é€‰ä¸¾ï¼Œæ‰€ä»¥ä»–æœ‰ term3 çš„ log entryï¼Œé‚£ä¹ˆ s5 åœ¨ <code>d</code> æƒ…å†µå¯ä»¥èµ¢å¾— term5 é€‰ä¸¾ï¼Œå¹¶æŠŠ index 2 å¤åˆ¶ç»™äº†å…¶ä»– serverã€‚å¯ä»¥çœ‹åˆ°æ­¤æ—¶çš„ index 2 çš„ term å˜æˆäº† 3ã€‚ä¹‹å‰çš„ committed è¢«è¦†ç›–äº†ï¼</p><p>äºæ˜¯ raft è§„å®šï¼Œåªæœ‰å½“å‰ term çš„ log entries æ‰èƒ½é€šè¿‡è®¡ç®— replicas æ•°çš„æ–¹å¼è¿›è¡Œ <code>committed</code> ã€‚</p><p>è¿™é‡Œåˆä¼šæœ‰æ–°çš„é—®é¢˜å‡ºç°äº†ï¼å¦‚æœä¸€ä¸ª command å¯¹åº”äº† log entries æ˜¯ä¹‹å‰çš„ termï¼Œé‚£ä¹ˆåŠæ—¶å½“å‰ leader æ”¶åˆ°äº† majority çš„ confirmï¼Œé‚£ä¹ˆ leader ä¹Ÿä¸èƒ½ apply è¿™ä¸ª log entryã€‚ä¸€ç›´åˆ°å½“å‰çš„ term ä¸‹æ¥äº† new commandã€‚é‚£ä¹ˆè¿™ä¸ªæ—§ term ä¸‹çš„ log entry æ‰ä¼šå¾—åˆ° confirmã€‚</p><h4 id="safety-argument"><a class="anchor" href="#safety-argument">#</a> Safety argument</h4><p><strong>é’ˆå¯¹ figure 9 çš„æƒ…å†µ</strong></p><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220228224051518.png" alt="image-20220228224051518"></p><p>æˆ‘å¯¹äºè¿™å¼ å›¾çš„ç†è§£</p><p>å¦‚æœ s5 å¯ä»¥è·å¾—å¤§éƒ¨åˆ†é€‰ç¥¨çš„è¯ï¼Œé‚£ä¹ˆè‡³å°‘ä¼šå‡ºç° s3 è¿™ç§æ—¢æ”¶åˆ°äº†ä¹‹å‰ leader çš„ log entryã€‚è¯·æ³¨æ„ï¼Œè®ºæ–‡æè¿°ä¸¥æ ¼é€‰ä¸¾æœ‰ä¸€ä¸ªå‰æï¼Œé‚£å°±æ˜¯ï¼šèµ¢å¾—é€‰ä¸¾çš„ server å¿…é¡»è¦åœ¨ majority ä¸­ä¿è¯ up-to-date log entryã€‚è¿™æ„å‘³ç€ leader å¦‚æœè‡ªå·±ä»»æœŸå†…çš„ committed entry ä¸€ç›´æ˜¯ up-to-dateã€‚ä¹Ÿå°±æ˜¯è¯´ s5 ä¸å¯èƒ½é€šè¿‡é€‰ä¸¾ï¼</p><p>æœ‰ä¸€è¯´ä¸€ï¼Œè¿˜æ˜¯æœ‰çš„æŠ½è±¡ã€‚ã€‚ã€‚ã€‚</p><h4 id="timing-and-availability"><a class="anchor" href="#timing-and-availability">#</a> Timing and availability</h4><p>éœ€è¦ä¿è¯</p><p><strong>broadcastTimeâ‰ªelectionTimeoutâ‰ªMTBF</strong></p><p><code>broadcastTime</code> å°±æ˜¯å¹³è¡Œå‘é€ RPCs çš„å¹³å‡å‘é€æ—¶é—´ + æ¥å—å“åº”æ—¶é—´ã€‚</p><p><code>electionTimeout</code> ï¼šè¿™ä¸ªå°±æ˜¯ä¹‹å‰æåˆ°äº†é€‰ä¸¾è¶…æ—¶ã€‚</p><p><code>MTBF</code> ï¼šthe average time between failures for a single server</p><p><strong>MTBFs are several months or more</strong>ï¼Œæ‰€ä»¥è¿™ä¸ªä¸ç­‰å¼å¾ˆå®¹æ˜“æ»¡è¶³</p><h3 id="log-compaction"><a class="anchor" href="#log-compaction">#</a> Log compaction</h3><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220301092739411.png" alt="image-20220301092739411"></p><p>raft çš„ snap æœºåˆ¶ç”¨äºå‹ç¼©æ—¥å¿—ï¼Œå…¶å®å®ƒä¹Ÿå¾ˆç®€å•ã€‚</p><p><code>last included index</code> å°±æ˜¯ the last entry the state machine had appliedï¼Œå°±æ˜¯ last apply indexï¼Œæ³¨æ„ï¼Œåªæœ‰ committed çš„ entry æ‰ä¼šè¢« applyï¼Œè€Œ raft å¯ä»¥ç¡®ä¿æ‰€æœ‰ committed entry éƒ½ä¼šåœ¨ state machine å¾—åˆ° applyã€‚</p><p>** å¹¶ä¸”è¿™ä¸ª snapshot è¿˜åŒ…å« state machine stateï¼** è¿™æ˜¯åˆ›å»º snap çš„æœ€å¤§å¼€é”€ã€‚</p><p>æ‰€ä»¥ä¹‹å‰å·²ç» apply çš„ log entry å®é™…ä¸Šå·²ç»æ²¡å•¥å¤ªå¤§å¸®åŠ©äº†ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿å­˜ last ç”¨äº AppendEntries consistency checkã€‚</p><p>å¯¹äºç‰¹æ®Šæƒ…å†µï¼Œæ¯”å¦‚ leader ç°åœ¨éœ€è¦åºŸå¼ƒ log entriesï¼Œä½†æ˜¯è¿™äº› log entries ä¸­è¿˜æœ‰ä¸€äº›æ²¡æœ‰å‘é€ç»™æŸä¸ª followerï¼Œæ¯”å¦‚ follower server æ‰§è¡Œå¾ˆæ…¢ï¼Œè¿™ä¸ª server åˆšåˆšåŠ å…¥ç½‘ç»œã€‚ã€‚ã€‚</p><p>äºæ˜¯è¿™æ˜¯ leader ä¼šè°ƒç”¨ InstallSnapShot RPCï¼š</p><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220301095816047.png" alt="image-20220301095816047"></p><p>leader é€šè¿‡å‘é€ chunk æ–¹å¼ï¼ŒæŠŠ snapshot å‘é€ç»™ followerã€‚</p><p>å¦‚æœ follower çš„ last log entry æ¯”æ¥æ”¶åˆ°çš„ snapshot é‡Œçš„ last index è¿˜è¦ staleï¼Œé‚£ä¹ˆ follower å°±æŠŠå…¨éƒ¨ log entrie ç»™æ‰”äº†ã€‚å¦‚æœ follower pre index å’Œ snap é‡Œçš„ last index é‡åˆï¼Œé‚£ä¹ˆå°±åªä¸¢å¼ƒä¹‹å‰çš„ã€‚</p><p>snapshot çš„åˆ›å»ºè§„åˆ™ï¼š</p><ol><li>å›ºå®š log size è§¦å‘åˆ›å»º snapshotã€‚</li><li>copy-on-write æŠ€æœ¯ç”¨äºåˆ›å»ºã€‚</li></ol><h3 id="å¬è®²"><a class="anchor" href="#å¬è®²">#</a> å¬è®²</h3><p>ä½¿ç”¨ condition</p><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220226202117673.png" alt="image-20220226202117673"></p><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220226202457559.png" alt="image-20220226202457559"></p><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220226210149391.png" alt="image-20220226210149391"></p><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220226210527368.png" alt="image-20220226210527368"></p><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220227155319505.png" alt="image-20220227155319505"></p><p>è¿™å¼ å›¾å¾ˆå¥½åœ°è§£ç­”äº†æˆ‘çš„ç–‘æƒ‘ï¼Œraft ä¸­çš„ server åªèƒ½æ˜¯ leader æ¥å¯¹å¤–æä¾›æœåŠ¡ï¼Œä» client å‘é€è¯·æ±‚åˆ° leader å“åº”è¿‡ç¨‹åˆ†ä¸ºï¼š</p><ul><li>client å‘ server å‘é€è¯·æ±‚ï¼Œå‘é€ç»™ follower çš„è¯·æ±‚ä¼šè¢« follower è½¬å‘ç»™ leaderã€‚</li><li>leader æŠŠ client command å†™åœ¨ log ä¸­ï¼Œå¹¶é€šè¿‡ Append Entites RPC å‘é€ç»™å…¶ä»– followersã€‚</li><li>followers è¿”å›ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚æœé›†ç¾¤ä¸­ majority éƒ½å“åº”äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ leader çŸ¥é“äº† cluster ä¸­å¤§éƒ¨åˆ†èŠ‚ç‚¹å°±æ”¶åˆ°äº†è¿™äº› log entityï¼Œé‚£ä¹ˆå¯¹åº”çš„ entity å°±æ˜¯ <code>committed</code> ã€‚</li><li>leader ç¡®è®¤ entity æ˜¯ committed ä¹‹åï¼Œå°±ä¼šå¼€å§‹æ‰§è¡Œ entity å¯¹åº”çš„ commandï¼Œå¹¶æŠŠæ‰§è¡Œè¿™ä¸ª command å†æ¬¡å‘é€ç»™ followersã€‚</li><li>followers æ”¶åˆ°ç¡®è®¤æ‰§è¡Œ request ä¹‹åå¼€å§‹æ‰§è¡Œã€‚</li></ul><p>æˆ‘ä¹‹å‰æƒ³åˆ°çš„ split partition é—®é¢˜å°±å¯ä»¥å¾ˆå¥½è§£å†³äº†ï¼Œå¦‚æœé›†ç¾¤åˆ†è£‚ä¸ºä¸¤ä¸ª partitionï¼Œç„¶åå„è‡ªéƒ½æœ‰ leaderï¼Œé‚£ä¹ˆå¯¹äº min partition æ¥è¯´ï¼Œleader æ”¶ä¸åˆ° majority çš„ç¡®è®¤ï¼Œå› æ­¤ leader æ²¡æ³•æ‰§è¡ŒæŒ‡ä»¤ã€‚</p><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220301110023351.png" alt="image-20220301110023351"></p><p>raft ä½¿ç”¨ fast backup æ–¹æ³•ã€‚</p><h3 id="çº¿æ€§ä¸€è‡´æ€§"><a class="anchor" href="#çº¿æ€§ä¸€è‡´æ€§">#</a> çº¿æ€§ä¸€è‡´æ€§</h3><h4 id="ä»€ä¹ˆæ˜¯çº¿æ€§ä¸€è‡´æ€§"><a class="anchor" href="#ä»€ä¹ˆæ˜¯çº¿æ€§ä¸€è‡´æ€§">#</a> <strong>ä»€ä¹ˆæ˜¯çº¿æ€§ä¸€è‡´æ€§ï¼Ÿ</strong></h4><p>Raft é‡Œæåˆ°çš„çº¿æ€§ä¸€è‡´æ€§ï¼š</p><p><strong>Linearizable semantics</strong> ï¼ˆLinearizabilityï¼‰(each operation appears to execute instantaneously, exactly once, at some point between its invocation and its response)</p><ul><li><p>åœ¨ä¸€ä¸ªçº¿æ€§ä¸€è‡´æ€§çš„ç³»ç»Ÿé‡Œé¢ï¼Œä»»ä½•æ“ä½œéƒ½å¯èƒ½åœ¨è°ƒç”¨æˆ–è€…è¿”å›ä¹‹é—´åŸå­å’Œç¬é—´æ‰§è¡Œ</p></li><li><p>çº¿æ€§ä¸€è‡´æ€§ï¼ŒLinearizabilityï¼Œä¹Ÿç§°ä¸ºåŸå­ä¸€è‡´æ€§ï¼ˆatomic consistencyï¼‰ï¼Œå¼ºä¸€è‡´æ€§ï¼ˆstrong consistencyï¼‰ç­‰</p></li><li><p>ä¹Ÿå°±æ˜¯é€šå¸¸æ‰€è¯´çš„ CAP ç†è®ºä¸­çš„ C</p></li></ul><p>å®ç°çº¿æ€§ä¸€è‡´æ€§éœ€è¦æ»¡è¶³ä¸‰ç‚¹ï¼š</p><ul><li>ç¬é—´å®Œæˆï¼ˆåŸå­æ€§ï¼‰</li><li>å‘ç”Ÿåœ¨ Inv å’Œ Resp ä¸¤ä¸ªäº‹ä»¶ä¹‹é—´</li><li>åæ˜ å‡º â€œæœ€æ–°â€ çš„å€¼</li></ul><p>1 å’Œ 2 å¾ˆå¥½ç†è§£ï¼Œä½† â€œæœ€æ–°â€ æ€ä¹ˆç†è§£å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•å°±çœ‹å†™æ“ä½œï¼š<br><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220301144626139.png" alt="image-20220301144626139"></p><p>åœ¨å›¾ä¸­ï¼Œx çš„å€¼è¢«å†™æ“ä½œåˆ’åˆ†ä¸º 3 ä¸ªåŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸå†…å¯¹åº”æœ€æ–°çš„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ â€œæœ€æ–°â€ å¹¶ä¸ä»£è¡¨<strong>ç¡®å®š</strong>ï¼</p><h4 id="æ•™æˆè®²çš„çº¿æ€§ä¸€è‡´æ€§"><a class="anchor" href="#æ•™æˆè®²çš„çº¿æ€§ä¸€è‡´æ€§">#</a> æ•™æˆè®²çš„çº¿æ€§ä¸€è‡´æ€§</h4><p>æˆ‘è§‰å¾—æ•™æˆè®²çš„æ›´åŠ è¨€ç®€æ„èµ…ï¼š</p><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturesimage-20220316100700951.png" alt="image-20220316100700951"></p><p>å¦‚æœæ‰§è¡Œå†å²æ˜¯çº¿æ€§çš„ï¼Œé‚£ä¹ˆå­˜åœ¨æ“ä½œåºåˆ—ï¼Œæ»¡è¶³<strong>æ‰§è¡Œé¡ºåºå’ŒçœŸå®æ—¶é—´ç›¸åŒ¹é…</strong>ï¼Œ<strong>æ¯ä¸ªè¯»æ“ä½œä¸€å®šçœ‹åˆ°äº†æœ€æ–°å†™æ“ä½œç»“æœ</strong>ã€‚</p><p>æˆ‘ä»¬ä»¥ä¸‹é¢è¿™å¼ å›¾ä¸ºä¾‹å­ï¼š</p><p><strong>æ‰§è¡Œé¡ºåºå’ŒçœŸå®æ—¶é—´ç›¸åŒ¹é…</strong>ï¼šå¯¹äºéå¹¶å‘ä¹Ÿå°±æ˜¯æ—¶é—´ä¸Šä¸é‡åˆçš„è¯·æ±‚ï¼Œæ¯”å¦‚ w1 å’Œ w2ã€‚è¿™ä¸¤ä¸ªè¯·æ±‚åœ¨æ—¶é—´ä¸Šä¸é‡åˆæ‰€ä»¥ä¸€å®šæ˜¯ w2 å‘ç”Ÿåœ¨ w1 ä¹‹å‰ã€‚ä½†æ˜¯å¯¹äºå¹¶å‘ä¹Ÿå°±æ˜¯æ—¶é—´ä¸Šæœ‰é‡åˆçš„è¯·æ±‚ï¼Œåˆ™éœ€è¦ <code>each operation appears to execute instantaneously</code> ã€‚</p><p><strong>æ¯ä¸ªè¯»æ“ä½œä¸€å®šçœ‹åˆ°äº†æœ€æ–°å†™æ“ä½œç»“æœ</strong>ï¼šè¿™å¥è¯çš„æ„æ€å°±æ˜¯ R ä¸€å®šå‘ç”Ÿåœ¨ W ä¹‹åï¼Œæ¯”å¦‚è¯» R1 ä¸€å®šå‘ç”Ÿåœ¨ W1 ä¹‹åï¼Œå‡å¦‚æ²¡æœ‰æœ€æ–°çš„ W æ“ä½œï¼Œé‚£ä¹ˆä¹‹åæ‰€æœ‰è¯»æ“ä½œä¸€å®šéƒ½æ˜¯è¿”å› 1 çš„ã€‚</p><p><img data-src="https://image-2021-wu.oss-cn-beijing.aliyuncs.com/blogs/picturespicturespicturesimage-20220301122149285.png" alt="image-20220301122149285"></p><h3 id="é‡åˆ°çš„é—®é¢˜"><a class="anchor" href="#é‡åˆ°çš„é—®é¢˜">#</a> é‡åˆ°çš„é—®é¢˜</h3><h4 id="227æ—¥æ›´æ–°"><a class="anchor" href="#227æ—¥æ›´æ–°">#</a> 2.27 æ—¥æ›´æ–°ï¼š</h4><p>æˆåŠŸå®Œæˆäº† Lab2Aï¼Œä½†æ˜¯è¿˜é—ç•™äº†ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ä¸ºä»€ä¹ˆé™åˆ¶é€‰ä¸¾æ‰§è¡Œæ—¶é—´æ‰èƒ½é€šè¿‡ testï¼ŒæŒ‰é“ç†åªè¦é€‰ä¸¾è¶…æ—¶ä¹‹åï¼Œä¹‹å‰é€‰ä¸¾çš„ç»“æœå°±ä¼šè¢«åºŸå¼ƒçš„ã€‚ã€‚ã€‚</p><pre><code>Test (2A): initial election ...
labgob warning: Decoding into a non-default variable/field Term may not work
  ... Passed --   3.0  3   56    6872    0
Test (2A): election after network failure ...
  ... Passed --   9.2  3  238   17813    0
Test (2A): multiple elections ...
  ... Passed --   6.5  7  642   55493    0
PASS
ok  	6.824/raft	18.733s

</code></pre><h4 id="31å·æ›´æ–°"><a class="anchor" href="#31å·æ›´æ–°">#</a> 3.1 å·æ›´æ–°</h4><p>raft åœ¨ leader å½“é€‰ä¹‹åä¼šç«‹å³åœ¨ leader çš„ log ä¸­ç”Ÿæˆä¸€æ¡ no-hup æ—¥å¿—å¹¶é€šè¿‡ heartbeat ä¼ é€’ç»™å…¶ä»– serverã€‚ä½†æ˜¯åœ¨ MIT6.824 å®éªŒä¸­æ²¡åŠæ³•å®ç° no-hupã€‚</p><h4 id="34-æ›´æ–°"><a class="anchor" href="#34-æ›´æ–°">#</a> 3.4 æ›´æ–°</h4><p>æ„‰å¿«é€šå…³ï¼</p><div class="tags"><a href="/tags/MIT6-824/" rel="tag"><i class="ic i-tag"></i> MIT6.824</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-05-11 19:42:45" itemprop="dateModified" datetime="2022-05-11T19:42:45+08:00">2022-05-11</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> èµèµ</button><p>è¯·æˆ‘å–[èŒ¶]~(ï¿£â–½ï¿£)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Kalice å¾®ä¿¡æ”¯ä»˜"><p>å¾®ä¿¡æ”¯ä»˜</p></div><div><img data-src="/images/alipay.png" alt="Kalice æ”¯ä»˜å®"><p>æ”¯ä»˜å®</p></div></div></div><div id="copyright"><ul><li class="author"><strong>æœ¬æ–‡ä½œè€…ï¼š </strong>Kalice <i class="ic i-at"><em>@</em></i>Life</li><li class="link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong> <a href="https://songlinlife.top/2022/%E5%88%86%E5%B8%83%E5%BC%8F/MIT6-824-lab2-Raft/" title="MIT6.824: lab2 Raft">https://songlinlife.top/2022/åˆ†å¸ƒå¼/MIT6-824-lab2-Raft/</a></li><li class="license"><strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬ç«™æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/xlab/Artur-%E8%B0%83%E5%BA%A6%E5%99%A8/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gicivghyooj20zk0m8dir.jpg" title="Artur: è°ƒåº¦å™¨"><span class="type">ä¸Šä¸€ç¯‡</span> <span class="category"><i class="ic i-flag"></i> xlab</span><h3>Artur: è°ƒåº¦å™¨</h3></a></div><div class="item right"><a href="/2022/xlab/grimoireLab-%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%BC%BA%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giciundwu5j20zk0m8n9e.jpg" title="grimoireLab: æ•°æ®å¢å¼ºç›¸å…³ç»„ä»¶"><span class="type">ä¸‹ä¸€ç¯‡</span> <span class="category"><i class="ic i-flag"></i> xlab</span><h3>grimoireLab: æ•°æ®å¢å¼ºç›¸å…³ç»„ä»¶</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="æ–‡ç« ç›®å½•"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#part-2a"><span class="toc-number">1.</span> <span class="toc-text">Part 2A</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#part2b"><span class="toc-number">2.</span> <span class="toc-text">Part2B</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#33%E6%9B%B4%E6%96%B0"><span class="toc-number">2.1.</span> <span class="toc-text">3.3 æ›´æ–°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#part-2c"><span class="toc-number">3.</span> <span class="toc-text">Part 2C</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#33%E6%9B%B4%E6%96%B0-2"><span class="toc-number">3.1.</span> <span class="toc-text">3.3 æ›´æ–°</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#testfigure8unreliable2c%E6%8A%A5%E9%94%99%E8%BF%94%E5%9B%9Etrue%E7%9A%84appendentriesrpc%E4%B8%A2%E5%A4%B1%E9%97%AE%E9%A2%98"><span class="toc-number">3.1.1.</span> <span class="toc-text">TestFigure8Unreliable2C æŠ¥é”™ï¼Œè¿”å› true çš„ AppendEntriesRPC ä¸¢å¤±é—®é¢˜</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#unreliable-churn-out-of-range-%E9%97%AE%E9%A2%98"><span class="toc-number">3.1.2.</span> <span class="toc-text">unreliable churn out of range é—®é¢˜</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#testfigure8unreliable2c%E7%A8%80%E6%9C%89out-of-range"><span class="toc-number">3.1.3.</span> <span class="toc-text">TestFigure8Unreliable2C ç¨€æœ‰ out of range</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#part2d"><span class="toc-number">4.</span> <span class="toc-text">Part2D</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E4%BC%A4%E9%80%9A%E5%85%B334%E6%9B%B4%E6%96%B0"><span class="toc-number">4.1.</span> <span class="toc-text">æ— ä¼¤é€šå…³ï¼ï¼ï¼ï¼ï¼ï¼ˆ3.4 æ›´æ–°ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#installsnapshot-rpc"><span class="toc-number">4.2.</span> <span class="toc-text">Installsnapshot RPC</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%81%97%E7%95%99%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">5.</span> <span class="toc-text">é—ç•™çš„é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#raft-basic"><span class="toc-number">6.</span> <span class="toc-text">Raft Basic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#leader%E9%80%89%E4%B8%BE"><span class="toc-number">7.</span> <span class="toc-text">Leader é€‰ä¸¾</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#follower"><span class="toc-number">7.1.</span> <span class="toc-text">follower</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#candidate"><span class="toc-number">7.2.</span> <span class="toc-text">candidate</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#requestvote-rpc%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">7.2.1.</span> <span class="toc-text">RequestVote RPC çš„ç»“æ„ï¼š</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#candidate%E9%9C%80%E8%A6%81%E5%81%9A%E7%9A%84"><span class="toc-number">7.2.2.</span> <span class="toc-text">candidate éœ€è¦åšçš„ï¼š</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Erandomized-election-timeouts"><span class="toc-number">7.3.</span> <span class="toc-text">å…³äº randomized election timeouts</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#state"><span class="toc-number">8.</span> <span class="toc-text">State</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%80%E6%9C%89%E7%9A%84server%E9%83%BD%E6%9C%89%E7%9A%84%E7%8A%B6%E6%80%81"><span class="toc-number">8.1.</span> <span class="toc-text">æ‰€æœ‰çš„ server éƒ½æœ‰çš„çŠ¶æ€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#leader-%E7%BB%B4%E6%8A%A4%E7%9A%84%E7%8A%B6%E6%80%81"><span class="toc-number">8.2.</span> <span class="toc-text">leader ç»´æŠ¤çš„çŠ¶æ€</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E54-safety"><span class="toc-number">9.</span> <span class="toc-text">å…³äº 5.4 Safety</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%A5%E6%A0%BC%E9%80%89%E4%B8%BE"><span class="toc-number">9.1.</span> <span class="toc-text">ä¸¥æ ¼é€‰ä¸¾</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#committed%E8%A7%84%E5%88%99"><span class="toc-number">9.2.</span> <span class="toc-text">committed è§„åˆ™</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#safety-argument"><span class="toc-number">9.3.</span> <span class="toc-text">Safety argument</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#timing-and-availability"><span class="toc-number">9.4.</span> <span class="toc-text">Timing and availability</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#log-compaction"><span class="toc-number">10.</span> <span class="toc-text">Log compaction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AC%E8%AE%B2"><span class="toc-number">11.</span> <span class="toc-text">å¬è®²</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E6%80%A7%E4%B8%80%E8%87%B4%E6%80%A7"><span class="toc-number">12.</span> <span class="toc-text">çº¿æ€§ä¸€è‡´æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E6%80%A7%E4%B8%80%E8%87%B4%E6%80%A7"><span class="toc-number">12.1.</span> <span class="toc-text">ä»€ä¹ˆæ˜¯çº¿æ€§ä¸€è‡´æ€§ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%99%E6%8E%88%E8%AE%B2%E7%9A%84%E7%BA%BF%E6%80%A7%E4%B8%80%E8%87%B4%E6%80%A7"><span class="toc-number">12.2.</span> <span class="toc-text">æ•™æˆè®²çš„çº¿æ€§ä¸€è‡´æ€§</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">13.</span> <span class="toc-text">é‡åˆ°çš„é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#227%E6%97%A5%E6%9B%B4%E6%96%B0"><span class="toc-number">13.1.</span> <span class="toc-text">2.27 æ—¥æ›´æ–°ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#31%E5%8F%B7%E6%9B%B4%E6%96%B0"><span class="toc-number">13.2.</span> <span class="toc-text">3.1 å·æ›´æ–°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#34-%E6%9B%B4%E6%96%B0"><span class="toc-number">13.3.</span> <span class="toc-text">3.4 æ›´æ–°</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="ç³»åˆ—æ–‡ç« "><ul><li><a href="/2022/%E5%88%86%E5%B8%83%E5%BC%8F/MIT6-824-mapreduce/" rel="bookmark" title="MIT6.824: mapreduce">MIT6.824: mapreduce</a></li><li><a href="/2022/%E5%88%86%E5%B8%83%E5%BC%8F/MIT6-824-GFS/" rel="bookmark" title="MIT6.824: GFS">MIT6.824: GFS</a></li><li><a href="/2022/%E5%88%86%E5%B8%83%E5%BC%8F/MIT6-824-The-Design-of-a-Practical-System-for-Fault-Tolerant-Virtual-Machines/" rel="bookmark" title="MIT6.824: The Design of a Practical System for Fault-Tolerant Virtual Machines">MIT6.824: The Design of a Practical System for Fault-Tolerant Virtual Machines</a></li><li class="active"><a href="/2022/%E5%88%86%E5%B8%83%E5%BC%8F/MIT6-824-lab2-Raft/" rel="bookmark" title="MIT6.824: lab2 Raft">MIT6.824: lab2 Raft</a></li><li><a href="/2022/%E5%88%86%E5%B8%83%E5%BC%8F/MIT6-824-zookeeper/" rel="bookmark" title="MIT6.824: ZooKeeper: Wait-free coordination for Internet-scale systems">MIT6.824: ZooKeeper: Wait-free coordination for Internet-scale systems</a></li><li><a href="/2022/%E5%88%86%E5%B8%83%E5%BC%8F/MIT6-824-Object-Storage-on-CRAQ-High-throughput-chain-replication-for-read-mostly-workloads/" rel="bookmark" title="MIT6.824: Object Storage on CRAQ High-throughput chain replication for read-mostly workloads">MIT6.824: Object Storage on CRAQ High-throughput chain replication for read-mostly workloads</a></li><li><a href="/2022/%E5%88%86%E5%B8%83%E5%BC%8F/MIT6-824-lab3-KV-Service/" rel="bookmark" title="MIT6.824: lab3 KV Service">MIT6.824: lab3 KV Service</a></li><li><a href="/2022/%E5%88%86%E5%B8%83%E5%BC%8F/MIT6-824-Aurora/" rel="bookmark" title="MIT6.824: Amazon Aurora: Design Considerations for High Throughput Cloud-Native Relational Databases">MIT6.824: Amazon Aurora: Design Considerations for High Throughput Cloud-Native Relational Databases</a></li><li><a href="/2022/%E5%88%86%E5%B8%83%E5%BC%8F/MIT6-824%EF%BC%9AFrangipani-A-Scalable-Distributed-File-System/" rel="bookmark" title="MIT6.824ï¼šFrangipani: A Scalable Distributed File System">MIT6.824ï¼šFrangipani: A Scalable Distributed File System</a></li><li><a href="/2022/%E5%88%86%E5%B8%83%E5%BC%8F/MIT6-824%EF%BC%9A%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" rel="bookmark" title="MIT6.824ï¼šåˆ†å¸ƒå¼äº‹åŠ¡">MIT6.824ï¼šåˆ†å¸ƒå¼äº‹åŠ¡</a></li><li><a href="/2022/%E5%88%86%E5%B8%83%E5%BC%8F/MIT6-824%EF%BC%9ASpaner/" rel="bookmark" title="MIT6.824ï¼šSpaner">MIT6.824ï¼šSpaner</a></li><li><a href="/2022/%E5%88%86%E5%B8%83%E5%BC%8F/MIT6-824-Lab4/" rel="bookmark" title="MIT6.824:Lab4">MIT6.824:Lab4</a></li></ul></div><div class="overview panel" data-title="ç«™ç‚¹æ¦‚è§ˆ"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Kalice" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Kalice</p><div class="description" itemprop="description">Life is not about lifestyle, it means Lithium and Ferrum.</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">109</span> <span class="name">æ–‡ç« </span></a></div><div class="item categories"><a href="/categories/"><span class="count">20</span> <span class="name">åˆ†ç±»</span></a></div><div class="item tags"><a href="/tags/"><span class="count">42</span> <span class="name">æ ‡ç­¾</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>é¦–é¡µ</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>å…³äº</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>æ–‡ç« </a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>å½’æ¡£</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>åˆ†ç±»</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>æ ‡ç­¾</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2022/xlab/Artur-%E8%B0%83%E5%BA%A6%E5%99%A8/" rel="prev" title="ä¸Šä¸€ç¯‡"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/xlab/grimoireLab-%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%BC%BA%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6/" rel="next" title="ä¸‹ä¸€ç¯‡"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>éšæœºæ–‡ç« </h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Go/" title="åˆ†ç±»äº Go">Go</a></div><span><a href="/2022/Go/Golang-cookies%E4%B8%8Esessions/" title="Golang: cookiesä¸sessions">Golang: cookiesä¸sessions</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" title="åˆ†ç±»äº åˆ†å¸ƒå¼">åˆ†å¸ƒå¼</a></div><span><a href="/2022/%E5%88%86%E5%B8%83%E5%BC%8F/MIT6-824-lab3-KV-Service/" title="MIT6.824: lab3 KV Service">MIT6.824: lab3 KV Service</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Go/" title="åˆ†ç±»äº Go">Go</a></div><span><a href="/2022/Go/golang-%E5%B9%B6%E5%8F%91%E5%AD%A6%E4%B9%A0/" title="golang å¹¶å‘å­¦ä¹ ">golang å¹¶å‘å­¦ä¹ </a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Go/" title="åˆ†ç±»äº Go">Go</a></div><span><a href="/2022/Go/golang-Web%E7%9B%B8%E5%85%B3%E5%AD%A6%E4%B9%A0/" title="golang Webç›¸å…³å­¦ä¹ ">golang Webç›¸å…³å­¦ä¹ </a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ss/" title="åˆ†ç±»äº çäº‹">çäº‹</a></div><span><a href="/2022/ss/Git-%E4%BB%A3%E7%90%86/" title="Git ä»£ç†">Git ä»£ç†</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/python/" title="åˆ†ç±»äº Python">Python</a></div><span><a href="/2021/python/pip%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/" title="pip ç›¸å…³é—®é¢˜">pip ç›¸å…³é—®é¢˜</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ss/" title="åˆ†ç±»äº çäº‹">çäº‹</a></div><span><a href="/2022/PPT%E5%AD%A6%E4%B9%A0/" title="PPTå­¦ä¹ ">PPTå­¦ä¹ </a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Go/" title="åˆ†ç±»äº Go">Go</a></div><span><a href="/2022/Go/Golang%EF%BC%9A%E6%9F%A5%E8%AF%A2MongoDB/" title="Golangï¼šæŸ¥è¯¢MongoDB">Golangï¼šæŸ¥è¯¢MongoDB</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ai/" title="åˆ†ç±»äº AI">AI</a></div><span><a href="/2021/DGL-01-%E4%BF%A1%E6%81%AF%E4%BC%A0%E9%80%92%E8%8C%83%E5%BC%8F/" title="DGL(01): ä¿¡æ¯ä¼ é€’èŒƒå¼">DGL(01): ä¿¡æ¯ä¼ é€’èŒƒå¼</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" title="åˆ†ç±»äº åˆ†å¸ƒå¼">åˆ†å¸ƒå¼</a></div><span><a href="/2022/%E5%88%86%E5%B8%83%E5%BC%8F/MIT6-824-Object-Storage-on-CRAQ-High-throughput-chain-replication-for-read-mostly-workloads/" title="MIT6.824: Object Storage on CRAQ High-throughput chain replication for read-mostly workloads">MIT6.824: Object Storage on CRAQ High-throughput chain replication for read-mostly workloads</a></span></li></ul></div><div><h2>æœ€æ–°è¯„è®º</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 â€“ <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Kalice @ Songlin</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="ç«™ç‚¹æ€»å­—æ•°">234k å­—</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">3:32</span></div><div class="powered-by">åŸºäº <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/åˆ†å¸ƒå¼/MIT6-824-lab2-Raft/",favicon:{show:"ï¼ˆâ—Â´3ï½€â—ï¼‰ã‚„ã‚Œã‚„ã‚Œã ãœ",hide:"(Â´Ğ”ï½€)å¤§å¤‰ã ï¼"},search:{placeholder:"æ–‡ç« æœç´¢",empty:"å…³äº ã€Œ ${query} ã€ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœåˆ°",stats:"${time} ms å†…æ‰¾åˆ° ${hits} æ¡ç»“æœ"},valine:!0,copy_tex:!0,katex:!0,mermaid:!0,fancybox:!0,copyright:'å¤åˆ¶æˆåŠŸï¼Œè½¬è½½è¯·éµå®ˆ <i class="ic i-creative-commons"></i>BY-NC-SA åè®®ã€‚',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->